System.register("chunks:///main.js",["cc"],(function(){var e,t,i,o,n,a,r,s,l,h,c,u,d,p,g,f,m,v,y,_,b,S,B,P,C,w,D,L,k,T,M,A,x,F,I,R,H,N,O,E,z,W,U,q,G;return{setters:[function(J){e=J.cclegacy,t=J._decorator,i=J.Node,o=J.Color,n=J.Canvas,a=J.UITransform,r=J.instantiate,s=J.Label,l=J.RichText,h=J.Toggle,c=J.Button,u=J.director,d=J.Component,p=J.SpriteFrame,g=J.find,f=J.Sprite,m=J.Animation,v=J.BoxCollider2D,y=J.Size,_=J.Contact2DType,b=J.NodePool,S=J.Prefab,B=J.EventHandler,P=J.Vec2,C=J.Material,w=J.Vec3,D=J.tween,L=J.Collider2D,k=J.Rect,T=J.JsonAsset,M=J.AnimationClip,A=J.CircleCollider2D,x=J.input,F=J.Input,I=J.PhysicsSystem2D,R=J.EPhysics2DDrawFlags,H=J.game,N=J.ScrollView,O=J.math,E=J.ProgressBar,z=J.Slider,W=J.resources,U=J.AudioClip,q=J.AudioSource,G=J.sys}],execute:function(){function J(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,V(e,t)}function V(e,t){return(V=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,o=new Array(t);i<t;i++)o[i]=e[i];return o}function K(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=function(e,t){if(e){if("string"==typeof e)return Q(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Q(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function X(e,t,i,o){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0})}function Z(e,t,i,o,n){var a={};return Object.keys(o).forEach((function(e){a[e]=o[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=i.slice().reverse().reduce((function(i,o){return o(e,t,i)||i}),a),n&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(n):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}var Y,$,ee,te,ie,oe,ne,ae,re;e._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var se=t.ccclass,le=t.property;Y=se("internal.DebugViewRuntimeControl"),$=le(i),ee=le(i),te=le(i),Y((ne=Z((oe=function(e){function t(){for(var t,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];return X(t=e.call.apply(e,[this].concat(n))||this,"compositeModeToggle",ne,j(t)),X(t,"singleModeToggle",ae,j(t)),X(t,"EnableAllCompositeModeButton",re,j(t)),t._single=0,t.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],t.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],t.strMisc=["CSM Layer Coloration","Lighting With Albedo"],t.compositeModeToggleList=[],t.singleModeToggleList=[],t.miscModeToggleList=[],t.textComponentList=[],t.labelComponentList=[],t.textContentList=[],t.hideButtonLabel=void 0,t._currentColorIndex=0,t.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],t.color=[o.WHITE,o.BLACK,o.RED,o.GREEN,o.BLUE],t}J(t,e);var i=t.prototype;return i.start=function(){if(this.node.parent.getComponent(n)){var e=this.node.parent.getComponent(a),t=.5*e.width,i=.5*e.height,u=.1*t-t,d=i-.1*i,p=this.node.getChildByName("MiscMode"),g=r(p);g.parent=this.node,g.name="Buttons";var f=r(p);f.parent=this.node,f.name="Titles";for(var m=0;m<2;m++){var v=r(this.EnableAllCompositeModeButton.getChildByName("Label"));v.setPosition(u+(m>0?450:150),d,0),v.setScale(.75,.75,.75),v.parent=f;var y=v.getComponent(s);y.string=m?"----------Composite Mode----------":"----------Single Mode----------",y.color=o.WHITE,y.overflow=0,this.labelComponentList[this.labelComponentList.length]=y}d-=20;for(var _=0,b=0;b<this.strSingle.length;b++,_++){b===this.strSingle.length>>1&&(u+=200,_=0);var S=b?r(this.singleModeToggle):this.singleModeToggle;S.setPosition(u,d-20*_,0),S.setScale(.5,.5,.5),S.parent=this.singleModeToggle.parent;var B=S.getComponentInChildren(l);B.string=this.strSingle[b],this.textComponentList[this.textComponentList.length]=B,this.textContentList[this.textContentList.length]=B.string,S.on(h.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[b]=S}u+=200,this.EnableAllCompositeModeButton.setPosition(u+15,d,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(c.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=g;var P=this.EnableAllCompositeModeButton.getComponentInChildren(s);this.labelComponentList[this.labelComponentList.length]=P;var C=r(this.EnableAllCompositeModeButton);C.setPosition(u+90,d,0),C.setScale(.5,.5,.5),C.on(c.EventType.CLICK,this.changeTextColor,this),C.parent=g,(P=C.getComponentInChildren(s)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=P;var w=r(this.EnableAllCompositeModeButton);w.setPosition(u+200,d,0),w.setScale(.5,.5,.5),w.on(c.EventType.CLICK,this.hideUI,this),w.parent=this.node.parent,(P=w.getComponentInChildren(s)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=P,this.hideButtonLabel=P,d-=40;for(var D=0;D<this.strMisc.length;D++){var L=r(this.compositeModeToggle);L.setPosition(u,d-20*D,0),L.setScale(.5,.5,.5),L.parent=p;var k=L.getComponentInChildren(l);k.string=this.strMisc[D],this.textComponentList[this.textComponentList.length]=k,this.textContentList[this.textContentList.length]=k.string,L.getComponent(h).isChecked=!!D,L.on(h.EventType.TOGGLE,D?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[D]=L}d-=150;for(var T=0;T<this.strComposite.length;T++){var M=T?r(this.compositeModeToggle):this.compositeModeToggle;M.setPosition(u,d-20*T,0),M.setScale(.5,.5,.5),M.parent=this.compositeModeToggle.parent;var A=M.getComponentInChildren(l);A.string=this.strComposite[T],this.textComponentList[this.textComponentList.length]=A,this.textContentList[this.textContentList.length]=A.string,M.on(h.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[T]=M}}else console.error("debug-view-runtime-control should be child of Canvas")},i.isTextMatched=function(e,t){var i=new String(e),o=i.search(">");return-1===o?e===t:(i=(i=i.substr(o+1)).substr(0,i.search("<")))===t},i.toggleSingleMode=function(e){for(var t=u.root.debugView,i=e.getComponentInChildren(l),o=0;o<this.strSingle.length;o++)this.isTextMatched(i.string,this.strSingle[o])&&(t.singleMode=o)},i.toggleCompositeMode=function(e){for(var t=u.root.debugView,i=e.getComponentInChildren(l),o=0;o<this.strComposite.length;o++)this.isTextMatched(i.string,this.strComposite[o])&&t.enableCompositeMode(o,e.isChecked)},i.toggleLightingWithAlbedo=function(e){u.root.debugView.lightingWithAlbedo=e.isChecked},i.toggleCSMColoration=function(e){u.root.debugView.csmLayerColoration=e.isChecked},i.enableAllCompositeMode=function(e){var t=u.root.debugView;t.enableAllCompositeMode(!0);for(var i=0;i<this.compositeModeToggleList.length;i++){this.compositeModeToggleList[i].getComponent(h).isChecked=!0}var o=this.miscModeToggleList[0].getComponent(h);o.isChecked=!1,t.csmLayerColoration=!1,(o=this.miscModeToggleList[1].getComponent(h)).isChecked=!0,t.lightingWithAlbedo=!0},i.hideUI=function(e){var t=this.node.getChildByName("Titles"),i=!t.active;this.singleModeToggleList[0].parent.active=i,this.miscModeToggleList[0].parent.active=i,this.compositeModeToggleList[0].parent.active=i,this.EnableAllCompositeModeButton.parent.active=i,t.active=i,this.hideButtonLabel.string=i?"Hide UI":"Show UI"},i.changeTextColor=function(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(var i=0;i<this.labelComponentList.length;i++)this.labelComponentList[i].color=this.color[this._currentColorIndex]},i.onLoad=function(){},i.update=function(e){},t}(d)).prototype,"compositeModeToggle",[$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ae=Z(oe.prototype,"singleModeToggle",[ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=Z(oe.prototype,"EnableAllCompositeModeButton",[te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ie=oe));e._RF.pop(),e._RF.push({},"5c6a3Yv5EpJsq04i8Ct/NRI","MonsterParNode",void 0),e._RF.pop(),e._RF.push({},"65fecLrBN5EdbS9KOtfYHkX","EventManager",void 0);var he=function(){function e(){this.event={}}var t=e.prototype;return t.add=function(e,t){e&&t?this.event[e]?console.warn("event already exists:",e):(this.event[e]={callback:t},console.log("event added:",e)):console.warn("event type or callback missing")},t.dispatch=function(e){if(!e)return console.warn("dispatch type is empty"),null;if(!this.event[e])return console.warn("event not registered:",e),null;var t=this.event[e].callback;if(!t)return console.warn("event callback missing:",e),null;try{for(var i=arguments.length,o=new Array(i>1?i-1:0),n=1;n<i;n++)o[n-1]=arguments[n];return t.apply(void 0,o)}catch(t){return console.warn("event callback error:",e,t),null}},t.eventIsDefined=function(e){return!!this.event[e]},t.remove=function(e){e?this.event[e]?delete this.event[e]:console.warn("remove event not exist:",e):console.warn("remove event type is empty")},t.showAllEvents=function(){console.log(this.event)},e}();console.log("九重修炼 alpha-version-2.1");var ce=new he;e._RF.pop(),e._RF.push({},"12677v3hZxChoqJeg+2NXbN","globalData",void 0);var ue,de,pe,ge,fe,me,ve,ye,_e,be=function(e){return e[e.hero=10]="hero",e[e.sword=11]="sword",e[e.fan=12]="fan",e[e.guard=13]="guard",e[e.spell=14]="spell",e[e.darts=15]="darts",e[e.friend1Skill1=16]="friend1Skill1",e[e.monster=17]="monster",e[e.wall=18]="wall",e[e.boss=19]="boss",e[e.fireBall=20]="fireBall",e[e.fireBallFire=21]="fireBallFire",e[e.trackDisappear=22]="trackDisappear",e[e.enemySkill=23]="enemySkill",e[e.obstacle=24]="obstacle",e}({}),Se={DEFAULT:Math.pow(2,0),enemy:Math.pow(2,1),self:Math.pow(2,2),obstacle:Math.pow(2,3),enemySkill:Math.pow(2,4),heroWeapon:Math.pow(2,5)},Be={monsterCollideHero:1,guard:.5,spell:.1,f1s1:1/60,boss1:1,boss2:1},Pe={stopAll:!1,curStage:1,curLv:1,stageProgress:1};e._RF.pop(),e._RF.push({},"3915avsEoJBXokQnV1iJKrp","PassRewardLayer",void 0);var Ce=t.ccclass,we=t.property;ue=Ce("PassRewardLayer"),de=we(s),pe=we(p),ge=we(p),ue((ve=Z((me=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"descriptionLabel",ve,j(t)),X(t,"bgSpriteSF",ye,j(t)),X(t,"leaderRewardSF",_e,j(t)),t._bgSprite=null,t._prefab=null,t._rContent=null,t._killLeaderRewardConfig=void 0,t._isPass=!1,t._notNoticeKillReward=!1,t}J(t,e);var i=t.prototype;return i.onLoad=function(){ce.add("openRewardLayer",this.openLayer.bind(this)),ce.add("showKillLeaderReward",this.showKillLeaderReward.bind(this)),ce.add("showPassReward",this.showPassReward.bind(this)),this.initNode(),this.initOutRefList(),this.initLeaderRewardConfig()},i.onDestroy=function(){ce.remove("openRewardLayer"),ce.remove("showKillLeaderReward"),ce.remove("showPassReward")},i.initNode=function(){this._bgSprite=g("bg",this.node).getComponent(f),this._prefab=g("prefab",this.node),this._rContent=g("bg/ScrollView/view/content",this.node)},i.initOutRefList=function(){if(!this.bgSpriteSF)throw"reward refs init failed,please checking refs are added.";this._bgSprite.spriteFrame=this.bgSpriteSF},i.initLeaderRewardConfig=function(){this._killLeaderRewardConfig={0:"strengthBlood1",1:"strengthBlood2",2:"strengthBlood3",3:"strengthBlood4",4:"strengthBlood5",5:"strengthDamage1",6:"strengthDamage2",7:"strengthDamage3",8:"strengthDamage4",9:"strengthDamage5",10:"strengthMoveSpeed1",11:"strengthMoveSpeed2",12:"strengthMoveSpeed3",13:"strengthMoveSpeed4",14:"strengthMoveSpeed5"}},i.onDisable=function(){g("killLeaderReward",this.node).getComponent(f).spriteFrame=null,g("killLeaderReward/Label",this.node).getComponent(s).string="",Pe.stopAll=g("passRewardLayer",this.node.parent).active},i.showKillLeaderReward=function(e){if(this.leaderRewardSF.length<=0)throw"leader reward sf is null";var t=5*Math.random()|0,i=ce.dispatch("usingHeroControlFun","updateBonusValue",e,t+1);ce.dispatch("createTipsTex",i)},i.showPassReward=function(e,t){var i=this;e.forEach((function(e){if(console.log(e),e.total>0){var t=r(i._prefab),o=ce.dispatch("getItemDataByIdOrName",e.id);t.parent=i._rContent,t.getChildByName("name").getComponent(s).string=o.name+"x"+e.total;var n=t.getChildByName("sprite").getComponent(f),a="images/items/"+o.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",a,(function(e){return n.spriteFrame=e})),t.active=!0}})),this.descriptionLabel.string=t,Pe.stopAll=!0,this.node.active=!0,this._isPass=!0},i.closeLayer=function(){this._isPass?(console.log("跳转到菜单界面"),u.loadScene("mainMenu",(function(){ce.dispatch("switchMainBgm","/audio/music/刀剑如梦")}))):(this.node.active=!1,g("Toggle",this.node).active=!1,ce.dispatch("usingMonsterManagerFun","resumeAllAnim"),ce.dispatch("usingHeroControlFun","resumeGame"))},i.openLayer=function(){this.node.active=!0},i.onBtnNotNotice=function(){this._notNoticeKillReward=!this._notNoticeKillReward},t}(d)).prototype,"descriptionLabel",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye=Z(me.prototype,"bgSpriteSF",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=Z(me.prototype,"leaderRewardSF",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fe=me));e._RF.pop(),e._RF.push({},"30144h3bq1FZq7sGzjXg5LP","MonsterData",void 0);var De,Le=100,ke=100,Te={xLine:function(e,t){if(void 0===t&&(t=0),e<=0||e%1!=0||e%2==0)throw new Error("参数错误 小于1 或为非整数 或为非偶数");for(var i=Math.floor(e/2),o=[],n=0;n<e;n++)o.push([(-i+n)*Le,t]);return o},yLine:function(e,t){if(void 0===t&&(t=0),e<=0||e%1!=0||e%2==0)throw new Error("参数错误 小于1 或为非整数 或为偶数");for(var i=Math.floor(e/2),o=[],n=0;n<e;n++)o.push([t,(-i+n)*ke]);return o},triR:function(e){if(e<=0||e%1!=0||e%2==0)throw new Error("参数错误 小于1 或为非整数 或为非偶数");for(var t=Math.floor(e/2),i=[],o=0;o<e;o++)o<=t?i.push([o*Le,(t-o)*ke]):i.push([(e-o-1)*Le,(t-o)*ke]);return i},triL:function(e){if(e<=0||e%1!=0||e%2==0)throw new Error("参数错误 小于1 或为非整数 或为非偶数");for(var t=Math.floor(e/2),i=[],o=0;o<e;o++)o<=t?i.push([(t-o)*Le,(t-o)*ke]):i.push([(o-t)*Le,(t-o)*ke]);return i},triU:function(e){if(e<=0||e%1!=0||e%2==0)throw new Error("参数错误 小于1 或为非整数 或为非偶数");for(var t=Math.floor(e/2),i=[],o=0;o<e;o++)o<=t?i.push([(t-o)*Le,(t-o)*ke]):i.push([(t-o)*Le,(o-t)*ke]);return i},triD:function(e){if(e<=0||e%1!=0||e%2==0)throw new Error("参数错误 小于1 或为非整数 或为非偶数");for(var t=Math.floor(e/2),i=[],o=0;o<e;o++)o<=t?i.push([(t-o)*Le,-(t-o)*ke]):i.push([(t-o)*Le,-(o-t)*ke]);return i},circle:function(e,t){if(t<4)throw"圆上点数过少 请输入大于4的数字";if(t%4!=0)throw"生成的在圆上的点的总数错误，不是4的倍数"+t;for(var i=t/4,o=[],n=1;n<i;n++){var a=e*Math.sin(Math.PI/180*n/i*90),r=Math.sqrt(e*e-a*a);o.push([r,a],[r,-a],[-r,a],[-r,-a])}return o.push([0,e],[0,-e],[e,0],[-e,0]),o},heart:function(e,t){if(t<20)throw"total过小，无法生成心形方程";var i=2*Math.PI/t;e/=16;for(var o=[];t;){var n=i*t,a=16*Math.pow(Math.sin(n),3),r=13*Math.cos(n)-5*Math.cos(2*n)-2*Math.cos(3*n)-Math.cos(4*n);a*=e,r*=e,o.push([a,r]),t--}return o},rect:function(e,t){if(t>0&&t%4!=0)throw"total 必须是大于0的4的倍数.";var i=t/4,o=[],n=Te.xLine(i,e),a=Te.xLine(i,-e),r=Te.yLine(i,e),s=Te.yLine(i,-e);return n.forEach((function(e){return o.push(e)})),a.forEach((function(e){return o.push(e)})),r.forEach((function(e){return o.push(e)})),s.forEach((function(e){return o.push(e)})),o}},Me={minGapWithHero1:150,minGapWithHero2:5,queueMappingList:{1:"one",2:"x3",3:"y3",4:"triR3",5:"triL3",6:"triU3",7:"triD3",8:"x5",9:"y5",10:"triR5",11:"triL5",12:"circleR1000T20",13:"heartR500T40",9001:"rectO500T12",9002:"rectO500T20",9003:"rectO500T28",9004:"rectO500T36",10001:"circleR1000T28",10002:"heartR500T28",10003:"circleR1000T36",10004:"heartR500T36",10005:"circleR1000T44",10006:"heartR500T44",10007:"circleR1000T52",10008:"heartR500T52",10009:"circleR1000T60",10010:"heartR500T60"},queue:{one:Te.xLine(1),x3:Te.xLine(3),y3:Te.yLine(3),triR3:Te.triR(3),triL3:Te.triL(3),triU3:Te.triU(3),triD3:Te.triD(3),x5:Te.xLine(5),y5:Te.yLine(5),triR5:Te.triR(5),triL5:Te.triL(5),triU5:Te.triU(5),triD5:Te.triD(5),circleR1000T20:Te.circle(1e3,20),heartR500T20:Te.heart(500,20),rectO500T12:Te.rect(500,12),rectO500T20:Te.rect(500,20),rectO500T28:Te.rect(500,28),rectO500T36:Te.rect(500,36),circleR1000T28:Te.circle(1e3,28),heartR500T28:Te.heart(500,28),circleR1000T36:Te.circle(1e3,36),heartR500T36:Te.heart(500,36),circleR1000T44:Te.circle(1e3,44),heartR500T44:Te.heart(500,44),circleR1000T52:Te.circle(1e3,52),heartR500T52:Te.heart(500,52),circleR1000T60:Te.circle(1e3,60),heartR500T60:Te.heart(500,60)},queueDir:{one:null,x3:null,y3:null,x5:null,y5:null,triR3:{x:-800,y:0},triL3:{x:800,y:0},triU3:{x:0,y:800},triD3:{x:0,y:-800},triR5:{x:-800,y:0},triL5:{x:800,y:0},triU5:{x:0,y:800},triD5:{x:0,y:-800},circleR1000T20:{x:0,y:0},heartR500T40:{x:0,y:0}},MSCoefficient:.5};e._RF.pop(),e._RF.push({},"ef2f9haQTxL5Jy9QffrqzGj","Boss",void 0);var Ae=t.ccclass,xe=(t.property,Ae("Boss")(De=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._isTouchHero=!1,t._isTouchFriend1Skill1=!1,t._isTouchSpell=!1,t._normalDamage=99,t._sprite=void 0,t._bloodSprite=void 0,t._bossId=void 0,t._rawSpeed=void 0,t._curSpeed=void 0,t._canMove=!0,t._isInitData=!1,t._maxBlood=0,t._curBlood=0,t}J(t,e);var i=t.prototype;return i.initBossInfo=function(e){this._sprite=this.node.getChildByName("sprite"),this._bloodSprite=this.node.getChildByName("bloodProgressBg").getChildByName("bloodProgress").getComponent(f),this._bossId=e.id,this._rawSpeed=e.moveSpeed,this._curSpeed=e.moveSpeed,this._canMove=e.canMove,this._maxBlood=e.maxBlood,this._curBlood=e.maxBlood,this._normalDamage=e.normalDamage,this.initBossMoveAnim(e.id),this.updateBlood(0),this.initCollider(),this._isInitData=!0},i.initBossMoveAnim=function(e){var t=this;ce.dispatch("loadTheDirResources","/anim/enemy/boss/boss_"+e+"_move",(function(e){t._sprite.getComponent(m).defaultClip=e,t._sprite.getComponent(m).play()}))},i.initCollider=function(){var e=this._sprite.addComponent(v),t=this._sprite.getComponent(a),i=new y(t.contentSize.x,t.contentSize.y);e.tag=be.boss,e.size=i,e.group=Se.enemy,e.on(_.BEGIN_CONTACT,this.onBeginContact,this),e.on(_.END_CONTACT,this.onEndContact,this)},i.start=function(){this.checkupIsInitData()},i.checkupIsInitData=function(){if(!this._isInitData)throw"未初始化boss信息";console.log("初始化boss信息")},i.update=function(e){Pe.stopAll||(this.updateSpriteDirection(),this.moveToHero(e))},i.moveToHero=function(e){if(this._canMove){var t=ce.dispatch("getHeroWorldPos"),i=this.node.getWorldPosition(),o=t.x-i.x,n=t.y-i.y,a=Math.sqrt(o*o+n*n);if(a>=Me.minGapWithHero2){var r=a/this._curSpeed,s=e/r*o,l=e/r*n;this.node.setWorldPosition(i.x+s,i.y+l,0)}}},i.updateSpriteDirection=function(){var e=ce.dispatch("getHeroWorldPos").x-this.node.getChildByName("sprite").getWorldPosition().x,t=this.node.getChildByName("sprite").getScale();e>0?this.node.getChildByName("sprite").setScale(-Math.abs(t.x),t.y,t.z):e<0&&this.node.getChildByName("sprite").setScale(Math.abs(t.x),t.y,t.z)},i.accelerateToHero=function(e){var t=this;this.scheduleOnce((function(){t._curSpeed=t._rawSpeed}),e)},i.onBeginContact=function(e,t){if(!Pe.stopAll)switch(t.tag){case be.hero:this._isTouchHero=!0,this.bossAttackHeroByCollider(e,t);break;case be.friend1Skill1:this._isTouchFriend1Skill1=!0,this.friendAttackBossByFriend1Skill1(e,t);break;case be.darts:this.heroAttackBossByDarts()}},i.onEndContact=function(e,t){switch(t.tag){case be.hero:this._isTouchHero=!1;break;case be.spell:this._isTouchSpell=!1;break;case be.friend1Skill1:this._isTouchFriend1Skill1=!1}},i.bossAttackHeroByCollider=function(e,t){var i=this;if(!Pe.stopAll&&this._isTouchHero){var o=this._normalDamage;ce.dispatch("usingHeroControlFun","createBossDamageTex",-o);var n=Be["boss"+this._bossId];this.scheduleOnce((function(){i.bossAttackHeroByCollider(e,t)}),n)}},i.friendAttackBossByFriend1Skill1=function(e,t){var i=this;if(!Pe.stopAll&&this._isTouchFriend1Skill1){ce.dispatch("createDamageTex",e.node,5,{x:0,y:20}),this.updateBlood(-5,!1),this.collectToTarget(e,t),this.scheduleOnce((function(){i.friendAttackBossByFriend1Skill1(e,t)}),Be.f1s1)}},i.heroAttackBossByDarts=function(){console.log("boss被飞镖攻击 还没写")},i.updateBlood=function(e,t){void 0===t&&(t=!1),this._curBlood+=e,this._curBlood<=0?(this.unscheduleAllCallbacks(),this.node.destroy(),Pe.stopAll=!0,ce.dispatch("passStage")):t&&this.bossIsRepelled(),this._curBlood>this._maxBlood&&(this._curBlood=this._maxBlood),this._bloodSprite.fillRange=this._curBlood/this._maxBlood},i.getBloodPercentage=function(){return this._curBlood/this._maxBlood},i.bossIsRepelled=function(){var e=ce.dispatch("getHeroWorldPos"),t=this.node.getWorldPosition();t.subtract3f(e.x,e.y,e.z).normalize();var i=this.node.getPosition();this.node.setPosition(i.x+20*t.x,i.y+20*t.y,0)},i.collectToTarget=function(e,t){if(t){var i=t.node.getWorldPosition(),o=e.node.getWorldPosition();i.subtract3f(o.x,o.y,o.z).normalize();var n=this.node.getPosition();this.node.setPosition(n.x+20*i.x,n.y+20*i.y,0)}},i.getDistanceToHero=function(){var e=ce.dispatch("getHeroWorldPos"),t=this.node.getWorldPosition(),i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)},i.pauseAnim=function(){this._sprite.getComponent(m).pause()},i.resumeAnim=function(){this._sprite.getComponent(m).resume()},t}(d))||De);e._RF.pop(),e._RF.push({},"dd9c4pCzpdDAodMdKm5AUaB","PoolManager",void 0);var Fe,Ie,Re,He,Ne,Oe=new(function(){function e(){this.pools=void 0,this.prefabs=void 0,this.junkyard=void 0,this.pools={},this.prefabs={},this.junkyard=new b}var t=e.prototype;return t.addPoolToPools=function(e,t,i){this.pools[e]?console.warn("对象池"+e+"已存在"):(this.pools[e]=t,this.prefabs[e]=i,console.log("成功添加对象池"+e))},t.getFromPool=function(e,t){void 0===t&&(t=!1);var i=this.pools[e],o=this.prefabs[e];if(!i)return console.warn("对象池"+e+"不存在"),!1;if(!o)throw"预制件"+e+"不存在";var n=null;return i.size()>0?(n=i.get(),t&&console.log("从对象池获取"+e+"成功")):(n=r(o),t&&console.log("从对象池创建"+e+"成功")),n},t.putToPool=function(e,t,i){void 0===i&&(i=!1);var o=this.pools[e];if(!o)return console.warn(e+"对象池不存在,直接销毁"),void t.destroy();i&&console.log("将"+e+" "+t.uuid+"放入对象池"),o.put(t)},t.putToJunkyard=function(e,t){void 0===t&&(t=!1),t&&console.log("放入垃圾场"),this.junkyard.put(e)},t.showAllPoolsAndPrefab=function(){console.log("pools",this.pools),console.log("prefabs",this.prefabs)},t.clearAllNodePool=function(){for(var e in this.clearJunkyard(),this.pools){if(Object.prototype.hasOwnProperty.call(this.pools,e))this.pools[e].clear(),delete this.pools[e]}for(var t in this.prefabs)Object.prototype.hasOwnProperty.call(this.prefabs,t)&&delete this.prefabs[t];console.log("this.pools",this.pools),console.log("this.prefabs",this.prefabs)},t.clearJunkyard=function(){this.junkyard.clear()},e}());e._RF.pop(),e._RF.push({},"128f5xC/PJCIZMOXP3duFW3","Boss1",void 0);var Ee=t.ccclass,ze=t.property,We=(Fe=Ee("Boss1"),Ie=ze(S),Fe((Ne=Z((He=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"skillPrefab",Ne,j(t)),t._skillData={1:888,2:500,3:5e3,4:1500},t}J(t,e);var i=t.prototype;return i.onLoad=function(){Oe.addPoolToPools("greenThunder",new b,this.skillPrefab),this.initBossInfo({id:1,moveSpeed:200,canMove:!0,maxBlood:5e4,normalDamage:1500}),this.setBossStrategy()},i.usingSkillGreenThunder=function(){var e=Oe.getFromPool("greenThunder");e.getComponent("GreenThunder").init(this._skillData[1]);var t=ce.dispatch("getHeroWorldPos");e.parent=g("Canvas/bulletLayer"),e.setWorldPosition(t.x,t.y+100,t.y)},i.usingSkillPhotosynthesis=function(e){var t=this;console.log("开启光合作用"),this.node.getChildByName("photosynthesis").active=!0,this.unschedule(this.recoveryHealthy),this.schedule(this.recoveryHealthy,1,e),this.scheduleOnce((function(){t.node.getChildByName("photosynthesis").active=!1}),e)},i.recoveryHealthy=function(){this.updateBlood(this._skillData[3])},i.bossAttackHeroByCollider=function(e,t){var i=this;if(!Pe.stopAll&&this._isTouchHero){ce.dispatch("usingHeroControlFun","createBossDamageTex",-this._skillData[4]),this.usingNormalAttack();this.scheduleOnce((function(){i.bossAttackHeroByCollider(e,t)}),2)}},i.usingNormalAttack=function(){this._curSpeed=this._rawSpeed;var e=ce.dispatch("getHeroWorldPos"),t=this.node.getWorldPosition(),i=e.x-t.x,o=e.y-t.y,n=0,a={x:50,y:0},r=1;Math.abs(i)>Math.abs(o)?i<0&&(n=180,a.x=-50,r=-1):o>0?(n=90,a.x=0,a.y=50):(n=270,a.x=0,a.y=-50);var s=this.node.getChildByName("attack");s.angle=n,s.setPosition(a.x,a.y),s.setScale(1,r),s.getComponent(m).play()},i.usingSkillGreenThunderAllTheTime=function(e){var t=this;this.schedule((function(){t.usingSkillGreenThunder()}),e)},i.setBossStrategy=function(){this.usingSkillGreenThunderAllTheTime(5),this.schedule(this.isUsingSkillPhotosynthesis,1),this.schedule(this.isAccelerateToHero,1)},i.isUsingSkillPhotosynthesis=function(){var e=this;this.getBloodPercentage()<.33&&(this.usingSkillPhotosynthesis(15),this.unschedule(this.isUsingSkillPhotosynthesis),this.scheduleOnce((function(){e.schedule(e.isUsingSkillPhotosynthesis,1)}),30))},i.isAccelerateToHero=function(){var e=this.getDistanceToHero();if(e>2e3){this._curSpeed=this._skillData[2];var t=e/this._curSpeed;this.accelerateToHero(t)}},t}(xe)).prototype,"skillPrefab",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re=He))||Re);e._RF.pop(),e._RF.push({},"54a10/Onh9HBJIkeKY3XN7P","Queue",void 0);var Ue,qe=function(){function e(){this.list=[]}var t=e.prototype;return t.enqueue=function(e){this.list.push(e)},t.dequeue=function(){return this.empty()?(console.log("无法出队"),!1):this.list.shift()},t.front=function(){return this.empty()&&console.log("无法查看"),this.list[0]},t.back=function(){return this.empty()&&console.log("无法查看"),this.list[this.list.length-1]},t.toString=function(){return this.list.join("\n")},t.clear=function(){delete this.list,this.list=[]},t.empty=function(){if(0===this.list.length)return console.log("队列为空"),!0},e}();e._RF.pop(),e._RF.push({},"38559Ai7QdNXJgmM17rYiRi","Boss2",void 0);var Ge=t.ccclass;t.property,Ge("Boss2")(Ue=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._skillData={1:4444,2:600,3:2e4,4:5e3},t}J(t,e);var i=t.prototype;return i.onLoad=function(){Oe.addPoolToPools("greenThunder",new b,this.skillPrefab),this.initBossInfo({id:2,moveSpeed:250,canMove:!0,maxBlood:2e5,normalDamage:5e3}),this.setBossStrategy()},i.setBossStrategy=function(){this.usingSkillGreenThunderAllTheTime(2),this.schedule(this.isUsingSkillPhotosynthesis,1),this.schedule(this.isAccelerateToHero,1),this.schedule(this.usingSkillCollectionGT,10)},i.usingSkillCollectionGT=function(){var e=this;if(!Pe.stopAll){var t=20;if(t<=0)throw new Error("error");for(var i=new qe;t>0;){var o=Oe.getFromPool("greenThunder");i.enqueue(o),t--}this.schedule((function t(){if(!Pe.stopAll){var o=i.dequeue();if(o){o.getComponent("EnemySkill").init(e._skillData[1]);var n=ce.dispatch("getHeroWorldPos");o.parent=g("Canvas/bulletLayer"),o.setWorldPosition(n.x,n.y+100,n.y)}else e.unschedule(t)}}),.3)}},t}(We));e._RF.pop(),e._RF.push({},"449eazAx+VFQq/a5iitUUii","globalFun",void 0);var Je,Ve=function(e,t,i,o,n){if(void 0===n&&(n=""),e&&t&&i&&o){var a=new B;a.target=e,a.component=i,a.handler=o,a.customEventData=n;var r=t.getComponent(c);r||(r=t.addComponent(c)),r.clickEvents[0]=a}else console.log("参数错误 无法生成按钮 请重新设置")},je=function(e,t){if(t<4)throw"圆上点数过少 请输入大于4的数字";if(t%4!=0)throw"生成的在圆上的点的总数错误，不是4的倍数"+t;for(var i=t/4,o=[],n=1;n<i;n++){var a=e*Math.sin(Math.PI/180*n/i*90),r=Math.sqrt(e*e-a*a);o.push([r,a],[r,-a],[-r,a],[-r,-a])}return o.push([0,e],[0,-e],[e,0],[-e,0]),o};e._RF.pop(),e._RF.push({},"b6663v4MkRCBoa0Uv+wET6C","Boss3",void 0);var Qe,Ke=t.ccclass,Xe=(t.property,Ke("Boss3")(Je=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._skillData={darkParticle:{name:"darkParticle",damage:9999,duration:3,moveSpeed:500},maxMS:800},t._darkParticlePrefab=void 0,t._darkMaskPrefab=void 0,t._blackHolePrefab=void 0,t}J(t,e);var i=t.prototype;return i.onLoad=function(){this.initBossInfo({id:3,moveSpeed:250,canMove:!1,maxBlood:2e6,normalDamage:8888}),this._darkParticlePrefab=g("/atom",this.node),this._darkMaskPrefab=g("/darkMask",this.node),this._blackHolePrefab=g("/blackHole",this.node),Oe.addPoolToPools("darkParticle",new b,this._darkParticlePrefab),Oe.addPoolToPools("blackHole",new b,this._blackHolePrefab),this.setBossStrategy()},i.setBossStrategy=function(){this.schedule(this.usingDarkParticleCircle,4),this.schedule(this.usingDarkMask,5),this.schedule(this.usingBlackHole,10),this.schedule(this.usingDarkParticleTriangle,3)},i.usingDarkParticleCircle=function(){console.log("释放黑暗粒子");for(var e=je(100,20),t=0;t<20;t++){var i=Oe.getFromPool("darkParticle");i.active=!0,i.setPosition(0,0,0);var o=g("Canvas/bulletLayer");i.parent=o;var n=e[t],a={x:n[0]/100,y:n[1]/100},r=this.getFlyDir(a),s=this.node.getWorldPosition();s.x+=n[0],s.y+=n[1],i.setWorldPosition(s),i.getComponent("EnemySkill").init(this._skillData.darkParticle,r,.3)}},i.usingDarkParticleTriangle=function(){for(var e=this,t=this.getTriangleRow(5),i=new qe,o=t.length-1;o>=0;o--){for(var n=t[o],a=[],r=0;r<n.length;r++){var s=n[r],l=Oe.getFromPool("darkParticle");l.active=!0,l.setPosition(0,0,0),l.initPos=s,a.push(l)}i.enqueue(a)}this.schedule((function t(){if(!Pe.stopAll){var o=i.dequeue();if(o)for(var n,a=g("Canvas/bulletLayer"),r=K(o);!(n=r()).done;){var s=n.value;s.parent=a;var l=e.getDirToHero(),h=e.getFlyDir(l),c=e.node.getWorldPosition();c.x+=s.initPos[0],c.y+=s.initPos[1],s.setWorldPosition(c),s.getComponent("EnemySkill").init(e._skillData.darkParticle,h,.3)}else e.unschedule(t)}}),.2)},i.getDirToHero=function(){var e=this.node.getWorldPosition(),t=ce.dispatch("getHeroWorldPos"),i={x:0,y:0},o={x:t.x-e.x,y:t.y-e.y};if(0==o.x)i.x=0,i.y=Math.abs(o.y)/o.y;else if(0==o.y)i.x=Math.abs(o.x)/o.x,i.y=0;else{var n=Math.abs(o.x/o.y);n>=1?(i.x=Math.abs(o.x)/o.x,i.y=1/n*Math.abs(o.y)/o.y):(i.x=n*Math.abs(o.x)/o.x,i.y=Math.abs(o.y)/o.y)}return i},i.getTriangleRow=function(e){for(var t=0,i=0,o=[],n=0;n<e;n++){var a=n+1;o[n]=[];for(var r=0;r<a;r++)a%2==0?o[n].push([t+50*r-50*Math.floor(a/2)+25,i]):o[n].push([t+50*r-50*Math.floor(a/2),i])}return console.log("getTriangleRow2223333333333333332",o),o},i.getFlyDir=function(e){return new P(e.x,e.y)},i.usingDarkMask=function(){var e=r(this._darkMaskPrefab),t=ce.dispatch("getHeroWorldPos");e.parent=g("Canvas/bulletLayer"),e.setWorldPosition(t.x,t.y,t.y),e.getComponent("DarkMask").init(),e.active=!0},i.usingBlackHole=function(){var e=Oe.getFromPool("blackHole"),t=ce.dispatch("getHeroWorldPos");e.parent=g("Canvas/bulletLayer"),e.setWorldPosition(t.x,t.y,t.y),e.getComponent("BlackHole").init(),e.active=!0},i.isAccelerateToHero=function(){var e=this.getDistanceToHero();if(e>2e3){this._curSpeed=this._skillData.maxMS;var t=e/this._curSpeed;this.accelerateToHero(t)}},t}(xe))||Je);e._RF.pop(),e._RF.push({},"c4f9cQ1j5tAZrp9+Xp6yWpD","Boss4",void 0);var Ze,Ye,$e,et,tt,it,ot,nt,at,rt=t.ccclass;t.property,rt("Boss4")(Qe=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._skillData={darkParticle:{name:"darkParticle",damage:22222,duration:4,moveSpeed:600},maxMS:1e3},t}return J(t,e),t.prototype.onLoad=function(){this.initBossInfo({id:4,moveSpeed:300,canMove:!0,maxBlood:4e6,normalDamage:11111}),this._darkParticlePrefab=g("/atom",this.node),this._darkMaskPrefab=g("/darkMask",this.node),this._blackHolePrefab=g("/blackHole",this.node),Oe.addPoolToPools("darkParticle",new b,this._darkParticlePrefab),Oe.addPoolToPools("blackHole",new b,this._blackHolePrefab),this.setBossStrategy()},t}(Xe));e._RF.pop(),e._RF.push({},"b92c4+RU/xDHIkDN0zTFqvV","BossN",void 0);var st,lt,ht,ct,ut,dt,pt,gt,ft,mt,vt,yt=t.ccclass,_t=t.property;Ze=yt("BossN"),Ye=_t(S),$e=_t(C),et=_t(C),Ze((ot=Z((it=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"fireBall",ot,j(t)),X(t,"defaultMaterial",nt,j(t)),X(t,"fireBallMaterial",at,j(t)),t}J(t,e);var i=t.prototype;return i.onLoad=function(){var e=this,t=this.node.getComponent(a),i={size:new y(t.contentSize.x,t.contentSize.y),tag:be.boss,group:Se.enemy};this.initBossInfo({id:1,moveSpeed:200,canMove:!1,maxBlood:1e4},i),this.schedule((function(){e.usingSkillFireBall()}),2),console.log("BoxCollider2D",this.node.getComponent(v))},i.usingSkillFireBall=function(){var e=this,t=r(this.fireBall);t.parent=this.node,t.active=!0,t.getComponent(v).tag=be.fireBall,t.parent=g("Canvas/bulletLayer");var i=this.node.getWorldPosition(),o=ce.dispatch("getHeroWorldPos");t.setWorldPosition(i);var n=o.subtract3f(i.x,i.y,i.z).normalize(),a=new w(1e3*n.x,1e3*n.y,0);D(t).by(1,{position:a}).call((function(){t.getComponent(f).spriteFrame=null,t.setScale(2,2,1),t.getComponent(m).play(),t.getComponent(f).customMaterial=e.defaultMaterial,t.getComponent(v).tag=be.fireBallFire,e.scheduleOnce((function(){t.active=!1}),5)})).start()},t}(xe)).prototype,"fireBall",[Ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=Z(it.prototype,"defaultMaterial",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=Z(it.prototype,"fireBallMaterial",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=it));e._RF.pop(),e._RF.push({},"668ee8+QZZCoZGzSXap1See","Monster",void 0);var bt,St,Bt,Pt,Ct,wt,Dt,Lt=t.ccclass,kt=t.property,Tt=(st=Lt("Monster"),lt=kt(C),ht=kt(C),ct=kt(C),ut=kt(C),st((gt=Z((pt=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"flashWhiteMaterial",gt,j(t)),X(t,"defaultMaterial_normal",ft,j(t)),X(t,"defaultMaterial_green",mt,j(t)),X(t,"debuff_frozen",vt,j(t)),t._defaultMaterial=void 0,t._canAttack=!0,t._banTouch=!1,t._curMonsterData=null,t._maxBlood=1,t._curBlood=1,t._attackInterval=1,t._isSuperArmor=!1,t._type="normal",t._curMoveSpeedTimes=1,t._frontCount=0,t._behindCount=0,t._remainingDuration=0,t._diedAnimProgress=0,t._debuffList={timid:{state:!1,duration:0,damage:.5,moveSpeed:.5},frozen:{state:!1,duration:0,damage:0,moveSpeed:0}},t}J(t,e);var i=t.prototype;return i.init=function(e){"normal"==e.color?this._defaultMaterial=this.defaultMaterial_normal:this._defaultMaterial=this.defaultMaterial_green,this.recoveryDefaultMaterial(),this._curMonsterData=e,this.initMonsterMoveAnim(e),this._maxBlood=e.maxBlood,this._curBlood=e.maxBlood,this.initCollider(),this.startCountdown(120)},i.startCountdown=function(e){this._remainingDuration=e,this.unschedule(this.durationCountdown),this.schedule(this.durationCountdown,1)},i.durationCountdown=function(){Pe.stopAll||(this._remainingDuration--,this.runOthers(),this._remainingDuration<=0&&(Oe.putToPool("monsterChild",this.node),this.unschedule(this.durationCountdown)))},i.runOthers=function(){if(ce.dispatch("getMapLayerProperty","_frozenCountdown")>0){var e=.05*this._maxBlood|0,t=ce.dispatch("usingHeroControlFun","getCurDamage");t=Math.floor(.05*t)+e,ce.dispatch("createDamageTex",this.node,t,{x:0,y:20}),this.updateBlood(t)}},i.initMonsterMoveAnim=function(e){var t=this,i="monster"+e.animKey,o=ce.dispatch("getMonsterAnimByAnimKey",i);o?this.node.getComponent(m).defaultClip=o:ce.dispatch("loadTheDirResources","/anim/enemy/monster/"+i,(function(e){t.node.getComponent(m).defaultClip=e}))},i.initCollider=function(){var e=this.getComponent(v);e||(e=this.node.addComponent(v));var t=this.node.getComponent(a),i=new y(t.contentSize.x/2,t.contentSize.y/2);e.tag=be.monster,e.size=i,e.group=Se.enemy,e.on(_.BEGIN_CONTACT,this.onBeginContact,this)},i.updateBlood=function(e,t){void 0===t&&(t=0),ce.dispatch("playOneShot","battle/怪物受击"),this._curBlood+=e,this._curBlood<=0?this.monsterDied():this.monsterIsRepelled(t)},i.monsterDied=function(){Oe.putToPool("monsterChild",this.node),ce.dispatch("usingHeroControlFun","updateExpProgress",100),ce.dispatch("updateKillCountLabel",1),this.afterMonsterDied()},i.afterMonsterDied=function(){ce.dispatch("usingSkillManagerFun","add_bloodMakeMeStrongTimes");var e=ce.dispatch("usingSkillManagerFun","getRecoveryBloodFromSecretSkill");ce.dispatch("usingHeroControlFun","updateBloodProgress",e)},i.monsterIsRepelled=function(e){if(this.flashWhite(),!this._isSuperArmor){var t=ce.dispatch("getHeroWorldPos"),i=this.node.getWorldPosition();i.subtract3f(t.x,t.y,t.z).normalize();var o=this.node.getPosition();this.node.setPosition(o.x+e*i.x,o.y+e*i.y,0)}},i.getDistanceToHero=function(){var e=ce.dispatch("getHeroWorldPos"),t=this.node.getWorldPosition();return this.getTwoPointDistance(e,t)},i.flashWhite=function(){this.unschedule(this.recoveryNormalState),this.node.getComponent(f).material=this.flashWhiteMaterial;this._banTouch=!0,this.scheduleOnce(this.recoveryNormalState,.1)},i.frozenEffect=function(){this.node.getComponent(f).material=this.debuff_frozen,this.pauseAnim()},i.recoveryNormalState=function(){this._banTouch=!1,this._debuffList.frozen.state||(this.recoveryDefaultMaterial(),this.resumeAnim())},i.recoveryDefaultMaterial=function(){this.node.getComponent(f).material=this._defaultMaterial},i.collectToTarget=function(e,t){if(t){var i=t.node.getWorldPosition(),o=e.node.getWorldPosition();i.subtract3f(o.x,o.y,o.z).normalize();var n=this.node.getPosition();this.node.setPosition(n.x+20*i.x,n.y+20*i.y,0)}},i.recoveryDefault=function(){console.log("recoveryDefault")},i.isCollideObs=function(e,t){for(var i,o=ce.dispatch("usingMapLayerFun","getAllObs"),n=this.node.getWorldPosition(),a=this.node.getComponent(L),r=new k(a.worldAABB.x+e,a.worldAABB.y+t,a.worldAABB.width,a.worldAABB.height),s=K(o);!(i=s()).done;){var l=i.value,h=l.node.getWorldPosition();if(!this.getTwoPointDistance(n,h>300)&&this.rectIsIntersectsRect(r,l.worldAABB))return!0}return!1},i.move=function(e){if(!Pe.stopAll){var t=ce.dispatch("getHeroWorldPos");if(!this.isTouchingHero()&&0!=this._curMoveSpeedTimes){var i=this.node.getWorldPosition(),o=t.x-i.x,n=t.y-i.y,a=Math.sqrt(o*o+n*n),r=Me.minGapWithHero2;if("leader"==this._type&&(r*=5),a>=r){var s=this.getMonsterCurMoveSpeed(),l=0==s?0:a/s,h=0==l?0:e/l*o,c=0==l?0:e/l*n,u=this.dynamicAvoidCollider();if(u){var d=this.getNewDirWhenCollideObstacle(h,c,u);this.node.setWorldPosition(i.x+d.x*e,i.y+d.y*e,0)}else this.node.setWorldPosition(i.x+h,i.y+c,0)}}}},i.dynamicAvoidCollider=function(){for(var e,t=this.getComponent(v),i=ce.dispatch("getHeroWorldPos"),o=t.node.getWorldPosition(),n=K(ce.dispatch("getAllMonsterColliders"));!(e=n()).done;){var a=e.value;if(a!==t&&this.rectIsIntersectsRect(a.worldAABB,t.worldAABB))if(this.getTwoPointDistance(i,o)>this.getTwoPointDistance(i,a.node.getWorldPosition()))return a}for(var r,s=K(ce.dispatch("usingMapLayerFun","getAllObs"));!(r=s()).done;){var l=r.value;if(this.rectIsIntersectsRect(l.worldAABB,t.worldAABB))if(this.getTwoPointDistance(i,o)>this.getTwoPointDistance(i,l.node.getWorldPosition()))return l}return null},i.getTwoPointDistance=function(e,t){var i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)},i.getNewDirWhenCollideObstacle=function(e,t,i){var o=this._curMonsterData.moveSpeed*Me.MSCoefficient*this._curMoveSpeedTimes;e=0===e?0:Math.abs(e)/e*o,t=0===t?0:Math.abs(t)/t*o;var n=this.getComponent(v).worldAABB;if(0!==e&&0!==t){var a=new k(n.x+e,n.y,n.width,n.height);if(this.isCollideExceptRawCollider(a,i)){var r=new k(n.x,n.y+t,n.width,n.height);return this.isCollideExceptRawCollider(r,i)?{x:0,y:0}:{x:0,y:t}}return{x:e,y:0}}if(0===e&&0!==t){var s=t,l=-t,h=new k(n.x+s,n.y,n.width,n.height);if(this.isCollideExceptRawCollider(h,i)){var c=new k(n.x+l,n.y,n.width,n.height);return this.isCollideExceptRawCollider(c,i)?{x:0,y:0}:{x:l,y:0}}return{x:s,y:0}}if(0!==e&&0===t){var u=e,d=-e,p=new k(n.x,n.y+u,n.width,n.height);if(this.isCollideExceptRawCollider(p,i)){var g=new k(n.x,n.y+d,n.width,n.height);return this.isCollideExceptRawCollider(g,i)?{x:0,y:0}:{x:0,y:d}}return{x:0,y:u}}return{x:0,y:0}},i.isCollideExceptRawCollider=function(e,t){for(var i,o=this.getComponent(v),n=K(ce.dispatch("getAllMonsterColliders"));!(i=n()).done;){var a=i.value;if(a!==o&&this.rectIsIntersectsRect(a.worldAABB,e))return!0}for(var r,s=K(ce.dispatch("usingMapLayerFun","getAllObs"));!(r=s()).done;){var l=r.value;if(l!==t&&this.rectIsIntersectsRect(l.worldAABB,e))return!0}return!1},i.onBeginContact=function(e,t){if(!Pe.stopAll&&!this._banTouch&&e.tag!=t.tag)switch(t.tag){case be.hero:this.monsterAttackHeroByCollide(e,t);break;case be.friend1Skill1:this.friendAttackMonsterByFriend1Skill1(e,t);break;case be.obstacle:this.ejectMonsterInObstacle(e.worldAABB,t.worldAABB)}},i.rectIsIntersectsRect=function(e,t){return e.intersects(t)},i.isTouchingHero=function(){var e=this.getComponent(v),t=ce.dispatch("getHeroControlProperty","node").getChildByName("sprite").getComponent(v);return this.rectIsIntersectsRect(e.worldAABB,t.worldAABB)},i.monsterAttackHeroByCollide=function(e,t){var i=this;Pe.stopAll?this.scheduleOnce((function(){i._canAttack=!0,i.monsterAttackHeroByCollide(e,t)}),this._attackInterval):this.rectIsIntersectsRect(e.worldAABB,t.worldAABB)&&this._canAttack&&(this._canAttack=!1,ce.dispatch("createMonsterDamageTex",t.node,this.getMonsterCurDamage()),this.scheduleOnce((function(){i._canAttack=!0,i.monsterAttackHeroByCollide(e,t)}),this._attackInterval))},i.friendAttackMonsterByFriend1Skill1=function(e,t){var i=this;if(!Pe.stopAll&&this.rectIsIntersectsRect(e.worldAABB,t.worldAABB)){ce.dispatch("createDamageTex",e.node,5,{x:0,y:20}),this.updateBlood(-5,0),this.collectToTarget(e,t),this.scheduleOnce((function(){i.friendAttackMonsterByFriend1Skill1(e,t)}),Be.f1s1)}},i.update=function(e){this.move(e),this.updateSpriteDirection()},i.updateSpriteDirection=function(){if(!this._debuffList.frozen.state){var e=ce.dispatch("getHeroWorldPos").x-this.node.getWorldPosition().x,t=this.node.getScale();e>0?this.node.setScale(-Math.abs(t.x),t.y,t.z):e<0&&this.node.setScale(Math.abs(t.x),t.y,t.z)}},i.pauseAnim=function(){this.node.getComponent(m).pause()},i.resumeAnim=function(){Pe.stopAll||this._debuffList.frozen.state||this.node.getComponent(m).resume()},i.getMonsterCurDamage=function(){if(this._debuffList.frozen.state)return this._debuffList.frozen.damage;var e=this._curMonsterData.damage;return this._debuffList.timid.state&&(e*=this._debuffList.timid.damage),e},i.getMonsterCurMoveSpeed=function(){if(this._debuffList.frozen.state)return this._debuffList.frozen.moveSpeed;var e=this._curMonsterData.moveSpeed*Me.MSCoefficient*this._curMoveSpeedTimes;(this._debuffList.timid.state&&(e*=this._debuffList.timid.moveSpeed),ce.dispatch("getMapLayerProperty","_frozenCountdown")>0)&&(e*=1-ce.dispatch("getMapLayerProperty","_frozenSlowTimes"));return e},i.addDebuffTimid=function(e){if(e<=0)throw"addDebuffTimid err,t must > 0";this._debuffList.timid.state=!0,this._debuffList.timid.duration=e,this.unschedule(this.reduceDebuffTimid),this.scheduleOnce(this.reduceDebuffTimid,1)},i.reduceDebuffTimid=function(){Pe.stopAll||(this._debuffList.timid.duration--,this._debuffList.timid.duration<=0&&(this._debuffList.timid.state=!1,this.unschedule(this.reduceDebuffTimid)))},i.addDebuffFrozen=function(e){if(e<=0)throw"addDebuffTimid err,t must > 0";ce.dispatch("playOneShot","battle/frozen"),this._debuffList.frozen.state=!0,this._debuffList.frozen.duration=e,this.frozenEffect(),this.unschedule(this.reduceDebuffFrozen),this.schedule(this.reduceDebuffFrozen,1)},i.reduceDebuffFrozen=function(){Pe.stopAll||(this._debuffList.frozen.duration--,this._debuffList.frozen.duration<=0&&(console.log("解除冻结状态"),this._debuffList.frozen.state=!1,this.recoveryNormalState(),this.unschedule(this.reduceDebuffFrozen)))},i.ejectMonsterInObstacle=function(e,t){},t}(d)).prototype,"flashWhiteMaterial",[lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ft=Z(pt.prototype,"defaultMaterial_normal",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mt=Z(pt.prototype,"defaultMaterial_green",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=Z(pt.prototype,"debuff_frozen",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=pt))||dt);e._RF.pop(),e._RF.push({},"f31darYW99DxIBZWKvRFDZr","MonsterLeader",void 0);var Mt,At,xt,Ft,It,Rt,Ht,Nt,Ot,Et,zt,Wt,Ut,qt=t.ccclass,Gt=t.property;bt=qt("MonsterLeader"),St=Gt(S),Bt=Gt([C]),bt((wt=Z((Ct=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"fireBall",wt,j(t)),X(t,"leaderMaTerial",Dt,j(t)),t._strengthType=void 0,t}J(t,e);var i=t.prototype;return i.createLeader=function(e,t){this._type="leader";var i=JSON.parse(JSON.stringify(ce.dispatch("getMonsterDataById",e)));switch(this.setDefaultMaterialByType(t),t){case 0:this.createLeaderStrengthBlood(i);break;case 1:this.createLeaderStrengthMoveSpeed(i);break;case 2:this.createLeaderStrengthDamage(i);break;case 3:this.createLeaderSuperArmor(i);break;default:throw"未知的类型："+t}},i.setDefaultMaterialByType=function(e){var t=this.leaderMaTerial[e];if(!t)throw"type is "+e+" material is error";this._defaultMaterial=t,this.node.getComponent(f).material=this._defaultMaterial,console.log("setDefaultMaterialByType",this.node)},i.createLeaderStrengthBlood=function(e){this._strengthType="blood",console.log("创建强化血量精英怪"),e.maxBlood*=20,e.damage*=3,e.moveSpeed*=1.5,this.node.setScale(2,2),this.init(e)},i.createLeaderStrengthMoveSpeed=function(e){this._strengthType="moveSpeed",console.log("创建强化移速精英怪"),e.maxBlood*=5,e.damage*=2,e.moveSpeed*=3,this.node.setScale(1.2,1.2),this.init(e)},i.createLeaderStrengthDamage=function(e){this._strengthType="damage",console.log("创建强化伤害精英怪"),e.maxBlood*=10,e.damage*=5,e.moveSpeed*=1.5,this.node.setScale(1.5,1.5),this.init(e)},i.createLeaderSuperArmor=function(e){this._strengthType="superArmor",console.log("创建霸体精英怪"),this._isSuperArmor=!0,e.maxBlood*=10,e.damage*=2,e.moveSpeed*=2,this.node.setScale(1.5,1.5),this.init(e)},i.init=function(e){this._curMonsterData=e,this.initMonsterMoveAnim(e),this._maxBlood=2*e.maxBlood,this._curBlood=e.maxBlood,this._attackInterval*=.5,this.initCollider()},i.initCollider=function(){var e=this.getComponent(v);e||(e=this.node.addComponent(v));var t=this.node.getComponent(a),i=new y(t.contentSize.x,t.contentSize.y);e.tag=be.monster,e.size=i,e.group=Se.enemy,e.on(_.BEGIN_CONTACT,this.onBeginContact,this)},i.update=function(e){this.move(e),this.updateSpriteDirection()},i.dynamicAvoidCollider=function(){return null},i.monsterDied=function(){this.node.parent&&(Oe.putToPool("monsterLeader",this.node),ce.dispatch("updateLeaderCurTotal",-1),ce.dispatch("showKillLeaderReward",this._strengthType),ce.dispatch("usingHeroControlFun","updateExpProgress",200),ce.dispatch("updateKillCountLabel",1)),this.afterMonsterDied()},t}(Tt)).prototype,"fireBall",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=Z(Ct.prototype,"leaderMaTerial",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=Ct));e._RF.pop(),e._RF.push({},"64b4feS1jZCmaEd2+7cjaAo","MonsterManager",void 0);var Jt,Vt=t.ccclass,jt=t.property;Mt=Vt("MonsterManager"),At=jt(S),xt=jt(S),Ft=jt(T),It=jt(M),Rt=jt(s),Mt((Ot=Z((Nt=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"monsterChildPrefab",Ot,j(t)),X(t,"monsterLeaderPrefab",Et,j(t)),X(t,"monsterPropertiesJson",zt,j(t)),X(t,"animClip",Wt,j(t)),X(t,"monsterTotalLabel",Ut,j(t)),t._initPosList=null,t._monsterProperties={},t._monsterAnimClips={},t._createCount=0,t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("usingMonsterManagerFun"),ce.remove("createMonsterByOutsideData"),ce.remove("createMonsterLeader"),ce.remove("getMonsterTotal"),ce.remove("removeAllMonsters"),ce.remove("getMonsterDataById"),ce.remove("getMonsterAnimByAnimKey"),ce.remove("createMonsterDamageTex"),ce.remove("getAllMonsterColliders")},i.onLoad=function(){this.initAnimClips(),ce.add("usingMonsterManagerFun",this.usingMonsterManagerFun.bind(this)),ce.add("createMonsterByOutsideData",this.createMonsterByOutsideData.bind(this)),ce.add("createMonsterLeader",this.createMonsterLeader.bind(this)),ce.add("getMonsterTotal",this.getMonsterTotal.bind(this)),ce.add("removeAllMonsters",this.removeAllMonsters.bind(this)),ce.add("getMonsterDataById",this.getMonsterDataById.bind(this)),ce.add("getMonsterAnimByAnimKey",this.getMonsterAnimByAnimKey.bind(this)),ce.add("createMonsterDamageTex",this.createMonsterDamageTex.bind(this)),ce.add("getAllMonsterColliders",this.getAllMonsterColliders.bind(this));var e=new b,t=new b;Oe.addPoolToPools("monsterChild",e,this.monsterChildPrefab),Oe.addPoolToPools("monsterLeader",t,this.monsterLeaderPrefab),this._initPosList={up:{x:0,y:300},down:{x:0,y:-300},left:{x:-300,y:0},right:{x:300,y:0}},this.initMonsterProperties()},i.initAnimClips=function(){var e=this;ce.dispatch("loadTheDir","/anim/enemy/monster",(function(t){t.forEach((function(t){e._monsterAnimClips[t.name]=t}))}))},i.initMonsterProperties=function(){var e=this;this.monsterPropertiesJson.json.forEach((function(t){var i=t.id;e._monsterProperties[i]=t}))},i.start=function(){this.showMonsterTotal(1)},i.showMonsterTotal=function(e){var t=this;this.schedule((function(){var e=t.getMonsterTotal();t.monsterTotalLabel.string="怪物总数：\n"+e}),e)},i.createMonsterLeader=function(e,t){var i=Oe.getFromPool("monsterLeader");i.parent=g("Canvas/enemyLayer");var o=this.getRandomInitPos(),n=ce.dispatch("getHeroWorldPos");i.setWorldPosition(o.x+n.x,o.y+n.y,0),i.getComponent("MonsterLeader").createLeader(e,t)},i.getAllAroundWpList=function(e){var t={up:new w,down:new w,left:new w,right:new w};for(var i in t){var o=t[i];o.x=e.x+this._initPosList[i].x,o.y=e.y+this._initPosList[i].y,o.z=0}return t},i.createQueueCircle=function(e,t){if(t%4!=0)throw"生成的在圆上的点的总数错误，不是4的倍数"+t;for(var i=t/4,o=[],n=1;n<i;n++){var a=e*Math.sin(Math.PI/180*n/i*90),r=Math.sqrt(e*e-a*a);o.push([r,a],[r,-a],[-r,a],[-r,-a])}return o.push([0,e],[0,-e],[e,0],[-e,0]),o},i.createQueueHeart=function(e,t){if(t<20)throw"total过小，无法生成心形方程";var i=2*Math.PI/t;e/=16;for(var o=[];t;){var n=i*t,a=16*Math.pow(Math.sin(n),3),r=13*Math.cos(n)-5*Math.cos(2*n)-2*Math.cos(3*n)-Math.cos(4*n);a*=e,r*=e,o.push([a,r]),t--}return o},i.createMonsterByOutsideData=function(e,t,i){void 0===i&&(i=null),null==i&&(i=this.getRandomInitPos()),this.createMonsterQueue(e,t,i)},i.getRandomInitPos=function(){switch(this._createCount++,this._createCount%4){case 0:return{x:2*this._initPosList.up.x,y:2*this._initPosList.up.y};case 1:return{x:2*this._initPosList.down.x,y:2*this._initPosList.down.y};case 2:return{x:2*this._initPosList.left.x,y:2*this._initPosList.left.y};case 3:return{x:2*this._initPosList.right.x,y:2*this._initPosList.right.y};default:throw new Error("getRandomInitPos err")}},i.createMonsterQueue=function(e,t,i){var o=this;i=this.addRandomOffset(i),t.forEach((function(t){o.createMonster(e,t,i)}))},i.createMonster=function(e,t,i){var o=Oe.getFromPool("monsterChild");o.parent=this.node;var n=ce.dispatch("getHeroWorldPos");o.setWorldPosition(i.x+n.x+t[0],i.y+n.y+t[1],0),o.active=!0;var a=ce.dispatch("getMonsterDataById",e);o.getComponent("Monster").init(a)},i.addRandomOffset=function(e){if(0==e.x&&0!=e.y){var t=e.y;e.x+=Math.random()>.5?.5*t+Math.random()*t*.5|0:-(.5*t+Math.random()*t*.5|0)}else{if(0==e.x||0!=e.y)return e;var i=e.x;e.y+=Math.random()>.5?.5*i+Math.random()*i*.5|0:-(.5*i+Math.random()*i*.5|0)}return e},i.getMonsterTotal=function(){var e=0;return this.node.children.forEach((function(t){e++})),e},i.removeAllMonsters=function(){for(;this.node.children.length;){var e=this.node.children[0];e.removeFromParent(),Oe.putToJunkyard(e,!0)}},i.getMonsterDataById=function(e){if(this._monsterProperties.hasOwnProperty(e))return this._monsterProperties[e];throw"property "+e+" of _monsterProperties is null"},i.getMonsterAnimByAnimKey=function(e){return this._monsterAnimClips[e]},i.createMonsterDamageTex=function(e,t){ce.dispatch("getHeroControlProperty","_isDamageImmunity")||(ce.dispatch("createDamageTex",e,t,{x:0,y:50}),ce.dispatch("usingHeroControlFun","updateBloodProgress",-t))},i.getAllMonsterColliders=function(){var e=[];return this.node.children.forEach((function(t){if("monsterChild"==t.name){var i=t.getComponent(v);e.push(i)}})),e},i.getAllMonsterScript=function(){var e=[];return this.node.children.forEach((function(t){"monsterChild"==t.name?e.push(t.getComponent("Monster")):"monsterLeader"==t.name&&e.push(t.getComponent("MonsterLeader"))})),e},i.pauseAllAnim=function(){this.doSameThings("pauseAnim")},i.resumeAllAnim=function(){this.doSameThings("resumeAnim")},i.doSameThings=function(e){this.node.children.forEach((function(t){"monsterChild"==t.name?t.getComponent("Monster")[e]():"monsterLeader"==t.name?t.getComponent("MonsterLeader")[e]():t.components[0][e]()}))},i.usingMonsterManagerFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},t}(d)).prototype,"monsterChildPrefab",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Et=Z(Nt.prototype,"monsterLeaderPrefab",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zt=Z(Nt.prototype,"monsterPropertiesJson",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=Z(Nt.prototype,"animClip",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ut=Z(Nt.prototype,"monsterTotalLabel",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=Nt));e._RF.pop(),e._RF.push({},"ad080WTW8JAq6c5uR79Xh4x","EnemySkill",void 0);var Qt,Kt=t.ccclass,Xt=(t.property,Kt("EnemySkill")(Jt=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._skillName=void 0,t._damage=void 0,t._flyDir=void 0,t._moveSpeed=void 0,t._duration=1/0,t}J(t,e);var i=t.prototype;return i.init=function(e,t,i){void 0===i&&(i=1),this._skillName=e.name,this._damage=e.damage,this._duration=e.duration,this._moveSpeed=e.moveSpeed,this._flyDir=t,this.initCollider(i)},i.initCollider=function(e){void 0===e&&(e=1);var t=this.node.getComponent(v);t||(t=this.node.addComponent(v));var i=this.node.getComponent(a),o=new y(i.contentSize.x*e,i.contentSize.y*e);t.tag=be.enemySkill,t.size=o,t.group=Se.enemySkill,t.on(_.BEGIN_CONTACT,this.onBeginContact,this)},i.initCircleCollider=function(e){void 0===e&&(e=1);var t=this.node.getComponent(A);t||(t=this.node.addComponent(A));var i=this.node.getComponent(a),o=new y(i.contentSize.x*e,i.contentSize.y*e);t.tag=be.enemySkill,t.radius=o.x/2,t.group=Se.enemySkill,t.on(_.BEGIN_CONTACT,this.onBeginContact,this)},i.onBeginContact=function(e,t){t.tag===be.hero&&ce.dispatch("usingHeroControlFun","createBossDamageTex",-this._damage)},i.recoveryPrefab=function(){Oe.putToPool(this._skillName,this.node)},i.destroyPrefab=function(){this.node.destroy()},i.update=function(e){this.weaponMove(e),this.weaponDuration(e)},i.weaponMove=function(e){if(!Pe.stopAll&&this._flyDir&&0!=this._moveSpeed&&this._duration!=1/0){var t=e*this._moveSpeed,i=this._flyDir.x*t,o=this._flyDir.y*t;this.node.setPosition(this.node.getPosition().x+i,this.node.getPosition().y+o,0)}},i.weaponDuration=function(e){Pe.stopAll||(this._duration-=e,this._duration<=0&&this.recoveryPrefab())},t}(d))||Jt);e._RF.pop(),e._RF.push({},"983ef2TfytMIbhvzd5+h4RV","BlackHole",void 0);var Zt,Yt=t.ccclass;t.property,Yt("BlackHole")(Qt=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._touchHero=!1,t._attackInterval=.05,t._gravitationSpeed=100,t}J(t,e);var i=t.prototype;return i.init=function(){this._damage=1,this._skillName="blackHole",this._duration=15,this.initCircleCollider(),this.node.getComponent(A).on(_.END_CONTACT,this.onEndContact,this)},i.onBeginContact=function(e,t){var i=this;console.log("onBeginContact black hole"),t.tag===be.hero&&(this._touchHero=!0,this.scheduleOnce((function(){i.heroInBlackHole(t)}),this._attackInterval),console.log("进入黑洞"))},i.onEndContact=function(e,t){console.log("离开黑洞"),this._touchHero=!1},i.heroInBlackHole=function(e){var t=this;if(console.log("heroInBlackHole"),this._touchHero){var i=this.node.getWorldPosition(),o=ce.dispatch("getHeroWorldPos"),n=i.x-o.x,a=i.y-o.y,r=Math.sqrt(n*n+a*a),s=0==n?0:this._attackInterval/(r/this._gravitationSpeed)*n,l=0==a?0:this._attackInterval/(r/this._gravitationSpeed)*a;e.node.parent.setWorldPosition(o.x+s,o.y+l,o.z),ce.dispatch("usingHeroControlFun","updateBloodProgress",-this._damage),this.scheduleOnce((function(){t.heroInBlackHole(e)}),this._attackInterval)}},t}(Xt));e._RF.pop(),e._RF.push({},"5651evCO91NHb+szJiF4jVe","DarkMask",void 0);var $t,ei=t.ccclass;t.property,ei("DarkMask")(Zt=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(){this.initCollider()},i.onBeginContact=function(e,t){t.tag===be.hero&&ce.dispatch("usingHeroControlFun","addDebuffBanMove",2)},t}(Xt));e._RF.pop(),e._RF.push({},"fa205J2QNhCM6XEN0hsqKzD","GreenThunder",void 0);var ti,ii=t.ccclass;t.property,ii("GreenThunder")($t=function(e){function t(){return e.apply(this,arguments)||this}return J(t,e),t.prototype.init=function(e){this._skillName="greenThunder",this._damage=e,this.initCollider()},t}(Xt));e._RF.pop(),e._RF.push({},"3b59fGhdkFB26GOmbz41Qg5","CommonCallback",void 0);var oi,ni=t.ccclass;t.property,ni("CommonCallback")(ti=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.destroyAnim=function(){this.node.destroy(),console.log("销毁节点")},i.recoveryAnim=function(e){Oe.putToPool(e,this.node,!0)},t}(d));e._RF.pop(),e._RF.push({},"1d4f9s3vJFHb4UKLxz8L+zJ","GameAnimManager",void 0);var ai,ri,si,li,hi,ci,ui,di,pi,gi,fi,mi=t.ccclass;t.property,mi("GameAnimManager")(oi=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._animList=[],t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("usingGameAnimManagerFun")},i.onLoad=function(){ce.add("usingGameAnimManagerFun",this.usingGameAnimManagerFun.bind(this))},i.usingGameAnimManagerFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},i.addAnimToList=function(e){console.log("添加anim：",e),this._animList.push(e)},i.removeAnimFromList=function(e){var t=this._animList.indexOf(e);if(!(t>-1))throw"anim is not in list.";this._animList.splice(t,1)},i.pauseAllAnim=function(){console.log("暂停list中所有的动画"),this._animList.forEach((function(e){e.pause()}))},i.resumeAllAnim=function(){console.log("恢复所有list中的动画"),this._animList.forEach((function(e){e.resume()}))},t}(d));e._RF.pop(),e._RF.push({},"4e520BxXQJPQrigNDESbUJs","StageManager",void 0);var vi=t.ccclass,yi=t.property;ai=vi("StageManager"),ri=yi(T),si=yi(T),li=yi(T),hi=yi([S]),ai((di=Z((ui=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"stageConfigJson",di,j(t)),X(t,"leaderAndBossConfigJson",pi,j(t)),X(t,"rewardConfigJson",gi,j(t)),X(t,"bossPrefabs",fi,j(t)),t._curStageName=void 0,t._curStageTime=0,t._killCount=0,t._createCount=0,t._curData=void 0,t._stageConfig=void 0,t._bossConfig=void 0,t._rewardConfig=void 0,t._stageQueue=void 0,t._curLeaderTotal=0,t._killLeaderTotal=0,t._timeLabel=void 0,t._killCountLabel=void 0,t._monsterArmyConfig={stage1:{time:[30,60,90,120,180,200],queue:[9001,9001,9002,9002,9003,9003]},stage2:{time:[30,60,90,120,180,240,300,330],queue:[10001,10001,10002,10002,10003,10003,10004,10005]},stage3:{time:[30,60,90,120,180,240,300,330],queue:[10001,10002,10003,10003,10004,10004,10005,10006]},stage4:{time:[30,60,90,120,180,240,300,360,420,450],queue:[10001,10002,10003,10004,10005,10006,10007,10008,10009,10010]},stage5:{time:[30,60,90,120,180,240,300,360,420,450],queue:[10003,10004,10005,10006,10007,10008,10009,10009,10010,10010]}},t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("endStage"),ce.remove("passStage"),ce.remove("updateKillCountLabel"),ce.remove("updateLeaderCurTotal")},i.onLoad=function(){ce.add("endStage",this.endStage.bind(this)),ce.add("passStage",this.passStage.bind(this)),ce.add("updateKillCountLabel",this.updateKillCountLabel.bind(this)),ce.add("updateLeaderCurTotal",this.updateLeaderCurTotal.bind(this)),this._curStageName="stage"+Pe.curStage,this._stageConfig=this.stageConfigJson.json,this._bossConfig=this.leaderAndBossConfigJson.json[Pe.curStage-1],this._rewardConfig=this.rewardConfigJson.json,this._stageQueue=new qe,this.initStage(this._stageConfig[this._curStageName]),console.log(this._curStageName+":",this._stageConfig[this._curStageName]),this._timeLabel=g("Canvas/heroLayer/GameUILayer/expPar/curTime").getComponent(s),this._killCountLabel=g("Canvas/heroLayer/GameUILayer/expPar/curKillCount").getComponent(s)},i.start=function(){this.startStage()},i.initStage=function(e){console.log(e);for(var t=0;t<e.length;t++){var i=e[t];this._stageQueue.enqueue(i)}this._curData=this._stageQueue.dequeue()},i.startStage=function(){null!=this._curData?(console.log("data",this._curData),this._killCount=0,this._curStageTime=0,this.updateKillCountLabel(0),this.updateTimeLabel(),this.startStageTimer(),this.schedule(this.stageQueueTaskCallBack,this._curData.timeGap)):console.warn("_curData is null, stop startStage")},i.startStageTimer=function(){this.unschedule(this.stageTimerCallback),this._curStageTime=0,this.schedule(this.stageTimerCallback,1)},i.stageTimerCallback=function(){try{if(Pe.stopAll)return;this._curStageTime++,this.updateTimeLabel();var e=Pe.curStage%5==0?5:Pe.curStage%5,t=this._monsterArmyConfig["stage"+e];if(t){var i=t.time.indexOf(this._curStageTime);if(i>-1){var o=Me.queueMappingList[t.queue[i]],n=Me.queue[o];if(!n)return void console.warn("queue is error:",o);var a=this._curData.id[Math.random()*this._curData.id.length|0];ce.dispatch("createMonsterByOutsideData",a,n,{x:0,y:0})}}}catch(e){console.warn("stageTimerCallback error:",e)}},i.stageQueueTaskCallBack=function(){try{if(Pe.stopAll)return;if(this._curStageTime>this._curData.time)console.log("进入下一个阶段"),this._curData=this._stageQueue.dequeue(),this.unschedule(this.stageQueueTaskCallBack),this._curData?this.schedule(this.stageQueueTaskCallBack,this._curData.timeGap):this._bossConfig.bossId<0?this.passStage():(this.stopCreateMonster(),this.createBoss());else{if(!ce.eventIsDefined("getMonsterTotal"))return;if(ce.dispatch("getMonsterTotal")<this._curData.max)if(this._createCount++,this._createCount>this._bossConfig.startCount&&this._createCount%this._bossConfig.mod==0&&this._curLeaderTotal<this._bossConfig.maxTotal){var e=this._curData.id[Math.random()*this._curData.id.length|0],t=this._bossConfig.type[Math.random()*this._bossConfig.type.length|0];ce.dispatch("createMonsterLeader",e,t),this._curLeaderTotal++}else this.createMonsterByCurData()}}catch(e){console.warn("StageManager error (ignored on web):",e)}},i.distributeReward=function(e,t){void 0===t&&(t=!1),console.log("击杀怪物总数",this._killCount),console.log("击杀精英怪总数",this._killLeaderTotal),console.log("根据击杀 发放奖励");var i=this.getPassRewardContent(t);ce.dispatch("showPassReward",i,e),i.forEach((function(e){e.total>0&&ce.dispatch("addItemToSS",e.id,e.total)})),t&&Pe.curStage+1>Pe.stageProgress&&(Pe.stageProgress=Pe.curStage+1,ce.dispatch("savingGlobalDataToTempData"))},i.createMonsterByCurData=function(){var e=this.getIndexByRatio(this._curData.ratio),t=Me.queueMappingList[this._curData.queue[e]];if("circleR1000T20"!=t&&"heartR500T40"!=t){var i=Me.queue[t],o=Me.queueDir[t];if(i)if(o||null===o){var n=this._curData.id[Math.random()*this._curData.id.length|0];ce.dispatch("createMonsterByOutsideData",n,i,o)}else console.warn("找不到映射方向:",t);else console.warn("找不到映射队列:",t)}},i.getIndexByRatio=function(e){for(var t=Math.random(),i=0;i<e.length;i++){if(e[i]>=t)return i}console.warn("value均小于1，ratioArr 配置错误")},i.passStage=function(){this.stopCreateMonster(),this.distributeReward("通 关 奖 励",!0)},i.endStage=function(){console.log("关闭关卡"),this.stopCreateMonster(),this.distributeReward("击 杀 奖 励")},i.stopCreateMonster=function(){this.unschedule(this.stageQueueTaskCallBack),this.unschedule(this.stageTimerCallback),ce.dispatch("removeAllMonsters")},i.createBoss=function(){var e=this.bossPrefabs[this._bossConfig.bossId-1];if(!e)throw"prefab is undefined";r(e).parent=g("Canvas/enemyLayer")},i.updateTimeLabel=function(){this._timeLabel.string=" 时 间 ： "+this._curStageTime+" "},i.updateKillCountLabel=function(e){this._killCount+=e,this._killCountLabel.string=" 击 杀 ： "+this._killCount+" "},i.updateLeaderCurTotal=function(e){this._curLeaderTotal+=e,e<0&&(this._killLeaderTotal+=Math.abs(e))},i.getPassRewardContent=function(e){var t=this,i=this._rewardConfig[this._curStageName],o=[];i.monsterReward.forEach((function(e,n){for(var a=i.monsterRewardRatio[n],r=0,s=0;s<t._killCount;s++){Math.random()<=a&&r++}if(r>0){var l={id:e,total:r};o.push(l)}}));var n={id:3,total:Math.ceil(this._killCount*(i.lingshi.min+Math.random()*(i.lingshi.max-i.lingshi.min)))};return o.push(n),i.leaderReward.forEach((function(e,n){for(var a=i.leaderRewardRatio[n],r=0,s=0;s<t._killLeaderTotal;s++){Math.random()<=a&&r++}if(r>0){var l={id:e,total:r};o.push(l)}})),e&&i.passReward.forEach((function(e,t){var n=i.passRewardRatio[t];Math.random()<n&&o.push({id:e,total:1})})),console.log("rewardArr",o),o},t}(d)).prototype,"stageConfigJson",[ri],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pi=Z(ui.prototype,"leaderAndBossConfigJson",[si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gi=Z(ui.prototype,"rewardConfigJson",[li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fi=Z(ui.prototype,"bossPrefabs",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ci=ui));e._RF.pop(),e._RF.push({},"feea6/nvANI9aAqPuZStDYe","HttpRequest",void 0);var _i,bi,Si,Bi,Pi,Ci,wi,Di=new(function(){function e(){console.log("创建http请求")}var t=e.prototype;return t.get=function(e,t,i,o,n){void 0===o&&(o=null),void 0===n&&(n=null);var a=new XMLHttpRequest,r=t,s="?";for(var l in r){var h=l+"="+r[l];s+="?"==s?h:"&"+h}console.log("get:请求路径",e+s),a.open("GET",e+s),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),this.xhrBindCallback(a,i,o,n),a.send()},t.post=function(e,t,i,o,n){if("object"!=typeof t)return console.log("参数不是对象 传输错误");var a=new XMLHttpRequest;console.log("post:请求路径",e),a.open("POST",e),a.setRequestHeader("Content-Type","application/json"),this.xhrBindCallback(a,i,o,n),console.log(t),a.send(JSON.stringify(t))},t.xhrBindCallback=function(e,t,i,o){var n=this;e.onreadystatechange=function(){if(4==e.readyState)if(e.status>=200&&e.status<=207){var i=JSON.parse(e.responseText);console.log("bug"),t?t(i):n.runDefaultCompleteCallback(i)}else console.log("xhr.status",e.status)},e.onerror=function(){1==e.readyState&&0==e.status?i?i("断网"):n.runDefaultErrorCallback("断网"):i?i("未知错误"):n.runDefaultErrorCallback("未知错误")},e.timeout=6e4,e.ontimeout=function(e){o?o(e):n.runDefaultTimeoutCallback(e)}},t.runDefaultCompleteCallback=function(e){console.log("run Default Complete Callback"),console.log("response",e)},t.runDefaultErrorCallback=function(e){console.log("run Default Error Callback"),console.log("string",e)},t.runDefaultTimeoutCallback=function(e){console.log("run default timeout callback"),console.log("e",e)},e}());e._RF.pop(),e._RF.push({},"96d97NdVelLaJt7lq+g3AHt","FriendControl",void 0);var Li,ki=t.ccclass,Ti=t.property;_i=ki("FriendControl"),bi=Ti(i),Si=Ti(S),_i((Ci=Z((Pi=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"friend1",Ci,j(t)),X(t,"f1s1",wi,j(t)),t}J(t,e);var i=t.prototype;return i.start=function(){var e=this;this.schedule((function(){e.friend1UsingSkill1()}),1)},i.friend1UsingSkill1=function(){if(!this.friend1||!this.friend1.active)return console.log("friend 不存在 或未激活");var e=r(this.f1s1),t=this.friend1.getWorldPosition(),i=40,n=25,a=g("Canvas/bulletLayer");e.parent=a,e.setWorldPosition(t.x+i,t.y+n,0);var s=D().by(2,{position:{x:500,y:-500,z:0},angle:-3600}),l=D().to(1,{scale:{x:2,y:2,z:1}},{onUpdate:function(e,t){var i=e.getComponent(f).color;e.getComponent(f).color=o.lerp(new o,i,new o(i.r,i.g,i.b,255),t)}});D(e).parallel(s,l).call((function(){e.destroy()})).start()},i.update=function(e){},t}(d)).prototype,"friend1",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wi=Z(Pi.prototype,"f1s1",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bi=Pi));e._RF.pop(),e._RF.push({},"5519573lqJDRowrqZ0eN66i","HeroCollider",void 0);var Mi=t.ccclass;t.property,Mi("HeroCollider")(Li=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._touchFireBallFire=!1,t}J(t,e);var i=t.prototype;return i.start=function(){this.openCollider()},i.openCollider=function(){var e=this.getComponent(v);e||(e=this.node.addComponent(v));var t=this.node.getComponent(a),i=new y(t.contentSize.x,t.contentSize.y);e.tag=be.hero,e.size=i,e.group=Se.self,e.on(_.BEGIN_CONTACT,this.onBeginContact,this),e.on(_.END_CONTACT,this.onEndContact,this)},i.onBeginContact=function(e,t){switch(t.tag){case be.fireBall:this.fireBallAttackHero();break;case be.fireBallFire:this._touchFireBallFire=!0,this.fireBallFireAttackHero();break;case be.obstacle:console.log("碰撞障碍物 未处理");break;default:if([be.boss,be.monster,be.enemySkill].indexOf(t.tag)>-1)break;throw new Error("未处理的碰撞开始："+e.tag+"与"+t.tag+"发生碰撞")}},i.onEndContact=function(e,t){switch(t.tag){case be.fireBallFire:this._touchFireBallFire=!1;break;default:var i=be;if([i.boss,i.monster,i.fireBall,i.enemySkill,i.obstacle].indexOf(t.tag)>-1)break;throw new Error("未处理的碰撞结束："+e.tag+"与"+t.tag+"发生碰撞")}},i.fireBallAttackHero=function(){if(!Pe.stopAll){ce.dispatch("usingHeroControlFun","createBossDamageTex",-10)}},i.fireBallFireAttackHero=function(){var e=this;if(!Pe.stopAll&&this._touchFireBallFire){ce.dispatch("usingHeroControlFun","createBossDamageTex",-8);this.scheduleOnce((function(){e.fireBallFireAttackHero()}),.5)}},t}(d));e._RF.pop(),e._RF.push({},"0208bjby31EyYWzQE6+eHxF","LevelManager",void 0);var Ai,xi,Fi,Ii,Ri,Hi,Ni,Oi,Ei,zi,Wi,Ui,qi,Gi,Ji,Vi,ji,Qi,Ki,Xi=function(){function e(e){this.level=void 0,this.maxLevel=void 0,this.curExp=void 0,this.maxExp=void 0,this.levelMappingExpList=void 0,this.level=e.level,this.maxLevel=e.maxLevel,this.curExp=e.curExp,this.levelMappingExpList=e.levelMappingExpList,this.maxExp=this.levelMappingExpList[this.maxLevel-1].exp,console.log("levelManager",this)}var t=e.prototype;return t.addExp=function(e){return console.log("this.curExp ",this.curExp),console.log("this.maxExp  ",this.maxExp),console.log("num",e),this.curExp>=this.maxExp||this.level>=this.maxLevel?console.log("经验已满"):(this.curExp+=e,this.curExp>=this.maxExp&&(this.curExp=this.maxExp),this.isUpgrade()?(this.upgrade(),!0):void 0)},t.isUpgrade=function(){return this.curExp>=this.levelMappingExpList[this.level].exp},t.upgrade=function(){for(var e,t=this.maxLevel,i=this.level+1;i<t;i++){var o=this.levelMappingExpList[i-1].exp;if(o>this.curExp){e=i-1;break}i==t-1&&o<=this.curExp&&(e=this.maxLevel)}var n=e-this.level;this.level=e,console.log("等级+"+n)},t.getExpProgress=function(){if(1==this.level)return this.curExp/this.levelMappingExpList[this.level].exp;var e=this.levelMappingExpList[this.level-1].exp,t=this.levelMappingExpList[this.level-0].exp;return(this.curExp-e)/(t-e)},e}();e._RF.pop(),e._RF.push({},"4ed82YzdmNLu7le/hYjoBZp","HeroControl",void 0);var Zi,Yi=t.ccclass,$i=t.property;Ai=Yi("HeroControl"),xi=$i(f),Fi=$i(f),Ii=$i(i),Ri=$i(f),Hi=$i(T),Ni=$i(T),Oi=$i(s),Ei=$i(i),Ai((Ui=Z((Wi=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"bloodSprite",Ui,j(t)),X(t,"shieldSprite",qi,j(t)),X(t,"heroSprite",Gi,j(t)),X(t,"expProgress",Ji,j(t)),X(t,"expDataJson",Vi,j(t)),X(t,"heroPropertyDataJson",ji,j(t)),X(t,"lvDescription",Qi,j(t)),X(t,"GameUILayer",Ki,j(t)),t._spriteAnim=void 0,t._heroData=void 0,t._expData=void 0,t._curDirection={x:0,y:0},t._canMove=!1,t._LM=void 0,t._WM=void 0,t._baseBlood=void 0,t._bonusBlood=void 0,t._curBlood=void 0,t._maxShield=0,t._curShield=0,t._baseMoveSpeed=void 0,t._bonusMoveSpeed=void 0,t._baseDamage=void 0,t._bonusDamage=void 0,t._criticalHitRate=void 0,t._bonusCriticalHitRate=void 0,t._bonusBulletTotal=0,t._bonusBulletMoveSpeed=0,t._bonusBulletDuration=0,t._bonusBulletAttackTimes=0,t._recoveryHealthy=0,t._expAddition=0,t._divineStoneAddition=0,t._moveSpeedTimes=1,t._changeHeroMoveSpeedCountdown=0,t._tempCriticalHitRate=0,t._isDamageImmunity=!1,t._percentageDamage=void 0,t._percentageBlood=void 0,t._percentageMoveSpeed=void 0,t._bonusPercentageDamage=void 0,t._bonusPercentageBlood=void 0,t._bonusPercentageMoveSpeed=void 0,t._trackDisappearCountdown=0,t._openAutoScript=!1,t._deBuffList={banMove:!1},t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("getHeroWorldPos"),ce.remove("usingHeroControlFun"),ce.remove("getHeroControlProperty"),x.off(F.EventType.TOUCH_START,this.touchStart,this),x.off(F.EventType.TOUCH_MOVE,this.touchMove,this),x.off(F.EventType.TOUCH_END,this.touchEnd,this)},i.onLoad=function(){ce.add("getHeroWorldPos",this.getHeroWorldPos.bind(this)),ce.add("usingHeroControlFun",this.usingHeroControlFun.bind(this)),ce.add("getHeroControlProperty",this.getHeroControlProperty.bind(this)),x.on(F.EventType.TOUCH_START,this.touchStart,this),x.on(F.EventType.TOUCH_MOVE,this.touchMove,this),x.on(F.EventType.TOUCH_END,this.touchEnd,this),this.initHeroData(),this.initComponents(),this.initOutScripts(),this._curDirection={x:0,y:0},this.schedule(this.continueRecoveryHealthy,1)},i.openPhysicalDraw=function(){I.instance.enable=!0,I.instance.debugDrawFlags=R.Aabb|R.Pair|R.CenterOfMass|R.Joint|R.Shape},i.initHeroData=function(){this._heroData=this.heroPropertyDataJson.json[0],this.initExpData(),this.initHeroDataByLv(),this.updateBloodProgress(0)},i.initExpData=function(){this._expData=this.expDataJson.json;var e={level:1,maxLevel:this._expData.length,curExp:0,levelMappingExpList:this._expData};this._LM=new Xi(e),this.lvDescription.string="LV:"+this._LM.level},i.initHeroDataByLv=function(){console.log("hero data",this._heroData),this._baseBlood=ce.dispatch("usingHeroBasePropertyFun","getTrainingData","blood"),this._baseMoveSpeed=ce.dispatch("usingHeroBasePropertyFun","getTrainingData","moveSpeed"),this._baseMoveSpeed+=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","moveSpeed"),this._baseDamage=ce.dispatch("usingHeroBasePropertyFun","getTrainingData","damage"),this._percentageBlood=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","percentageBlood"),this._percentageDamage=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","percentageDamage"),this._percentageMoveSpeed=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","percentageMoveSpeed"),this._criticalHitRate=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","criticalHitRate"),this._bonusBulletTotal=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","bonusBulletTotal"),this._bonusBulletMoveSpeed=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","bonusBulletMoveSpeed"),this._bonusBulletDuration=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","bonusBulletDuration"),this._bonusBulletAttackTimes=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","bonusBulletAttackTimes"),this._recoveryHealthy=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","recoveryHealthy"),this._expAddition=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","expAddition")/100,this._divineStoneAddition=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty","divineStoneAddition")/100,this._bonusBlood=0,this._bonusMoveSpeed=0,this._bonusDamage=0,this._bonusCriticalHitRate=0,this._bonusPercentageBlood=0,this._bonusPercentageMoveSpeed=0,this._bonusPercentageDamage=0,this._curBlood=this.getMaxBlood(),this.updateBloodProgress(0),console.log("initHeroDataByLv",this)},i.getHeroPropertiesDes=function(){var e="基础血量："+this._baseBlood+"\n",t="基础移速："+this._baseMoveSpeed+"\n",i="基础伤害："+this._baseDamage+"\n",o="基础暴击率："+this._criticalHitRate+"\n",n="血量百分比加成："+this._percentageBlood+"\n",a="伤害百分比加成："+this._percentageDamage+"\n",r="移速百分比加成："+this._percentageMoveSpeed+"\n",s="额外血量："+this._bonusBlood+"\n",l="额外移速："+this._bonusMoveSpeed+"\n",h="额外伤害："+this._bonusDamage+"\n",c="额外暴击率："+this._bonusCriticalHitRate+"\n",u="额外血量百分比加成："+this._bonusPercentageBlood+"\n",d="额外移速百分比加成："+this._bonusPercentageMoveSpeed+"\n",p="额外伤害百分比加成："+this._bonusPercentageDamage+"\n",g="临时暴击率："+this._tempCriticalHitRate+"\n";return"当前血量："+this._curBlood+"/"+this.getMaxBlood()+"\n"+("当前护盾："+this._curShield+"\n")+("当前伤害："+this.getCurDamage()+"\n")+("当前移速："+this.getCurMoveSpeed()+"\n")+("当前暴击率："+this.getCurCHR()+"\n")+e+t+i+o+n+a+r+s+l+h+c+u+d+p+g},i.initComponents=function(){this._spriteAnim=g("sprite",this.node).getComponent(m)},i.initOutScripts=function(){this._WM=g("weapon",this.node).getComponent("WeaponManager")},i.update=function(e){this.heroMoveControl(e)},i.heroMoveControl=function(e){if(this._canMove&&!Pe.stopAll){var t=this._curDirection;ce.dispatch("usingMapLayerFun","updateMap",t);var i=this.getCurMoveSpeed(),o=this.isCollideObs(t.x*e*i,t.y*e*i);o?this.node.setPosition(this.node.position.x+o.x,this.node.position.y+o.y):this.node.setPosition(this.node.position.x+t.x*e*i,this.node.position.y+t.y*e*i)}},i.isCollideObs=function(e,t){for(var i,o=ce.dispatch("usingMapLayerFun","getAllObs"),n=this.heroSprite.getWorldPosition(),a=this.heroSprite.getComponent(L),r=new k(a.worldAABB.x+e,a.worldAABB.y+t,a.worldAABB.width,a.worldAABB.height),s=K(o);!(i=s()).done;){var l=i.value,h=l.node.getWorldPosition();if(!this.getTwoPointDistance(n,h>300)&&this.rectIsIntersectsRect(r,l.worldAABB)){if(0!==e&&0!==t)return r=new k(a.worldAABB.x+e,a.worldAABB.y,a.worldAABB.width,a.worldAABB.height),this.rectIsIntersectsRect(r,l.worldAABB)?(r=new k(a.worldAABB.x,a.worldAABB.y+t,a.worldAABB.width,a.worldAABB.height),!this.rectIsIntersectsRect(r,l.worldAABB)&&{x:0,y:t}):{x:e,y:0};if(0===e&&0!==t){if(r=new k(a.worldAABB.x,a.worldAABB.y+t,a.worldAABB.width,a.worldAABB.height),!this.rectIsIntersectsRect(r,l.worldAABB))return{x:0,y:t}}else{if(0===e||0!==t)return!1;if(r=new k(a.worldAABB.x+e,a.worldAABB.y,a.worldAABB.width,a.worldAABB.height),!this.rectIsIntersectsRect(r,l.worldAABB))return{x:e,y:0}}}}return!1},i.getTwoPointDistance=function(e,t){var i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)},i.rectIsIntersectsRect=function(e,t){return e.intersects(t)},i.changeMoveState=function(e){this._canMove=e},i.touchStart=function(){console.log("touchStart"),this._canMove=!0},i.touchMove=function(e){var t=e.touch.getStartLocation(),i=e.touch.getLocation(),o={x:void 0,y:void 0};o.x=i.x-t.x,o.y=i.y-t.y,0==o.x&&0==o.y||this.setDirByTouchOffset(o)},i.touchEnd=function(){console.log("touchEnd"),this._canMove=!1},i.setDirByTouchOffset=function(e){if(0==e.x)this._curDirection.x=0,this._curDirection.y=Math.abs(e.y)/e.y;else if(0==e.y)this._curDirection.x=Math.abs(e.x)/e.x,this._curDirection.y=0;else{var t=Math.abs(e.x/e.y);t>=1?(this._curDirection.x=Math.abs(e.x)/e.x,this._curDirection.y=1/t*Math.abs(e.y)/e.y):(this._curDirection.x=t*Math.abs(e.x)/e.x,this._curDirection.y=Math.abs(e.y)/e.y)}this._curDirection.x<=0?this.heroSprite.setScale(1,1,1):this.heroSprite.setScale(-1,1,1)},i.continueRecoveryHealthy=function(){Pe.stopAll||this.updateBloodProgress(this._recoveryHealthy)},i.usingHeroControlFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},i.getHeroControlProperty=function(e){if(this.hasOwnProperty(e))return this[e];throw"hero control 中不存在属性："+e},i.pauseGame=function(){this._spriteAnim.pause(),Pe.stopAll=!0,ce.dispatch("usingMonsterManagerFun","pauseAllAnim"),ce.dispatch("usingGameAnimManagerFun","pauseAllAnim")},i.resumeGame=function(){g("Canvas/heroLayer/GameUILayer/passRewardLayer").active||(this._spriteAnim.resume(),Pe.stopAll=!1,ce.dispatch("usingMonsterManagerFun","resumeAllAnim"),ce.dispatch("usingGameAnimManagerFun","resumeAllAnim"))},i.getHeroWorldPos=function(){return this.heroSprite.getWorldPosition()},i.getRandomPosNearHero=function(e){void 0===e&&(e=200);var t=this.heroSprite.getWorldPosition(),i=Math.random()*e|0,o=Math.random()*e|0;return i=Math.random()>.5?i:-i,o=Math.random()>.5?o:-o,{x:t.x+i,y:t.y+o}},i.updatePercentageBloodProgress=function(e){var t=this.getMaxBlood()*e;this.updateBloodProgress(t)},i.updateBloodProgress=function(e){e<0&&this._curShield>0?this.updateShieldProgress(e):(e<0&&ce.dispatch("usingSkillManagerFun","resetLikeWindMoveTimes"),this._curBlood+=e,this._curBlood<0&&(this._curBlood=0,this.showGameOver()),this._curBlood>this.getMaxBlood()&&(this._curBlood=this.getMaxBlood()),this.bloodSprite.fillRange=this._curBlood/this.getMaxBlood())},i.updateShieldProgress=function(e){this._curShield+=e,this._curShield>0?this.shieldSprite.fillRange=this._curShield/this._maxShield:(this._curShield=0,this.shieldSprite.node.parent.active=!1,e-=this._curShield,this.updateBloodProgress(e))},i.openShield=function(e){this._maxShield=e,this._curShield=this._maxShield,this.shieldSprite.fillRange=this._curShield/this._maxShield,this.shieldSprite.node.parent.active=!0},i.showGameOver=function(){Pe.stopAll=!0,this._WM.isUsingSword(!1),this._spriteAnim.stop(),ce.dispatch("endStage")},i.updateExpProgress=function(e){e*=1+this._expAddition,this._LM.addExp(e)&&(this.selectUpgradeReward(),this.updateBloodProgress(0));var t=this._LM.getExpProgress();this.expProgress.fillRange=t},i.selectUpgradeReward=function(){this.lvDescription.string="LV:"+this._LM.level,this.pauseGame(),g("selectWeapon",this.GameUILayer).active=!0,ce.dispatch("updateSelectWeapon")},i.isPlayHeroAnim=function(e){e?(this._spriteAnim.resume(),console.log("继续播放")):(this._spriteAnim.pause(),console.log("停止播放"))},i.createBossDamageTex=function(e){this._isDamageImmunity||(ce.dispatch("createDamageTex",this.node,e,{x:0,y:50}),this.updateBloodProgress(e))},i.restartGame=function(){Pe.stopAll=!1,H.restart()},i.updateBonusValue=function(e,t){console.log("刷新额外属性 ,还没写");var i="",o={1:.01,2:.02,3:.03,4:.04,5:.05};switch(e){case"blood":this._bonusPercentageBlood+=o[t],this._bonusPercentageBlood=(100*this._bonusPercentageBlood|0)/100;var n=(this._baseBlood+this._bonusBlood)*o[t]|0;this.updateBloodProgress(n),i="血量+"+100*o[t]+"%";break;case"damage":this._bonusPercentageDamage+=o[t],this._bonusPercentageDamage=(100*this._bonusPercentageDamage|0)/100,i="伤害+"+100*o[t]+"%";break;case"moveSpeed":this._bonusPercentageMoveSpeed+=o[t],this._bonusPercentageMoveSpeed=(100*this._bonusPercentageMoveSpeed|0)/100,i="移速+"+100*o[t]+"%";break;case"superArmor":this._bonusPercentageBlood+=o[t],this._bonusPercentageBlood=(100*this._bonusPercentageBlood|0)/100;var a=(this._baseBlood+this._bonusBlood)*o[t]|0;this.updateBloodProgress(a),i+="血量+"+100*o[t]+"%",this._bonusPercentageDamage+=o[t],this._bonusPercentageDamage=(100*this._bonusPercentageDamage|0)/100,i+="伤害+"+100*o[t]+"%";break;default:throw"strength type is error"}return i},i.openDamageImmunity=function(){this._isDamageImmunity=!0},i.getMaxBlood=function(){return(this._baseBlood+this._bonusBlood)*(1+this._bonusPercentageBlood+this._percentageBlood)|0},i.getCurMoveSpeed=function(){return this._deBuffList.banMove?0:(this._baseMoveSpeed+this._bonusMoveSpeed)*(this._moveSpeedTimes+this._bonusPercentageMoveSpeed+this._percentageMoveSpeed)+(0|ce.dispatch("usingSkillManagerFun","getMoveSpeedFromSecretSkill"))},i.getCurDamage=function(){var e=this._baseDamage+this._bonusDamage,t=ce.dispatch("usingSkillManagerFun","getDamageValueFromSecretSkill"),i=ce.dispatch("usingSkillManagerFun","getPercentageDamageFromSecretSkill"),o=(e+t)*(1+this._bonusPercentageDamage+this._percentageDamage+i);return parseInt(o.toFixed())},i.getCurCHR=function(){return this._criticalHitRate+this._tempCriticalHitRate+this._bonusCriticalHitRate},i.isCriticalHit=function(){return 100*Math.random()<this.getCurCHR()},i.addDebuffBanMove=function(e){var t=this;console.log("addDebuffSlow"),this._deBuffList.banMove=!0;this.schedule((function i(){Pe.stopAll||--e<=0&&(t.unschedule(i),t._deBuffList.banMove=!1)}),1)},i.changeHeroMoveSpeed=function(e,t){this._moveSpeedTimes=e,this._changeHeroMoveSpeedCountdown=t,this.schedule(this.changeHeroMoveSpeedCountdownRun,1)},i.changeHeroMoveSpeedCountdownRun=function(){this._changeHeroMoveSpeedCountdown--,this._changeHeroMoveSpeedCountdown<=0&&(this._moveSpeedTimes=1,this._changeHeroMoveSpeedCountdown=0)},i.updateTempCriticalHitRate=function(e){this._tempCriticalHitRate+=e},i.updateBonusCriticalHitRate=function(e){this._bonusCriticalHitRate+=e},i.updateBonusMoveSpeed=function(e){this._bonusMoveSpeed+=e},i.isOpenCollectGas=function(e){g("effect/collectGasEffect",this.node).active=e},i.isOpenSnowEffect=function(e){g("effect/snowEffect",this.node).active=e},i.usingSkillTrackDisappear=function(e){this._trackDisappearCountdown=30,this._isDamageImmunity=!0,this._spriteAnim.play("trackDisappear"),this.unschedule(this.trackDisappearSchedule),this.schedule(this.trackDisappearSchedule,1)},i.trackDisappearSchedule=function(){Pe.stopAll||(this._trackDisappearCountdown--,this._trackDisappearCountdown<=0&&(this._isDamageImmunity=!1,this._spriteAnim.play("heroMove1"),this.node.getChildByName("sprite").getComponent(f).color=new o(255,255,255,255)))},i.usingSkillLionRoar=function(){var e=ce.dispatch("usingMonsterManagerFun","getAllMonsterScript"),t=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","怒狮狂吼");e.forEach((function(e){e.getDistanceToHero()<300&&(e.monsterIsRepelled(150),e.addDebuffTimid(t.duration))}))},i.usingSkillIceShield=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","iceShield"),t=this.getMaxBlood()*e.damageTimes;this.openShield(t)},i.openHangupTest=function(){this._openAutoScript=!0,ce.dispatch("usingWeaponManagerFun","usingMaxLvWeapon")},t}(d)).prototype,"bloodSprite",[xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qi=Z(Wi.prototype,"shieldSprite",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gi=Z(Wi.prototype,"heroSprite",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ji=Z(Wi.prototype,"expProgress",[Ri],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vi=Z(Wi.prototype,"expDataJson",[Hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji=Z(Wi.prototype,"heroPropertyDataJson",[Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi=Z(Wi.prototype,"lvDescription",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ki=Z(Wi.prototype,"GameUILayer",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=Wi));e._RF.pop(),e._RF.push({},"e8855FX8i9K5KSg1caZAyvx","HeroWeapon",void 0);var eo,to=t.ccclass;t.property,to("HeroWeapon")(Zi=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.start=function(){},i.update=function(e){},t}(d));e._RF.pop(),e._RF.push({},"6a7ee8nKmNDa4S5L9g+V0KD","CurrentRoundMessage",void 0);var io,oo,no,ao,ro,so=t.ccclass;t.property,so("CurrentRoundMessage")(eo=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._messagePrefab=void 0,t._messagePar=void 0,t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("sendRoundMessage")},i.onLoad=function(){ce.add("sendRoundMessage",this.sendRoundMessage.bind(this)),this._messagePrefab=g("Label",this.node),this._messagePar=g("ScrollView/view/content",this.node)},i.sendRoundMessage=function(e){var t=r(this._messagePrefab);t.parent=this._messagePar,t.getComponent(s).string=e,this._messagePar.parent.parent.getComponent(N).scrollToBottom(1),t.active=!0},t}(d));e._RF.pop(),e._RF.push({},"8b950jW4AZPXobu7MumYqkU","GameSettings",void 0);var lo,ho=t.ccclass,co=t.property;io=ho("GameSettings"),oo=co(s),io((ro=Z((ao=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"contentLabel",ro,j(t)),t}J(t,e);var i=t.prototype;return i.onEnable=function(){this.updateHeroPropertiesView()},i.updateHeroPropertiesView=function(){var e;e=ce.dispatch("usingWeaponManagerFun","getWeaponDes")+ce.dispatch("usingHeroControlFun","getHeroPropertiesDes"),this.contentLabel.string=e},i.onBtnSettings=function(){this.node.active=!0,ce.dispatch("usingHeroControlFun","pauseGame")},i.closeSetting=function(){this.node.active=!1,ce.dispatch("usingHeroControlFun","resumeGame")},t}(d)).prototype,"contentLabel",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no=ao));e._RF.pop(),e._RF.push({},"cafd4Zb9TdIspSioAwoZg46","Weapon",void 0);var uo,po=(0,t.ccclass)("Weapon")(lo=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._curLevel=void 0,t._curData=void 0,t._weaponId=void 0,t._weaponName=void 0,t._imageIndex=void 0,t._damage=void 0,t._duration=void 0,t._moveSpeed=void 0,t._maxLevel=void 0,t._canAttackTimes=void 0,t._backDis=void 0,t._attackInterval=void 0,t._flyDir=void 0,t._touchingArr=[],t._hasAttackedEnemies=[],t}J(t,e);var i=t.prototype;return i.initWeaponInfo=function(e,t,i){void 0===i&&(i={x:1,y:1}),this._curLevel=e,this._curData=t,this._weaponId=t.id,this._weaponName=t.name,this._imageIndex=t.imageIndex,this._maxLevel=t.maxLevel,this.initCurLvInfo(),this._flyDir=i,this.clearCacheData()},i.initCurLvInfo=function(){var e=this._curLevel-1;if(this._damage=this._curData.damage[e],this._duration=this._curData.duration.length>0?this._curData.duration[e]:1/0,this._moveSpeed=this._curData.moveSpeed.length>0?this._curData.moveSpeed[e]:0,this._canAttackTimes=this._curData.canAttackTimes.length>0?this._curData.canAttackTimes[e]:1/0,this._backDis=this._curData.backDis.length>0?this._curData.backDis[e]:0,this._attackInterval=this._curData.attackInterval.length>0?this._curData.attackInterval[e]:.5,0!==this._duration){var t=ce.dispatch("getHeroControlProperty","_bonusBulletDuration");this._duration+=t}if(0!==this._moveSpeed){var i=ce.dispatch("getHeroControlProperty","_bonusBulletMoveSpeed");this._moveSpeed+=i}if(0!==this._canAttackTimes){var o=ce.dispatch("getHeroControlProperty","_bonusBulletAttackTimes");this._canAttackTimes+=o}},i.clearCacheData=function(){this._touchingArr.length=0,this._hasAttackedEnemies.length=0},i.initBoxCollider=function(e,t){if(void 0===t&&(t={x:0,y:0}),!e)throw"tag is"+e;var i=this.node.getComponent(v);i||(i=this.node.addComponent(v));var o=this.node.getComponent(a),n=new y(o.contentSize.x+t.x,o.contentSize.y+t.y);i.tag=e,i.size=n,i.group=Se.heroWeapon,i.on(_.BEGIN_CONTACT,this.onBeginContact,this),i.on(_.END_CONTACT,this.onEndContact,this)},i.initCircleCollider=function(e,t){if(void 0===t&&(t=0),!e)throw"tag is"+e;var i=this.node.getComponent(A);i||(i=this.node.addComponent(A));var o=this.node.getComponent(a);i.tag=e,i.radius=o.contentSize.x/2+t,i.group=Se.heroWeapon,i.on(_.BEGIN_CONTACT,this.onBeginContact,this),i.on(_.END_CONTACT,this.onEndContact,this)},i.update=function(e){this.weaponMove(e),this.weaponDuration(e)},i.weaponMove=function(e){if(!Pe.stopAll&&this._flyDir&&0!=this._moveSpeed&&this._duration!=1/0){var t=e*this._moveSpeed,i=this._flyDir.x*t,o=this._flyDir.y*t;this.node.setPosition(this.node.getPosition().x+i,this.node.getPosition().y+o,0)}},i.weaponDuration=function(e){Pe.stopAll||(this._duration-=e,this._duration<=0&&this.recoveryToPool())},i.changeBulletRotationByFlyDir=function(){if(0!=this._flyDir.x||0!=this._flyDir.y)if(0!=this._flyDir.x)if(0!=this._flyDir.y){var e=Math.sqrt(this._flyDir.x*this._flyDir.x+this._flyDir.y*this._flyDir.y),t=Math.sin(Math.abs(this._flyDir.y)/e),i=90*Math.asin(t);this._flyDir.y>0?this._flyDir.x>0?this.node.angle=180+i:this.node.angle=360-i:this._flyDir.x>0?this.node.angle=180-i:this.node.angle=i}else this._flyDir.x>0?this.node.angle=180:this.node.angle=0;else this._flyDir.y>0?this.node.angle=-90:this.node.angle=90},i.onBeginContact=function(e,t){switch(t.tag){case be.wall:this.colliderWall(t);break;case be.monster:this._touchingArr.push(t),this.colliderMonster(t);break;case be.boss:this._touchingArr.push(t),this.colliderBoss(t);break;default:if([be.fireBall,be.fireBallFire].indexOf(t.tag)>-1)break;console.warn("未处理的碰撞结束："+e.tag+"与"+t.tag+"发生碰撞")}},i.onEndContact=function(e,t){switch(t.tag){case be.monster:case be.boss:this.colliderEnemyEnd(t);break;default:if([be.fireBall,be.fireBallFire].indexOf(t.tag)>-1)break;console.warn("未处理的碰撞结束："+e.tag+"与"+t.tag+"发生碰撞")}},i.colliderWall=function(e){console.log(this._weaponName+"撞墙")},i.colliderMonster=function(e){this.isStopRun(e)||(this.updateMonsterBlood(e),this._canAttackTimes--,this._canAttackTimes<=0&&this.recoveryToPool())},i.colliderBoss=function(e){this.isStopRun(e)||(this.updateBossBlood(e),this.updateCanAttackTimes())},i.colliderEnemyEnd=function(e){var t=this._touchingArr.indexOf(e);t>-1&&this._touchingArr.splice(t,1)[0]},i.isTouching=function(e){return this._touchingArr.indexOf(e)>-1},i.isHasAttacked=function(e){return this._hasAttackedEnemies.indexOf(e)>-1},i.updateMonsterBlood=function(e){var t=ce.dispatch("usingHeroControlFun","getCurDamage")+this._damage;ce.dispatch("usingHeroControlFun","isCriticalHit")?(t*=2,ce.dispatch("createDamageTex",e.node,t,{x:0,y:20},"criticalHit")):ce.dispatch("createDamageTex",e.node,t,{x:0,y:20}),e.node.getComponent("Monster").updateBlood(-t,this._backDis)},i.updateBossBlood=function(e){var t=ce.dispatch("usingHeroControlFun","getCurDamage")+this._damage;ce.dispatch("createDamageTex",e.node,t,{x:0,y:20});var i=e.node.parent.components[0];if(!i)throw"script is not init";i.updateBlood(-t)},i.isStopRun=function(e){return Pe.stopAll&&!this.isTouching(e)},i.recoveryToPool=function(){Oe.putToPool(this._weaponName,this.node)},i.updateCanAttackTimes=function(){this._canAttackTimes--,this._canAttackTimes<=0&&this.recoveryToPool()},t}(d))||lo;e._RF.pop(),e._RF.push({},"b4b92Q5gQxCeLttrvjhA8P8","Darts",void 0);var go;(0,t.ccclass)("Darts")(uo=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._isCanSplit=!1,t._isCanSplitTimes=0,t}J(t,e);var i=t.prototype;return i.init=function(e,t,i,o,n){void 0===o&&(o=!1),this.initWeaponInfo(t,e,i);var a=e.name;this.initBoxCollider(be[a]),this._isCanSplit=o,ce.dispatch("playOneShot","battle/bullet"),this.schedule(this.startRotation,1/60)},i.startRotation=function(){Pe.stopAll||(this.node.angle+=30)},i.colliderMonster=function(e){this.isStopRun(e)||(this.updateMonsterBlood(e),this._canAttackTimes--,this._canAttackTimes<=0?this.recoveryToPool():this.changeFlyDir())},i.colliderBoss=function(e){this.isStopRun(e)||(this.updateBossBlood(e),this._canAttackTimes<=0?this.recoveryToPool():this.changeFlyDir())},i.changeFlyDir=function(){var e=Math.sin(30*Math.random());this._flyDir.x=-this._flyDir.x,this._flyDir.y=-this._flyDir.y;var t=this.getRotationDir(this._flyDir,e),i=this.getRotationDir(this._flyDir,-e);this._flyDir=t,this._isCanSplit&&(this.createSplitDarts(i),this._canAttackTimes--,this._canAttackTimes<=0&&(this._isCanSplit=!1))},i.getRotationDir=function(e,t){var i=e.x,o=e.y;return{x:i*Math.cos(t)-o*Math.sin(t),y:i*Math.sin(t)+o*Math.cos(t)}},i.createSplitDarts=function(e){var t=ce.dispatch("getWeaponDataByIdOrName","darts"),i=Oe.getFromPool("darts"),o=g("Canvas/bulletLayer");i.parent=o;var n=this.node.getWorldPosition();i.setWorldPosition(n),i.getComponent("Darts").init(t,t.maxLevel,e)},t}(po));e._RF.pop(),e._RF.push({},"e0b852hnStMuL8DCjNUMpIA","FanPrefab",void 0);var fo,mo=t.ccclass;t.property,mo("FanPrefab")(go=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.start=function(){this.moveLikeParabola()},i.moveLikeParabola=function(){return console.log("还没写")},t}(d));e._RF.pop(),e._RF.push({},"b247e+Qq1tGc6SfQssZUuHm","FireBloom",void 0);var vo,yo=t.ccclass;t.property,yo("FireBloom")(fo=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(){this.initSkillData()},i.initSkillData=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","fireBloom");this._damage=e.baseDamage,this._moveSpeed=0,this._canAttackTimes=1/0,this._backDis=0,this._attackInterval=1,this._weaponName=e.name2,this.clearCacheData(),this.initBoxCollider(be.sword)},t}(po));e._RF.pop(),e._RF.push({},"f0a2dmCnJBInb6cEYwE9QoG","Guard",void 0);var _o;(0,t.ccclass)("Guard")(vo=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(e,t){this.initWeaponInfo(t,e);var i=e.name;this.initCircleCollider(be[i],-10)},i.colliderMonster=function(e){var t=this;if(Pe.stopAll)this.scheduleOnce((function(){t.colliderMonster(e)}),this._attackInterval);else if(this.isTouching(e)){var i=ce.dispatch("usingHeroControlFun","getCurDamage")+this._damage;ce.dispatch("createDamageTex",e.node,i,{x:0,y:20}),e.node.getComponent("Monster").updateBlood(-i),this.scheduleOnce((function(){t.colliderMonster(e)}),this._attackInterval)}},i.colliderBoss=function(e){var t=this;if(Pe.stopAll)this.scheduleOnce((function(){t.colliderBoss(e)}),this._attackInterval);else if(this.isTouching(e)){ce.dispatch("createDamageTex",e.node,this._damage,{x:0,y:20});var i=e.node.parent.components[0];if(!i)throw"script name is different form node name.";var o=ce.dispatch("usingHeroControlFun","getCurDamage")+this._damage;i.updateBlood(-o),this.scheduleOnce((function(){t.colliderBoss(e)}),this._attackInterval)}},t}(po));e._RF.pop(),e._RF.push({},"037bdybLU9JVYPgEIJ1NPSt","HellFire",void 0);var bo,So=t.ccclass;t.property,So("HellFire")(_o=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(){this.initSkillData()},i.initSkillData=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","hellFire");this._damage=e.baseDamage+(ce.dispatch("usingHeroControlFun","getCurDamage")*e.damageTimes|0),this._moveSpeed=0,this._canAttackTimes=1/0,this._backDis=0,this._attackInterval=1,this._weaponName=e.name2,this.clearCacheData(),this.initBoxCollider(be.sword)},t}(po));e._RF.pop(),e._RF.push({},"9e8786GKzVCk5+Ipdf+NqEC","IceCone",void 0);var Bo,Po=t.ccclass;t.property,Po("IceCone")(bo=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(e,t){this.initSkillData(e,t),ce.dispatch("playOneShot","battle/frozen")},i.initSkillData=function(e,t){this._damage=e.damage,this._duration=e.duration,this._moveSpeed=e.moveSpeed,this._canAttackTimes=e.canAttackTimes,this._backDis=0,this._attackInterval=.5,this._weaponName=e.name,this._flyDir=t,this.clearCacheData(),this.initBoxCollider(be.sword),this.changeBulletRotationByFlyDir()},i.colliderMonster=function(e){if(!this.isStopRun(e)&&!this.isHasAttacked(e.node.uuid)){this.updateMonsterBlood(e),this._hasAttackedEnemies.push(e.node.uuid),this._canAttackTimes--,console.log("冻结目标  还没写");var t=e.node.getComponent("Monster");t&&t.addDebuffFrozen(5),this._canAttackTimes<=0&&this.recoveryToPool()}},t}(po));e._RF.pop(),e._RF.push({},"5e483mBHcFKd7tMJmx5es+4","JustOneSwordDivideWorld",void 0);var Co,wo=t.ccclass;t.property,wo("JustOneSwordDivideWorld")(Bo=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(e){this.initSkillData(e),this.playThisWeaponAudio(3)},i.playThisWeaponAudio=function(e){for(var t=0;t<e;t++)this.scheduleOnce((function(){ce.dispatch("playOneShot","battle/spell")}),t)},i.initSkillData=function(e){this._damage=e.damage,this._duration=1/0,this._moveSpeed=0,this._canAttackTimes=1/0,this._backDis=0,this._attackInterval=.5,this._weaponName="未命名",this._flyDir=new P(-.25,-1),this.clearCacheData(),this.initBoxCollider(be.sword),this.changeBulletRotationByFlyDir()},i.colliderMonster=function(e){this.isStopRun(e)||this.isHasAttacked(e.node.uuid)||(this.updateMonsterBlood(e),this._hasAttackedEnemies.push(e.node.uuid),this._canAttackTimes--,this._canAttackTimes<=0&&this.recoveryToPool())},i.changeBulletRotationByFlyDir=function(){if(0!=this._flyDir.x||0!=this._flyDir.y)if(0!=this._flyDir.x)if(0!=this._flyDir.y){var e=Math.sqrt(this._flyDir.x*this._flyDir.x+this._flyDir.y*this._flyDir.y),t=Math.sin(Math.abs(this._flyDir.y)/e),i=90*Math.asin(t);this._flyDir.y>0?this._flyDir.x>0?this.node.angle=180+i:this.node.angle=360-i:this._flyDir.x>0?this.node.angle=180-i:this.node.angle=i}else this._flyDir.x>0?this.node.angle=180:this.node.angle=0;else this._flyDir.y>0?this.node.angle=-90:this.node.angle=90},t}(po));e._RF.pop(),e._RF.push({},"a82d3h5129GNKZOCSjN7cNi","MoveLikeFire",void 0);var Do,Lo=t.ccclass;t.property,Lo("MoveLikeFire")(Co=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(){this.initSkillData()},i.initSkillData=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","moveLikeFire");this._damage=e.baseDamage,this._moveSpeed=0,this._canAttackTimes=1/0,this._backDis=10,this._attackInterval=.3,this._weaponName=e.name2,this.clearCacheData(),this.initBoxCollider(be.sword),this.node.getComponent(m).play()},t}(po));e._RF.pop(),e._RF.push({},"fa9e36GRPBDFq3fyBBV3pXc","SamadhiTrueFire",void 0);var ko,To,Mo,Ao,xo,Fo=t.ccclass;t.property,Fo("SamadhiTrueFire")(Do=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.onDestroy=function(){},i.init=function(){this.addToAnimManger(),this.initSkillData()},i.initSkillData=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","samadhiTrueFire");this._damage=e.baseDamage,this._duration=e.duration,this._backDis=0,this._canAttackTimes=1/0,this._attackInterval=.5,this._weaponName=e.name,this.node.parent=ce.dispatch("getHeroControlProperty","node").getChildByName("sprite"),this.initBoxCollider(be.sword)},i.recoveryToPool=function(){this.removeFromList(),this.node.destroy()},i.addToAnimManger=function(){var e=this.node.getComponent(m);ce.dispatch("usingGameAnimManagerFun","addAnimToList",e)},i.removeFromList=function(){var e=this.node.getComponent(m);ce.dispatch("usingGameAnimManagerFun","removeAnimFromList",e)},t}(po));e._RF.pop(),e._RF.push({},"147015qvZlGX40D++2yinmG","SkillManager",void 0);var Io,Ro=t.ccclass,Ho=t.property;ko=Ro("SkillManager"),To=Ho(S),ko((xo=Z((Ao=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"skillPrefab",xo,j(t)),t._openSecretList=[],t._likeWindMoveTimes=0,t._bloodMakeMeStrongTimes=0,t._drinkBloodValue=0,t._percentageDamage=0,t._countdownList={sunHeart:0},t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("usingSkillManagerFun"),ce.remove("getSkillManagerProperty")},i.onLoad=function(){ce.add("usingSkillManagerFun",this.usingSkillManagerFun.bind(this)),ce.add("getSkillManagerProperty",this.getSkillManagerProperty.bind(this)),this.initSkill()},i.start=function(){this.openAllSecretSkill()},i.initSkill=function(){var e=this,t=ce.dispatch("getTempData","SkillBookLayer")&&ce.dispatch("getTempData","SkillBookLayer").usingBookList;if(t){var i=function(){if(Object.prototype.hasOwnProperty.call(t,o)){var i=t[o];if(i){var n=r(e.skillPrefab);n.parent=e.node;var a=n.getComponent(f),s="images/icons/icon_"+i+"/spriteFrame";ce.dispatch("loadTheDirResources",s,(function(e){return a.spriteFrame=e})),Ve(e.node,n,"SkillManager","onBtnSkill",i)}}};for(var o in t)i()}},i.onBtnSkill=function(e,t){var i=e.target.getChildByName("mask").getComponent(f);if(!(i.fillRange>0)){this[t](),i.fillRange=1;var o=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName",t).cd,n=e.target.getChildByName("remainingTime").getComponent(s);this.startCoolDowntime(i,n,o)}},i.startCoolDowntime=function(e,t,i){var o=1/60,n=0;t.string=i;var a=setInterval((function(){Pe.stopAll||(n+=o,e.fillRange=1-n/i,t.string=(i-n).toFixed(2),n>=i&&(clearInterval(a),e.fillRange=0,t.string=""))}),1e3*o)},i.usingSkillManagerFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},i.getSkillManagerProperty=function(e){if(this.hasOwnProperty(e))return this[e];throw"skill manager 中不存在属性："+e},i.changeMoveSpeed=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","changeMoveSpeed");ce.dispatch("usingHeroControlFun","changeHeroMoveSpeed",e.moveSpeedTimes,e.duration)},i.swordRain=function(){ce.dispatch("usingWeaponManagerFun","usingSkillSwordRain")},i.justOneSwordDivideWorld=function(){ce.dispatch("usingWeaponManagerFun","usingSkillJustOneSwordDivideWorld")},i.collectGas=function(){var e=this;console.log("凝气术，还没写");var t=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","凝气术");ce.dispatch("usingHeroControlFun","updateTempCriticalHitRate",t.criticalHitRate),ce.dispatch("usingHeroControlFun","isOpenCollectGas",!0);var i=t.duration;this.schedule((function o(){Pe.stopAll||--i<=0&&(e.unschedule(o),ce.dispatch("usingHeroControlFun","updateTempCriticalHitRate",-t.criticalHitRate),ce.dispatch("usingHeroControlFun","isOpenCollectGas",!1))}),1)},i.thousandsSwordToTomb=function(){ce.dispatch("usingWeaponManagerFun","usingSkillThousandsSwordToTomb")},i.trackDisappear=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","trackDisappear");ce.dispatch("usingHeroControlFun","usingSkillTrackDisappear",e.duration),ce.dispatch("usingHeroControlFun","changeHeroMoveSpeed",e.moveSpeedTimes,e.duration)},i.lionRoar=function(){ce.dispatch("usingHeroControlFun","usingSkillLionRoar")},i.iceCone=function(){ce.dispatch("usingWeaponManagerFun","usingSkillIceCone")},i.iceShield=function(){ce.dispatch("usingHeroControlFun","usingSkillIceShield")},i.iceAge=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","iceAge");ce.dispatch("usingMapLayerFun","frozenMap",e.duration,.2)},i.moveLikeMeteor=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","moveLikeMeteor");ce.dispatch("usingHeroControlFun","changeHeroMoveSpeed",e.moveSpeedTimes,e.duration)},i.samadhiTrueFire=function(){ce.dispatch("loadTheDirResources","/prefabs/hero/weapon/samadhiTrueFire",(function(e){r(e).getComponent("SamadhiTrueFire").init()}))},i.sunHeart=function(){var e=this;ce.dispatch("loadTheDirResources","/prefabs/hero/weapon/sunHeart",(function(e){r(e).parent=ce.dispatch("getHeroControlProperty","node").getChildByName("effect")}));var t=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","sunHeart");ce.dispatch("usingHeroControlFun","updateTempCriticalHitRate",t.criticalHitRate),this._countdownList.sunHeart=t.duration,this.unschedule(this.sunHeartCountdownRun),this.schedule((function(){e.sunHeartCountdownRun()}),1)},i.sunHeartCountdownRun=function(){if(!Pe.stopAll){this._countdownList.sunHeart--;var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","sunHeart");ce.dispatch("usingHeroControlFun","updatePercentageBloodProgress",-e.damageTimes),this._countdownList.sunHeart<=0&&(ce.dispatch("usingHeroControlFun","updateTempCriticalHitRate",-e.criticalHitRate),this.unschedule(this.sunHeartCountdownRun))}},i.fireBloom=function(){ce.dispatch("usingWeaponManagerFun","usingSkillFireBloom")},i.hellFire=function(){ce.dispatch("usingWeaponManagerFun","usingSkillHellFire")},i.openAllSecretSkill=function(){var e=this,t=ce.dispatch("getTempData","SkillBookLayer")&&ce.dispatch("getTempData","SkillBookLayer").finishBookList;console.log("openAllSecretSkill",t),t&&t.forEach((function(t){var i=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName",t);"秘法"==i.type&&e[i.name2]()}))},i.likeWindMove=function(){var e=this;this.schedule((function(){e._likeWindMoveTimes<50&&e._likeWindMoveTimes++}),1)},i.resetLikeWindMoveTimes=function(){this._likeWindMoveTimes=0},i.bloodMakeMeStrong=function(){this._openSecretList.push("bloodMakeMeStrong")},i.add_bloodMakeMeStrongTimes=function(){this._openSecretList.indexOf("bloodMakeMeStrong")<0||this._bloodMakeMeStrongTimes++},i.drinkBlood=function(){this._openSecretList.push("drinkBlood"),this._drinkBloodValue=20},i.iceHeart=function(){this._openSecretList.push("iceHeart");var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","iceHeart");this._percentageDamage+=e.damageTimes},i.moveLikeFire=function(){this._openSecretList.push("moveLikeFire"),ce.dispatch("usingWeaponManagerFun","usingSkillMoveLikeFire")},i.flowFire=function(){this._openSecretList.push("flowFire");var e=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","flowFire");this._percentageDamage+=e.damageTimes},i.getMoveSpeedFromSecretSkill=function(){return this._likeWindMoveTimes},i.getDamageValueFromSecretSkill=function(){var e=this._bloodMakeMeStrongTimes;return this._openSecretList.indexOf("iceHeart")>-1&&(e+=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","iceHeart").baseDamage),e},i.getPercentageDamageFromSecretSkill=function(){return this._percentageDamage},i.getRecoveryBloodFromSecretSkill=function(){return this._drinkBloodValue},t}(d)).prototype,"skillPrefab",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mo=Ao));e._RF.pop(),e._RF.push({},"076f0Ym5/1BxYGaaGR0LdPg","Spell",void 0);var No;(0,t.ccclass)("Spell")(Io=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(e,t){this.initWeaponInfo(t,e);var i=e.name;this.initBoxCollider(be[i])},i.playSpellAudio=function(){ce.dispatch("playOneShot","battle/spell")},t}(po));e._RF.pop(),e._RF.push({},"129e2bHdPtBCbnuzFFQDPpA","Sword",void 0);var Oo,Eo=t.ccclass;t.property,Eo("Sword")(No=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(e,t,i){this.initWeaponInfo(t,e,i);var o=e.name;this.initBoxCollider(be[o]),this.changeBulletRotationByFlyDir(),ce.dispatch("playOneShot","battle/bullet")},i.colliderMonster=function(e){this.isStopRun(e)||this.isHasAttacked(e.node.uuid)||(this.updateMonsterBlood(e),this._hasAttackedEnemies.push(e.node.uuid),this._canAttackTimes--,this._canAttackTimes<=0&&this.recoveryToPool())},i.changeBulletRotationByFlyDir=function(){if(0!=this._flyDir.x||0!=this._flyDir.y)if(0!=this._flyDir.x)if(0!=this._flyDir.y){var e=Math.sqrt(this._flyDir.x*this._flyDir.x+this._flyDir.y*this._flyDir.y),t=Math.sin(Math.abs(this._flyDir.y)/e),i=90*Math.asin(t);this._flyDir.y>0?this._flyDir.x>0?this.node.angle=180+i:this.node.angle=360-i:this._flyDir.x>0?this.node.angle=180-i:this.node.angle=i}else this._flyDir.x>0?this.node.angle=180:this.node.angle=0;else this._flyDir.y>0?this.node.angle=-90:this.node.angle=90},t}(po));e._RF.pop(),e._RF.push({},"9af2aMLjflOtJfSTrAGnq5k","SwordRain",void 0);var zo,Wo=t.ccclass;t.property,Wo("SwordRain")(Oo=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.init=function(e){this.initSkillData(e),ce.dispatch("playOneShot","battle/bullet")},i.initSkillData=function(e){this._damage=e.damage,this._duration=e.duration,this._moveSpeed=500,this._canAttackTimes=1/0,this._backDis=0,this._attackInterval=.5,this._weaponName=e.name,this._flyDir=new P(-.25,-1),this.clearCacheData(),this.initBoxCollider(be.sword),this.changeBulletRotationByFlyDir()},i.colliderMonster=function(e){this.isStopRun(e)||this.isHasAttacked(e.node.uuid)||(this.updateMonsterBlood(e),this._hasAttackedEnemies.push(e.node.uuid),this._canAttackTimes--,this._canAttackTimes<=0&&this.recoveryToPool())},i.changeBulletRotationByFlyDir=function(){if(0!=this._flyDir.x||0!=this._flyDir.y)if(0!=this._flyDir.x)if(0!=this._flyDir.y){var e=Math.sqrt(this._flyDir.x*this._flyDir.x+this._flyDir.y*this._flyDir.y),t=Math.sin(Math.abs(this._flyDir.y)/e),i=90*Math.asin(t);this._flyDir.y>0?this._flyDir.x>0?this.node.angle=180+i:this.node.angle=360-i:this._flyDir.x>0?this.node.angle=180-i:this.node.angle=i}else this._flyDir.x>0?this.node.angle=180:this.node.angle=0;else this._flyDir.y>0?this.node.angle=-90:this.node.angle=90},t}(po));e._RF.pop(),e._RF.push({},"25249OVHDpCfIXwpquDtNdf","ThousandsSwordToTomb",void 0);var Uo,qo,Go,Jo,Vo,jo,Qo,Ko,Xo,Zo,Yo,$o=t.ccclass;t.property,$o("ThousandsSwordToTomb")(zo=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._moveDistance=void 0,t._isPlayAnim=void 0,t}J(t,e);var i=t.prototype;return i.init=function(e){this.initSkillData(e)},i.initSkillData=function(e){this._isPlayAnim=!1,this._damage=e.damage,this._moveDistance=e.moveDistance-this.node.getComponent(a).contentSize.x/4,console.log("data.moveDistance",e.moveDistance),console.log("this._moveDistance",this._moveDistance),this._moveSpeed=2e3,this._canAttackTimes=1/0,this._backDis=0,this._attackInterval=.5,this._weaponName=e.name,this.node.getComponent(f).color=new o(255,204,0,255);var t=ce.dispatch("getHeroWorldPos"),i=O.random()>.5?Math.random():-O.random();i*=.7;var n=e.moveDistance;this.node.setWorldPosition(t.x-n*i,t.y+n,t.z),this._flyDir=new P(i,-1),console.log("this._flyDir",this._flyDir),this.clearCacheData(),this.initBoxCollider(be.sword),this.changeBulletRotationByFlyDir()},i.initBoxCollider=function(e,t){if(!e)throw"tag is"+e;var i=this.node.getComponent(v);i||(i=this.node.addComponent(v)),i.tag=e,i.group=Se.heroWeapon,i.on(_.BEGIN_CONTACT,this.onBeginContact,this),i.on(_.END_CONTACT,this.onEndContact,this)},i.weaponMove=function(e){if(!Pe.stopAll&&this._flyDir)if(this._moveDistance<=0)this.playDestroyAnim();else if(0!=this._moveSpeed){var t=e*this._moveSpeed,i=this._flyDir.x*t,o=this._flyDir.y*t;this.node.setPosition(this.node.getPosition().x+i,this.node.getPosition().y+o,0),this._moveDistance+=o}},i.playDestroyAnim=function(){var e=this;if(!this._isPlayAnim){ce.dispatch("playOneShot","battle/砸地"),this._isPlayAnim=!0;var t=new o(255,255,255,255);D(this.node).by(.5,{position:new w(0,0,0)},{onUpdate:function(i,n){e.node.getComponent(f).color=o.lerp(new o,t,new o(t.r,t.g,t.b,0),n)}}).call((function(){e.recoveryToPool()})).start()}},t}(po));e._RF.pop(),e._RF.push({},"a567cNLrvhBJYPPuiBF6V0Q","weaponManager",void 0);var en,tn,on,nn,an,rn,sn,ln,hn,cn,un,dn,pn,gn=t.ccclass,fn=t.property;Uo=gn("WeaponManager"),qo=fn(T),Go=fn(i),Jo=fn(C),Vo=fn(C),Uo((Ko=Z((Qo=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"weaponDataJson",Ko,j(t)),X(t,"btnNodes",Xo,j(t)),X(t,"defaultMaterial",Zo,j(t)),X(t,"guardUltimateSkillMaterial",Yo,j(t)),t._spellPrefab=void 0,t._swordPrefab=void 0,t._dartsPrefab=void 0,t._swordRainPrefab=void 0,t._justOneSwordDivideWorldPrefab=void 0,t._iceConePrefab=void 0,t._moveLikeFirePrefab=void 0,t._thousandsSwordToTombPrefab=void 0,t._fireBloomPrefab=void 0,t._hellFirePrefab=void 0,t._thousandsSwordToTombQueue=new qe,t._fireBloomQueue=new qe,t._hellFireQueue=new qe,t._swordLv=0,t._guardLv=0,t._spellLv=0,t._dartsLv=0,t._rewardConfig=null,t._weaponData={},t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("updateSelectWeapon"),ce.remove("getWeaponDataByIdOrName"),ce.remove("usingWeaponManagerFun"),ce.remove("getWeaponManagerProperty")},i.onLoad=function(){ce.add("updateSelectWeapon",this.updateSelectWeapon.bind(this)),ce.add("getWeaponDataByIdOrName",this.getWeaponDataByIdOrName.bind(this)),ce.add("usingWeaponManagerFun",this.usingWeaponManagerFun.bind(this)),ce.add("getWeaponManagerProperty",this.getWeaponManagerProperty.bind(this)),this.initWeaponData(),this.initWeaponConfig(),this.dynamicLoadPrefabs(),this.startUsingWeapon()},i.startUsingWeapon=function(){this._swordLv=1,this.isUsingSword(!0)},i.usingMaxLvWeapon=function(){this._swordLv=9,this._guardLv=3,this._spellLv=9,this._dartsLv=9,this.isUsingSword(!0),this.isUsingDarts(!0),this.isUsingGuard(!0),this.isUsingSpell(!0)},i.initWeaponData=function(){var e=this;this.weaponDataJson.json.forEach((function(t){var i=t.id,o=t.name;e._weaponData[i]=t,e._weaponData[o]=t}))},i.initWeaponConfig=function(){this._rewardConfig=["restoreHP","addMoveSpeed","addCriticalHitRate","sword","guard","spell","darts"]},i.dynamicLoadPrefabs=function(){this.loadPrefab("sword"),this.loadPrefab("darts"),this.loadPrefab("spell"),this.loadPrefab("thousandsSwordToTomb"),this.loadPrefab("justOneSwordDivideWorld"),this.loadPrefab("swordRain"),this.loadPrefab("iceCone"),this.loadPrefab("fireBloom"),this.loadPrefab("hellFire"),this.loadPrefab("moveLikeFire")},i.loadPrefab=function(e,t){var i=this;void 0===t&&(t=null);var o="_"+e+"Prefab";ce.dispatch("loadTheDirResources","/prefabs/hero/weapon/"+e,(function(n){t?t(n):(i[o]=n,Oe.addPoolToPools(e,new b,i[o]))}))},i.isUsingSpell=function(e){if(console.log("初始化护符"),g("spellPar",this.node).active=e,e){var t=this.getWeaponDataByIdOrName("spell").total[this._spellLv-1];t+=ce.dispatch("getHeroControlProperty","_bonusBulletTotal"),this.openSpell(t)}},i.openSpell=function(e,t){var i=this;if(void 0===t&&(t=100),t<=10)return console.log("半径过小");for(var o=g("spellPar",this.node),n=0;n<o.children.length;n++){var a=o.children[n];Oe.putToPool("spell",a),n--}for(var r=2*Math.PI/e,s=360/e,l=[],h=0;h<e;h++){var c=h*r,u=Math.cos(c)*t,d=Math.sin(c)*t;l.push([u,d])}for(var p=function(e){var t=l[e],o=Oe.getFromPool("spell");o?i.initSpell(o,t,e*s):i.loadPrefab("spell",(function(n){i._spellPrefab=n,Oe.addPoolToPools("spell",new b,i._spellPrefab),o=Oe.getFromPool("spell"),i.initSpell(o,t,e*s)}))},f=0;f<l.length;f++)p(f);this.unschedule(this.spellParRotate),this.schedule(this.spellParRotate,1/60)},i.initSpell=function(e,t,i){var o=this.getWeaponDataByIdOrName("spell");e.parent=g("spellPar",this.node),e.setPosition(t[0],t[1],0),e.angle=i,e.getComponent("Spell").init(o,this._spellLv)},i.spellParRotate=function(){if(!Pe.stopAll){g("spellPar",this.node).angle+=3}},i.isOpenSpellUltimateSkill=function(e){if(e){this.usingSpellUltimateSkill();var t=this.getWeaponDataByIdOrName("spell").USInterval;this.schedule(this.usingSpellUltimateSkill,t)}else this.unschedule(this.usingSpellUltimateSkill)},i.usingSpellUltimateSkill=function(){var e=this;if(!Pe.stopAll){console.log("释放护符大招");for(var t=150,i=g("spellPar",this.node),o=this.getWeaponDataByIdOrName("spell"),n=1/60,a=2*Math.PI/16,r=[],s=0;s<16;s++){var l=s*a,h=Math.cos(l)*t,c=Math.sin(l)*t;r.push([h,c])}for(var u=function(){var a=r[d],s=Oe.getFromPool("spell");s.getComponent("Spell").init(o,e._spellLv),s.parent=i,s.setPosition(a[0],a[1],0);var l=22.5*d;s.angle=l;var h=120;e.schedule((function i(){if(--h<=0&&(console.log("times over , disappear"),e.unschedule(i),Oe.putToPool("spell",s)),Pe.stopAll)h++;else{var o=s.getPosition();s.setPosition(o.x+a[0]/t*3,o.y+a[1]/t*3,0)}}),n)},d=0;d<r.length;d++)u();this.unschedule(this.spellParRotate),this.schedule(this.spellParRotate,n)}},i.isUsingGuard=function(e){var t=g("guard",this.node);if(t.active=e,e){var i=this.getWeaponDataByIdOrName("guard");console.log("guard",i);var o=i.total[this._guardLv-1];t.setScale(o,o),t.getComponent("Guard").init(i,this._guardLv),t.active=!0}},i.isOpenGuardUltimateSkill=function(e){},i.isUsingSword=function(e){if(e){this.schedule(this.createSword,.5)}else this.unschedule(this.createSword)},i.createSword=function(){var e=this;if(!Pe.stopAll){var t=this.getWeaponDataByIdOrName("sword").total[this._swordLv-1];if(!(t+=ce.dispatch("getHeroControlProperty","_bonusBulletTotal")))throw"total err,total is "+t;var i=ce.dispatch("getHeroControlProperty","_curDirection");if(0!=i.x||0!=i.y)for(var o=this.getFlySwordInitPos(t),n=function(t){var i=Oe.getFromPool("sword");i?e.initSword(i,o[t]):e.loadPrefab("sword",(function(n){e._swordPrefab=n,Oe.addPoolToPools("sword",new b,e._swordPrefab),i=Oe.getFromPool("sword"),e.initSword(i,o[t])}))},a=0;a<t;a++)n(a)}},i.initSword=function(e,t){var i=this.getWeaponDataByIdOrName("sword");e.setPosition(0,0,0);var o=g("Canvas/bulletLayer");e.parent=o;var n=this.getFlyDir(ce.dispatch("getHeroControlProperty","_curDirection")),a=ce.dispatch("getHeroWorldPos");a.x+=t.x,a.y+=t.y,e.setWorldPosition(a),e.getComponent("Sword").init(i,this._swordLv,n)},i.getFlySwordInitPos=function(e){var t=[];console.log();for(var i=0;i<e;i++){var o=i%3,n={x:0==o?0:1==o?30:-30,y:30*(i/3|0)};t.push(n)}return t},i.usingSwordUltimateSkill=function(){if(!Pe.stopAll){console.log("释放剑大招");for(var e=je(50,20),t=this.getWeaponDataByIdOrName("sword"),i=0;i<20;i++){var o=Oe.getFromPool("sword");o.setPosition(0,0,0);var n=g("Canvas/bulletLayer");o.parent=n;var a=e[i],r={x:a[0]/50,y:a[1]/50},s=this.getFlyDir(r),l=ce.dispatch("getHeroWorldPos");l.x+=a[0],l.y+=a[1],o.setWorldPosition(l),o.getComponent("Sword").init(t,this._swordLv,s)}}},i.isOpenSwordUltimateSkill=function(e){if(e){var t=this.getWeaponDataByIdOrName("sword").USInterval;this.schedule(this.usingSwordUltimateSkill,t)}else this.unschedule(this.usingSwordUltimateSkill)},i.isUsingDarts=function(e){if(e){this.schedule(this.createDarts,1)}else this.unschedule(this.createDarts)},i.createDarts=function(){var e=this;if(!Pe.stopAll){var t=this.getWeaponDataByIdOrName("darts").total[this._dartsLv-1];if(!(t+=ce.dispatch("getHeroControlProperty","_bonusBulletTotal")))throw"total err,total is "+t;var i=ce.dispatch("getHeroControlProperty","_curDirection");if(0!=i.x||0!=i.y)for(var o=i,n=this.getFlyDirArr(o,t),a=function(t){var i=Oe.getFromPool("darts");i?e.initDarts(i,n[t],t):e.loadPrefab("darts",(function(o){e._dartsPrefab=o,Oe.addPoolToPools("darts",new b,e._dartsPrefab),i=Oe.getFromPool("darts"),i=r(o),e.initDarts(i,n[t],t)}))},s=0;s<t;s++)a(s)}},i.initDarts=function(e,t,i){var o=this.getWeaponDataByIdOrName("darts");e.setPosition(0,0,0);var n=g("Canvas/bulletLayer");e.parent=n;var a=new P(50*t.x*(Math.floor(i/4)+1),50*t.y*(Math.floor(i/4)+1)),r=ce.dispatch("getHeroWorldPos");r.x+=a.x,r.y+=a.y,e.setWorldPosition(r),this._dartsLv==o.maxLevel?e.getComponent("Darts").init(o,this._dartsLv,t,!0,1):e.getComponent("Darts").init(o,this._dartsLv,t)},i.isOpenDartsUltimateSkill=function(e){console.log("飞镖可分裂")},i.getFlyDir=function(e){return new P(e.x,e.y)},i.getFlyDirArr=function(e,t){for(var i=[],o=0;o<t;o++)i.push(this.getRotationDir(e,90*o));return i},i.getRotationDir=function(e,t){var i=t*Math.PI/180,o=e.x,n=e.y,a=o*Math.cos(i)-n*Math.sin(i),r=o*Math.sin(i)+n*Math.cos(i);return new P(a,r)},i.getUpgradeReward=function(e,t){g("GameUILayer/selectWeapon",this.node.parent).active=!1;for(var i,o=K(this.btnNodes);!(i=o()).done;){i.value.getComponent(f).spriteFrame=null}switch(Pe.stopAll=g("GameUILayer/passRewardLayer",this.node.parent).active,t){case"restoreHP":this.restoreHP();break;case"addMoveSpeed":ce.dispatch("usingHeroControlFun","updateBonusMoveSpeed",30);break;case"addCriticalHitRate":ce.dispatch("usingHeroControlFun","updateBonusCriticalHitRate",5);break;default:if(this.isHasWeaponByName(t)){this.upgradeWeaponByWeaponName(t);break}throw"type error,type is "+t}ce.dispatch("usingHeroControlFun","resumeGame")},i.updateSelectWeapon=function(){var e=this;console.log("打开并刷新武器选择界面 还没写");var t=this.btnNodes.length,i=0,o=[];if(this._rewardConfig.length<t)throw"this._rewardConfig.length is err,this._rewardConfig is "+this._rewardConfig;for(;t!=i;){var n=this._rewardConfig[Math.random()*this._rewardConfig.length|0];o.indexOf(n)<0&&(o.push(n),i++)}console.log("randomArr",o);for(var a=function(){var t=e.btnNodes[r],i=o[r],n=t.getComponent(f);ce.dispatch("loadTheDirResources","images/weapons/"+i+"/spriteFrame",(function(e){return n.spriteFrame=e})),Ve(e.node,t,"WeaponManager","getUpgradeReward",i);var a=t.children[0].getComponent(s);e.updateUpgradeWeaponDescription(a,i)},r=0;r<this.btnNodes.length;r++)a();if(console.log("open auto script",ce.dispatch("getHeroControlProperty","_openAutoScript")),ce.dispatch("getHeroControlProperty","_openAutoScript")){var l=o[Math.random()*o.length|0];console.log("getUpgradeReward name",l),this.getUpgradeReward(null,l)}},i.updateUpgradeWeaponDescription=function(e,t){switch(t){case"restoreHP":e.string="血量拉满";break;case"addMoveSpeed":e.string="增加30移速";break;case"addCriticalHitRate":e.string="增加5%暴击率";break;default:if(this.isHasWeaponByName(t)){e.string=this.getUpgradeWeaponDescription(t);break}throw"type error,type is "+t}},i.getUpgradeWeaponDescription=function(e){var t=this.getWeaponDataByIdOrName(e),i=this["_"+t.name+"Lv"]+1;if(1==i)return t.minLvTex;if(i==t.maxLevel)return t.maxLvTex;var o="\n";return t.damage[i-2]!=t.damage[i-1]&&(o+="技能伤害提升\n"),t.duration.length>0&&t.duration[i-2]!=t.duration[i-1]&&(o+="技能持续时间增强\n"),t.moveSpeed.length>0&&t.moveSpeed[i-2]!=t.moveSpeed[i-1]&&(o+="技能飞行速度增快\n"),t.canAttackTimes.length>0&&t.canAttackTimes[i-2]!=t.canAttackTimes[i-1]&&(o+="技能穿透次数增加\n"),t.backDis.length>0&&t.backDis[i-2]!=t.backDis[i-1]&&(o+="技能击退效果增强\n"),t.attackInterval.length>0&&t.attackInterval[i-2]!=t.attackInterval[i-1]&&(o+="技能攻击频率增加\n"),o},i.upgradeWeaponByWeaponName=function(e){var t=this.getWeaponDataByIdOrName(e);if(!t)throw"data is error,current data is "+t;if(this["_"+e+"Lv"]!=t.maxLevel){this["_"+e+"Lv"]++;var i=this.getNewStringFirstLetterToUpperCase(e);if(this["isUsing"+i](!0),this["_"+e+"Lv"]==t.maxLevel){this.deleteFillLevelWeaponFromRewardConfig(e);var o="isOpen"+i+"UltimateSkill";console.log("string",o),this[o](!0)}}},i.getNewStringFirstLetterToUpperCase=function(e){return e[0].toUpperCase()+e.substring(1)},i.deleteFillLevelWeaponFromRewardConfig=function(e){var t=this._rewardConfig.indexOf(e);if(!(t>-1))throw"weapon name is error,wn is "+e;this._rewardConfig.splice(t,1)},i.restoreHP=function(){ce.dispatch("usingHeroControlFun","updateBloodProgress",999999)},i.getWeaponDes=function(){return"飞剑术等级："+this._swordLv+"\n"+("防护罩等级："+this._guardLv+"\n")+("旋转护符等级："+this._spellLv+"\n")+("六角镖等级："+this._dartsLv+"\n")},i.getWeaponDataByIdOrName=function(e){if(this._weaponData.hasOwnProperty(e))return this._weaponData[e];throw e+" of _weaponData is null"},i.isHasWeaponByName=function(e){return this._weaponData.hasOwnProperty(e)},i.usingWeaponManagerFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},i.getWeaponManagerProperty=function(e){if(this.hasOwnProperty(e))return this[e];throw"hero control 中不存在属性："+e},i.usingSkillSwordRain=function(){var e=this;if(!Pe.stopAll){this.schedule((function(){for(var t=function(t){var i=Oe.getFromPool("swordRain");i?e.initSwordRain(i,80*t-160):e.loadPrefab("swordRain",(function(o){e._swordRainPrefab=o,Oe.addPoolToPools("swordRain",new b,e._swordRainPrefab),i=Oe.getFromPool("swordRain"),e.initSwordRain(i,80*t-160)}))},i=0;i<5;i++)t(i)}),.2,5,0)}},i.initSwordRain=function(e,t){var i=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","剑雨术"),o={name:i.name2,duration:i.duration,damage:i.baseDamage};e.setPosition(0,0,0);var n=g("Canvas/bulletLayer");e.parent=n;var a=ce.dispatch("getHeroWorldPos");a.x+=t,a.y+=500,e.setWorldPosition(a),e.getComponent("SwordRain").init(o)},i.usingSkillJustOneSwordDivideWorld=function(){var e=this;console.log("通过头的朝向获取方向，还没写"),this._justOneSwordDivideWorldPrefab?this.initJustOneSwordDivideWorld():this.loadPrefab("justOneSwordDivideWorld",(function(t){e._justOneSwordDivideWorldPrefab=t,e.initJustOneSwordDivideWorld()}))},i.initJustOneSwordDivideWorld=function(){var e=this,t=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","一剑隔世"),i={name:t.name2,duration:t.duration,damage:t.baseDamage},o=r(this._justOneSwordDivideWorldPrefab),n=g("Canvas/bulletLayer");o.parent=n;var a=ce.dispatch("getHeroWorldPos");o.setWorldPosition(a),o.getComponent("JustOneSwordDivideWorld").init(i);var s=0,l=function t(){o.angle+=30,(s+=30)>=360&&(e.unschedule(t),o.getComponent("JustOneSwordDivideWorld").recoveryToPool())};this.scheduleOnce((function(){o.getChildByName("collectPower").active=!1,e.schedule(l,1/60)}),1.5)},i.usingSkillThousandsSwordToTomb=function(){for(var e=this,t=0;t<30;t++){var i=Oe.getFromPool("thousandsSwordToTomb");i?(this._thousandsSwordToTombQueue.enqueue(i),0===t&&this.schedule(this.createThousandsSwordToTomb,.3)):this.loadPrefab("thousandsSwordToTomb",(function(t){e._thousandsSwordToTombPrefab=t,Oe.addPoolToPools("thousandsSwordToTomb",new b,e._thousandsSwordToTombPrefab);var i=Oe.getFromPool("thousandsSwordToTomb");e._thousandsSwordToTombQueue.enqueue(i)}))}},i.createThousandsSwordToTomb=function(){if(!Pe.stopAll){var e=this._thousandsSwordToTombQueue.dequeue();e?this.initThousandsSwordToTomb(e):this.unschedule(this.createThousandsSwordToTomb)}},i.initThousandsSwordToTomb=function(e){var t=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","万剑归冢"),i={damage:t.baseDamage,duration:t.duration,moveDistance:1e3,name:t.name2},o=g("Canvas/bulletLayer");e.parent=o,e.getComponent("ThousandsSwordToTomb").init(i)},i.usingSkillIceCone=function(){for(var e=this,t=je(20,20),i=function(){var i=Oe.getFromPool("iceCone"),n=t[o],a={x:n[0]/20,y:n[1]/20};i?e.initIceCone(i,a,n):e.loadPrefab("iceCone",(function(t){e._iceConePrefab=t,Oe.addPoolToPools("iceCone",new b,e._iceConePrefab);var i=Oe.getFromPool("iceCone");e.initIceCone(i,a,n)}))},o=0;o<20;o++)i()},i.initIceCone=function(e,t,i){var o=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName","冰锥术"),n={damage:o.baseDamage,duration:o.duration,moveSpeed:600,canAttackTimes:1,name:o.name2},a=g("Canvas/bulletLayer"),r=ce.dispatch("getHeroWorldPos");e.parent=a,e.setWorldPosition(r.x+i[0],r.y+i[1],r.z),e.getComponent("IceCone").init(n,t)},i.usingSkillFireBloom=function(){for(var e=this,t=0;t<60;t++){var i=Oe.getFromPool("fireBloom");i?(this._fireBloomQueue.enqueue(i),0===t&&this.schedule(this.createFireBloom,.2)):this.loadPrefab("fireBloom",(function(t){e._fireBloomPrefab=t,Oe.addPoolToPools("fireBloom",new b,e._fireBloomPrefab);var i=Oe.getFromPool("fireBloom");e._fireBloomQueue.enqueue(i)}))}},i.createFireBloom=function(){if(!Pe.stopAll){var e=this._fireBloomQueue.dequeue();if(e){var t=ce.dispatch("usingHeroControlFun","getRandomPosNearHero"),i=g("Canvas/bulletLayer");e.parent=i,e.setWorldPosition(t.x,t.y,0),e.getComponent("FireBloom").init()}else this.unschedule(this.createFireBloom)}},i.usingSkillHellFire=function(){for(var e=this,t=0;t<20;t++){var i=Oe.getFromPool("hellFire");i?(this._hellFireQueue.enqueue(i),0===t&&this.schedule(this.createHellFire,1)):this.loadPrefab("hellFire",(function(t){e._hellFirePrefab=t,Oe.addPoolToPools("hellFire",new b,e._fireBloomPrefab);var i=Oe.getFromPool("hellFire");e._hellFireQueue.enqueue(i)}))}},i.createHellFire=function(){if(!Pe.stopAll){var e=this._hellFireQueue.dequeue();if(e){var t=ce.dispatch("getHeroWorldPos"),i=g("Canvas/bulletLayer");e.parent=i,e.setWorldPosition(t.x,t.y+50,0),e.getComponent("HellFire").init()}else this.unschedule(this.createHellFire)}},i.usingSkillMoveLikeFire=function(){this.schedule(this.createMoveLikeFire,.2)},i.createMoveLikeFire=function(){var e=this;if(!Pe.stopAll){var t=Oe.getFromPool("moveLikeFire");if(t){var i=ce.dispatch("getHeroWorldPos"),o=g("Canvas/bulletLayer");t.parent=o,t.setWorldPosition(i.x,i.y,0),t.getComponent("MoveLikeFire").init()}else this.loadPrefab("moveLikeFire",(function(t){e._moveLikeFirePrefab=t,Oe.addPoolToPools("moveLikeFire",new b,e._moveLikeFirePrefab);var i=Oe.getFromPool("moveLikeFire"),o=ce.dispatch("getHeroWorldPos"),n=g("Canvas/bulletLayer");i.parent=n,i.setWorldPosition(o.x,o.y,0),i.getComponent("MoveLikeFire").init()}))}},t}(d)).prototype,"weaponDataJson",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=Z(Qo.prototype,"btnNodes",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zo=Z(Qo.prototype,"defaultMaterial",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yo=Z(Qo.prototype,"guardUltimateSkillMaterial",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jo=Qo));e._RF.pop(),e._RF.push({},"809f5M75tREzYR8m406FnB9","MapLayer",void 0);var mn,vn,yn,_n,bn,Sn,Bn,Pn=t.ccclass,Cn=t.property;en=Pn("MapLayer"),tn=Cn(p),on=Cn(S),nn=Cn([p]),an=Cn(C),rn=Cn(C),en((hn=Z((ln=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"defaultBgSF",hn,j(t)),X(t,"obstaclePrefab",cn,j(t)),X(t,"obsSFs",un,j(t)),X(t,"frozenMaterial",dn,j(t)),X(t,"normalMaterial",pn,j(t)),t.mapList=[],t._mapSize=void 0,t._changeOffset=700,t._obsColliderArr=[],t._frozenCountdown=0,t._frozenTotalTime=0,t._frozenSlowTimes=0,t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("usingMapLayerFun"),ce.remove("getMapLayerProperty")},i.onLoad=function(){ce.add("usingMapLayerFun",this.usingMapLayerFun.bind(this)),ce.add("getMapLayerProperty",this.getMapLayerProperty.bind(this)),this.mapList.push(g("bg1",this.node)),this.mapList.push(g("bg2",this.node)),this.mapList.push(g("bg3",this.node)),this.mapList.push(g("bg4",this.node))},i.start=function(){this.initBg(),this.initObstacles()},i.initBg=function(){if(!this.defaultBgSF)throw"default bg is null";this._mapSize=new y(3*this.defaultBgSF.originalSize.x,3*this.defaultBgSF.originalSize.y),console.log("this._mapSize",this._mapSize);for(var e=0;e<this.mapList.length;e++){var t=this.mapList[e];t.getComponent(a).setContentSize(this._mapSize),t.getComponent(f).spriteFrame=this.defaultBgSF}var i=ce.dispatch("getHeroWorldPos");this.mapList[0].setWorldPosition(i),this.mapList[1].setWorldPosition(i.x+this._mapSize.x,i.y,i.z),this.mapList[2].setWorldPosition(i.x,i.y+this._mapSize.y,i.z),this.mapList[3].setWorldPosition(i.x+this._mapSize.x,i.y+this._mapSize.y,i.z)},i.initObstacles=function(){var e=this;this.mapList.forEach((function(t){for(var i=[[2,2],[2,3],[2,4],[2,5],[2,6],[2,7],[3,2],[3,3],[3,4],[3,5],[3,6],[3,7],[4,2],[4,3],[4,6],[4,7],[5,2],[5,3],[5,6],[5,7],[6,2],[6,3],[6,4],[6,5],[6,6],[6,7],[7,2],[7,3],[7,4],[7,5],[7,6],[7,7]],o=0;o<10;o++){var n=i.splice(Math.random()*i.length|0,1)[0];e.addObstacle(t,n)}}))},i.addObstacle=function(e,t){var i=r(this.obstaclePrefab),o=new y(-this._mapSize.width/2,-this._mapSize.height/2);i.parent=e,i.setPosition(200*t[0]+o.width,200*t[1]+o.height),i.getComponent(f).spriteFrame=this.obsSFs[0];var n=i.addComponent(v),s=i.getComponent(a),l=new y(1*s.contentSize.x/2,1*s.contentSize.y/2);n.tag=be.obstacle,n.size=l,n.group=Se.obstacle,this._obsColliderArr.push(n)},i.usingMapLayerFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},i.getMapLayerProperty=function(e){if(this.hasOwnProperty(e))return this[e];throw"hero control 中不存在属性："+e},i.getAllObs=function(){return this._obsColliderArr},i.frozenMap=function(e,t){console.log("frozenMap"),this._frozenCountdown=e,this._frozenTotalTime=e,this._frozenSlowTimes=t,ce.dispatch("usingHeroControlFun","isOpenSnowEffect",!0),this.unschedule(this.frozenCountdownRun),this.frozenMaterial.setProperty("frozenProgress",0),this.schedule(this.frozenCountdownRun,1);for(var i,o=K(this.mapList);!(i=o()).done;){i.value.getComponent(f).material=this.frozenMaterial}},i.frozenCountdownRun=function(){if(!Pe.stopAll){this._frozenCountdown--;var e=1-this._frozenCountdown/this._frozenTotalTime;this.frozenMaterial.setProperty("frozenProgress",e),console.log("this._frozenCountdown",this._frozenCountdown),this._frozenCountdown<=0&&(console.log("冻结结束"),ce.dispatch("usingHeroControlFun","isOpenSnowEffect",!1),this._frozenCountdown=0,this.unschedule(this.frozenCountdownRun),this.recoveryMapNormalState())}},i.recoveryMapNormalState=function(){for(var e,t=K(this.mapList);!(e=t()).done;){e.value.getComponent(f).material=this.normalMaterial}},i.updateMap=function(e){var t=this.getCurPosMap();if(!this.heroIsNearbyMapEdge()){var i=this.getFarthestMap(),o=this.getFarthestMapInitPos(),n=t.getWorldPosition(),a=new w(n.x+this._mapSize.x*o.x,n.y+this._mapSize.y*o.y,n.z);i.setWorldPosition(a)}},i.getCurPosMap=function(){for(var e=ce.dispatch("getHeroWorldPos"),t=0;t<this.mapList.length;t++){var i=this.mapList[t];if(this.thePointIsInsideMap(i,e))return i}throw"hero is outside map."},i.thePointIsInsideMap=function(e,t){var i=e.getWorldPosition();return new k(i.x-this._mapSize.x/2,i.y-this._mapSize.y/2,this._mapSize.x,this._mapSize.y).contains(t)},i.thePointIsInsideAnyMap=function(e){var t=this;return this.mapList.some((function(i){return t.thePointIsInsideMap(i,e)}))},i.heroIsNearbyMapEdge=function(){var e=this,t=ce.dispatch("getHeroWorldPos");return!this.getThePointNearbyPoint(t).some((function(t){return!e.mapList.some((function(i){return e.thePointIsInsideMap(i,t)}))}))},i.getFarthestMap=function(){for(var e=ce.dispatch("getHeroWorldPos"),t=this.mapList[0],i=this.mapList[0].getWorldPosition(),o=(i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y),n=1;n<this.mapList.length;n++){var a=this.mapList[n],r=a.getWorldPosition(),s=(r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y);s>o&&(o=s,t=a)}return t},i.getFarthestMapInitPos=function(){for(var e,t=ce.dispatch("getHeroWorldPos"),i=this.getThePointNearbyPoint(t),o=0;o<i.length;o++){var n=i[o];if(!this.thePointIsInsideAnyMap(n)){e=n,console.log(o);break}}var a=e.subtract(t);return console.log("getFarthestMapInitPos",a),new P(a.x/Math.abs(a.x),a.y/Math.abs(a.y))},i.getThePointNearbyPoint=function(e){return[new P(e.x+this._changeOffset,e.y),new P(e.x,e.y+this._changeOffset),new P(e.x-this._changeOffset,e.y),new P(e.x,e.y-this._changeOffset),new P(e.x+this._changeOffset,e.y+this._changeOffset),new P(e.x-this._changeOffset,e.y+this._changeOffset),new P(e.x-this._changeOffset,e.y-this._changeOffset),new P(e.x+this._changeOffset,e.y-this._changeOffset)]},t}(d)).prototype,"defaultBgSF",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cn=Z(ln.prototype,"obstaclePrefab",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),un=Z(ln.prototype,"obsSFs",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dn=Z(ln.prototype,"frozenMaterial",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pn=Z(ln.prototype,"normalMaterial",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn=ln));e._RF.pop(),e._RF.push({},"68818T5aVRELL8hQCf3cMKn","ShowLayer",void 0);var wn,Dn,Ln,kn,Tn,Mn,An,xn,Fn,In,Rn,Hn,Nn,On,En,zn=t.ccclass,Wn=t.property;mn=zn("ShowLayer"),vn=Wn(S),yn=Wn(S),mn((Sn=Z((bn=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"damagePrefab",Sn,j(t)),X(t,"tipsPrefab",Bn,j(t)),t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("createDamageTex"),ce.remove("createTipsTex")},i.onLoad=function(){ce.add("createDamageTex",this.createDamageTex.bind(this)),ce.add("createTipsTex",this.createTipsTex.bind(this));var e=new b;Oe.addPoolToPools("damageTex",e,this.damagePrefab);var t=new b;Oe.addPoolToPools("tipsTex",t,this.tipsPrefab)},i.createDamageTex=function(e,t,i,o){void 0===i&&(i={x:0,y:50}),void 0===o&&(o="normal");var n=this.getColorConfigByDamage(o),a=Oe.getFromPool("damageTex");a.setScale(new w(0,0,1)),a.getComponent(s).string=t,a.getComponent(s).color=n,a.parent=this.node;var r=e.getWorldPosition();a.setWorldPosition(r.x+i.x,r.y+i.y,0),this.playEffect2(a,n)},i.playEffect1=function(e,t){var i=D().by(.5,{position:new w(0,100,0)},{onUpdate:function(i,n){e.getComponent(s).color=o.lerp(new o,t,new o(t.r,t.g,t.b,0),n)}}),n=D().to(.3,{scale:new w(1.2,1.2,1)});D(e).parallel(i,n).call((function(){e.setScale(new w(1,1,1)),Oe.putToPool("damageTex",e,!0)})).start()},i.playEffect2=function(e,t){D(e).to(.1,{scale:new w(1,1,1)}).delay(.3).to(.1,{scale:new w(0,0,1)}).call((function(){e.setScale(new w(1,1,1)),Oe.putToPool("damageTex",e,!1)})).start()},i.getColorConfigByDamage=function(e){switch(e){case"normal":return new o(255,255,255,255);case"criticalHit":return new o(255,0,0,255);default:return new o(255,255,255,255)}},i.getColorConfigByDamage2=function(e){for(var t=[50,100,150,200,300],i=[new o(255,255,255,255),new o(255,183,23,255),new o(0,255,20,255),new o(245,0,255,255),new o(255,0,0,255)],n=0;n<t.length;n++){if(t[n]>=e)return i[n]}return i[i.length-1]},i.createTipsTex=function(e,t){void 0===t&&(t={x:0,y:50});var i=Oe.getFromPool("tipsTex");i.getComponent(s).string=e,i.parent=this.node;var o=ce.dispatch("getHeroWorldPos");i.setWorldPosition(o.x+t.x,o.y+t.y,0),this.playTIPSTeXEffect(i)},i.playTIPSTeXEffect=function(e,t){void 0===t&&(t=new o(255,255,255,255));var i=D().by(1,{position:new w(0,200,0)},{onUpdate:function(i,n){e.getComponent(s).color=o.lerp(new o,t,new o(t.r,t.g,t.b,0),n)}}),n=D().to(.5,{scale:new w(1.2,1.2,1)});D(e).parallel(i,n).call((function(){e.setScale(new w(1,1,1)),Oe.putToPool("tipsTex",e,!0)})).start()},t}(d)).prototype,"damagePrefab",[vn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bn=Z(bn.prototype,"tipsPrefab",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_n=bn));e._RF.pop(),e._RF.push({},"506f9zuJdRKlbDiCkIyUYSC","HeroInfoLayer",void 0);var Un,qn,Gn,Jn,Vn,jn=t.ccclass,Qn=t.property;wn=jn("HeroInfoLayer"),Dn=Qn([p]),Ln=Qn(S),kn=Qn(S),Tn=Qn(i),Mn=Qn(i),An=Qn(i),wn((In=Z((Fn=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"selectBtnSF",In,j(t)),X(t,"HPPrefab",Rn,j(t)),X(t,"itemPrefab",Hn,j(t)),X(t,"HPPrefabPar",Nn,j(t)),X(t,"itemPrefabPar",On,j(t)),X(t,"maskPar",En,j(t)),t._curSelectItemData=void 0,t._tipsViewNode=void 0,t._itemPrefabArr=[],t._btnArr=[],t._HPNode=void 0,t._SSNode=void 0,t._EQNode=void 0,t._eqBtnList={},t._equPrefab=void 0,t._layerNode=[],t._config=["percentageBlood","percentageDamage","percentageMoveSpeed","moveSpeed","criticalHitRate","bonusBulletTotal","bonusBulletMoveSpeed","bonusBulletDuration","bonusBulletAttackTimes","recoveryHealthy","expAddition","divineStoneAddition"],t._nameConfig={percentageBlood:"血量百分比加成",percentageDamage:"伤害百分比加成",percentageMoveSpeed:"移速百分比加成",moveSpeed:"基础移速",criticalHitRate:"暴击率",bonusBulletTotal:"法宝额外数量",bonusBulletMoveSpeed:"法宝额外飞行速度",bonusBulletDuration:"法宝额外持续时间",bonusBulletAttackTimes:"法宝穿透次数",recoveryHealthy:"基础生命恢复",expAddition:"经验加成",divineStoneAddition:"灵石加成"},t._rewardConfig=void 0,t.关闭展示获得物品界面=void 0,t}J(t,e);var i=t.prototype;return i.onLoad=function(){this._btnArr.push(g("bg/selectBtnPar/btn1",this.node)),this._btnArr.push(g("bg/selectBtnPar/btn2",this.node)),this._btnArr.push(g("bg/selectBtnPar/btn3",this.node)),this._HPNode=g("/heroProperty",this.node),this._SSNode=g("/storageSpace",this.node),this._EQNode=g("/equipment",this.node),this._layerNode.push(this._HPNode,this._SSNode,this._EQNode),this._tipsViewNode=g("/heroProperty/tipsViewShow",this.node),Oe.addPoolToPools("SSLItemPrefab",new b,this.itemPrefab);var e=g("gets/itemPrefab",this.node);Oe.addPoolToPools("SSLGetsItemPrefab",new b,e);var t=g("/switchEquipment/selectEquPrefab",this._EQNode);Oe.addPoolToPools("ELItemPrefab",new b,t),this.initRewardConfig()},i.initRewardConfig=function(){this._rewardConfig={"一阶宝箱":["一阶妖丹","一阶道法果","一阶功法残卷","灵石","炼气丹","一阶功法整卷"],"一阶宝箱Ratio":[30,5,5,500,5,.5],"二阶宝箱":["二阶妖丹","二阶道法果","二阶功法残卷","灵石","筑基丹","二阶功法整卷"],"二阶宝箱Ratio":[30,5,4,5e3,5,.3],"三阶宝箱":["三阶妖丹","三阶道法果","三阶功法残卷","灵石","金元丹","三阶功法整卷"],"三阶宝箱Ratio":[30,5,3,5e4,5,.1],"四阶宝箱":["四阶妖丹","四阶道法果","四阶功法残卷","灵石","元婴丹","四阶功法整卷"],"四阶宝箱Ratio":[30,5,1,5e5,5,.1],"五阶宝箱":["五阶妖丹","五阶道法果","五阶功法残卷","灵石","化神丹","五阶功法整卷"],"五阶宝箱Ratio":[30,5,1,5e6,5,.1],"一阶功法整卷":[],"一阶功法整卷Ratio":[],"二阶功法整卷":[],"二阶功法整卷Ratio":[],"三阶功法整卷":[],"三阶功法整卷Ratio":[]};var e=ce.dispatch("usingHeroBasePropertyFun","getAllAboutSkillBook");for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=e[t];switch(i.lv){case 1:this._rewardConfig.一阶功法整卷.push(i.name),this._rewardConfig.一阶功法整卷Ratio.push(i.rareRatio);break;case 2:this._rewardConfig.二阶功法整卷.push(i.name),this._rewardConfig.二阶功法整卷Ratio.push(i.rareRatio);break;case 3:this._rewardConfig.三阶功法整卷.push(i.name),this._rewardConfig.三阶功法整卷Ratio.push(i.rareRatio);break;default:throw"暂未处理："+i.lv+"阶功法。"}}console.log("_rewardConfig",this._rewardConfig)},i.onEnable=function(){this.onSelectBtn(null,"1"),g("/itemDetail/ProgressBar",this.node).active=!1,g("/itemDetail",this.node).active=!1},i.start=function(){this.initHeroProperty()},i.initHeroProperty=function(){for(var e=this,t=function(){var t=e._config[i],o=ce.dispatch("usingHeroBasePropertyFun","getHeroBasePropertyCurLv",t),n=r(e.HPPrefab);n.parent=e.HPPrefabPar;var a=n.getChildByName("icon").getComponent(f),l="images/icons/icon_"+t+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return a.spriteFrame=e})),n.getChildByName("description").getComponent(s).string="Lv:"+o+"\n"+e._nameConfig[t],n.getChildByName("value").getComponent(s).string=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty",t);var h=n.getChildByName("upgrade");Ve(e.node,n.getChildByName("icon"),"HeroInfoLayer","onBtnBaseProperty",t),Ve(e.node,h,"HeroInfoLayer","onBtnUpgrade",t)},i=0;i<this._config.length;i++)t()},i.onSelectBtn=function(e,t){switch(null!==e&&ce.dispatch("playOneShot","common/通用按键"),this.updateBtnSF(parseInt(t)-1),t){case"1":this.onBtn1();break;case"2":this.onBtn2();break;case"3":this.onBtn3();break;default:throw"p is err,current p is "+t}},i.updateBtnSF=function(e){var t=this;this._btnArr.forEach((function(i,n){n==e?(i.getComponent(f).spriteFrame=t.selectBtnSF[1],i.getChildByName("Label").getComponent(s).color=new o(255,204,0,255)):(i.getComponent(f).spriteFrame=t.selectBtnSF[0],i.getChildByName("Label").getComponent(s).color=new o(255,255,255,255))}))},i.onBtn1=function(){this.openLayer(this._HPNode)},i.onBtn2=function(){this.updateStorageSpace(),this.openLayer(this._SSNode)},i.onBtn3=function(){this.openLayer(this._EQNode)},i.openLayer=function(e){this._layerNode.forEach((function(t){t.active=e==t}))},i.onBtnBaseProperty=function(e,t){console.log("p",t);var i=this.getUpgradeDescription(t);this.tipsViewShow(i,3)},i.onBtnUpgrade=function(e,t){var i=this.isCanUpgrade(t);if(i){ce.dispatch("reduceItemFromSS",i,1),ce.dispatch("usingHeroBasePropertyFun","upgradeBaseProperty",t);var o=ce.dispatch("usingHeroBasePropertyFun","getHeroBasePropertyCurLv",t),n=ce.dispatch("usingHeroBasePropertyFun","getHeroBaseProperty",t),a=e.target.parent;a.getChildByName("description").getComponent(s).string="Lv:"+o+"\n"+this._nameConfig[t],a.getChildByName("value").getComponent(s).string=n}},i.isCanUpgrade=function(e){var t=ce.dispatch("usingHeroBasePropertyFun","getHeroBasePropertyCurLv",e);if(t>=50)return ce.dispatch("tipsViewShow","已到达最大等级 无法升级"),!1;var i="",o=Math.ceil(t/10);switch(o){case 1:i="一阶道法果";break;case 2:i="二阶道法果";break;case 3:i="三阶道法果";break;case 4:i="四阶道法果";break;case 5:i="五阶道法果";break;default:console.warn("itemLv is "+o)}return ce.dispatch("getItemTotalByIdOrName",i)>0?i:(ce.dispatch("tipsViewShow",i+"不足,无法升级"),!1)},i.getUpgradeDescription=function(e){var t=ce.dispatch("usingHeroBasePropertyFun","getHeroBasePropertyCurLv",e),i=ce.dispatch("usingHeroBasePropertyFun","getHeroBasePropertyLvDetail",e);console.log("lv",t),console.log("lvDetail",i);var o="";return i.forEach((function(e,t){o+=t+1+":"+e+", "})),o},i.tipsViewShow=function(e,t){void 0===e&&(e="请传参"),void 0===t&&(t=1),this._tipsViewNode.children[0].getComponent(s).string=e;var i=D().to(.5,{scale:new w(1,1,1)},{onUpdate:function(e,t){var i=e.getComponent(f).color;e.getComponent(f).color=o.lerp(new o,i,new o(i.r,i.g,i.b,255),t)}}),n=D().to(.5,{scale:new w(1,1,1)},{onUpdate:function(e,t){var i=e.getComponent(f).color;e.getComponent(f).color=o.lerp(new o,i,new o(i.r,i.g,i.b,0),t)}}),a=D().delay(t);D(this._tipsViewNode).sequence(i,a,n).start()},i.updateStorageSpace=function(){for(var e=this;this._itemPrefabArr.length>0;){var t=this._itemPrefabArr.shift();Oe.putToPool("SSLItemPrefab",t)}var i=ce.dispatch("getItemList"),o=function(){var t=i[n],o=ce.dispatch("getItemDataByIdOrName",n),a=Oe.getFromPool("SSLItemPrefab");a.parent=e.itemPrefabPar;var r=a.getChildByName("sprite").getComponent(f),l="images/items/"+o.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return r.spriteFrame=e})),a.getChildByName("description").getComponent(s).string=o.description,a.getChildByName("name").getComponent(s).string=o.name+"X"+t,e._itemPrefabArr.push(a),Ve(e.node,r,"HeroInfoLayer","onBtnItem",n)};for(var n in i)o()},i.onBtnItem=function(e,t){console.log("onBtnItem",t);var i=ce.dispatch("getItemDataByIdOrName",t);switch(this._curSelectItemData=i,i.type){case"材料":this.showItemDetail([0]);break;case"功法":case"丹药":case"道法果":case"消耗品":this.showItemDetail([0,1]);break;case"others":console.log("others 还没写");break;case"可合成材料":this.showItemDetail([2]);break;default:console.warn("未处理的类型："+i.type)}},i.showItemDetail=function(e){console.log("showItemDetail",this._curSelectItemData),this.maskPar.getChildByName("name").getComponent(s).string=this._curSelectItemData.name,this.maskPar.getChildByName("description").getComponent(s).string=this._curSelectItemData.description,this.maskPar.getChildByName("btnPar").children.forEach((function(t,i){e.indexOf(i)>-1?t.active=!0:t.active=!1})),this.maskPar.active=!0},i.onBtnSell=function(){this.showProgressBar(),this.showItemDetail([3,4])},i.onBtnConfirmSell=function(){console.log("确定卖出");var e=g("/itemDetail/ProgressBar",this.node).getComponent(E).progress,t=this._curSelectItemData,i=ce.dispatch("getItemTotalByIdOrName",t.name);i=Math.floor(i*e);var o=t.price*i;console.log("卖出物品总数："+i),console.log("卖出物品总价格："+o),ce.dispatch("reduceItemFromSS",t.name,i),ce.dispatch("addItemToSS","灵石",o),this.updateStorageSpace(),this.maskPar.active=!1,this.closeProgressBar()},i.onBtnCancelSell=function(){this.closeProgressBar()},i.showProgressBar=function(){var e=g("/itemDetail/ProgressBar",this.node);e.getComponent(E).progress=0,e.getComponent(z).progress=0;var t=ce.dispatch("getItemTotalByIdOrName",this._curSelectItemData.name);e.getChildByName("Label").getComponent(s).string="数量：0/"+t+"\n价格：0",e.active=!0},i.closeProgressBar=function(){g("/itemDetail/ProgressBar",this.node).active=!1},i.slideProgressBar=function(e){var t=g("/itemDetail/ProgressBar",this.node),i=e.progress;t.getComponent(E).progress=i;var o=ce.dispatch("getItemTotalByIdOrName",this._curSelectItemData.name),n=Math.floor(o*i),a=n*this._curSelectItemData.price;t.getChildByName("Label").getComponent(s).string="数量："+n+"/"+o+"\n价格："+a},i.onBtnUsing=function(){switch(this._curSelectItemData.type){case"道法果":return this.closeItemDetail(),void this.onSelectBtn(null,"1");case"丹药":return this.closeItemDetail(),void ce.dispatch("switchMainMenuLayer",null,"3");case"功法":return this.closeItemDetail(),void ce.dispatch("switchMainMenuLayer",null,"5");default:console.warn("未处理的类型"+this._curSelectItemData.type)}ce.dispatch("reduceItemFromSS",this._curSelectItemData.name,1),this.maskPar.active=!1;var e=this._curSelectItemData.name,t=this._rewardConfig[e],i=this._rewardConfig[e+"Ratio"],o={};if(i.every((function(e){return e<=1}))){for(var n,a=Math.random(),r=0;r<i.length;r++){if(i[r]>=a){n=r;break}}o[t[n]]=1}else for(var s=0;s<t.length;s++){var l=t[s],h=i[s];if(h>1){var c=Math.random()*h|0;c>0&&(o[l]=c)}else Math.random()<h&&(o[l]=1)}for(var u in console.log("gets",o),this.showGets(o),o)Object.prototype.hasOwnProperty.call(o,u)&&(console.log("key",u),ce.dispatch("addItemToSS",u,o[u]));this.updateStorageSpace()},i.showGets=function(e){console.log("显示获得物品 还没写"),g("gets",this.node).active=!0;var t=g("gets/bg/ScrollView/view/content",this.node),i=function(){if(Object.prototype.hasOwnProperty.call(e,o)){var i=e[o],n=ce.dispatch("getItemDataByIdOrName",o),a=Oe.getFromPool("SSLGetsItemPrefab");a.active=!0,a.parent=t;var r=a.getComponent(f),l="images/items/"+n.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return r.spriteFrame=e})),a.getChildByName("name").getComponent(s).string=n.name+"x"+i}};for(var o in e)i()},i.onBtnMerge=function(){this.maskPar.active=!1;var e=this._curSelectItemData,t=ce.dispatch("getItemTotalByIdOrName",e.name);if(t<e.mergeDemandTotal)ce.dispatch("tipsViewShow",e.name+"数量不足，无法合成");else{var i=Math.floor(t/e.mergeDemandTotal),o=i*e.mergeDemandTotal;ce.dispatch("reduceItemFromSS",e.name,o),ce.dispatch("addItemToSS",e.mergeTarget,i);var n={};n[e.mergeTarget]=i,this.showGets(n),this.updateStorageSpace()}},i.closeGets=function(){g("gets",this.node).active=!1;for(var e=g("gets/bg/ScrollView/view/content",this.node);e.children.length;){var t=e.children[0];t.removeFromParent(),Oe.putToPool("SSLGetsItemPrefab",t)}},i.closeItemDetail=function(){this.maskPar.active=!1},i.initEquipment=function(){this._equPrefab=g("/equ",this._EQNode);for(var e=g("/bg/ScrollView/view/content",this._EQNode),t=0,i=["法器","法袍","鞋子","法宝1","法宝2","法宝3","符箓1","符箓2","符箓3"];t<i.length;t++){var o=i[t],n=r(this._equPrefab);n.parent=e,n.getChildByName("Label").getComponent(s).string=o,this._eqBtnList[o]=n,Ve(this.node,n.getChildByName("addEqBtn"),"HeroInfoLayer","onBtnEquipmentFrame",o)}console.log("this._eqBtnList",this._eqBtnList);this.updateEqShowBtn(["法器","法袍","鞋子","法宝1","法宝2","法宝3","符箓1","符箓2","符箓3"])},i.updateEqShowBtn=function(e){for(var t,i=K(e);!(t=i()).done;){var o=t.value;this._eqBtnList[o].active=!0}},i.onBtnEquipmentFrame=function(e,t){console.log("点击装备栏:"+t),g("/switchEquipment",this._EQNode).active=!0,this.initSwitchEquipment(t)},i.initSwitchEquipment=function(e){var t=this;console.log("initSwitchEquipment"),console.log("显示切换装备界面,type is "+e);var i=g("/switchEquipment/bg/ScrollView/view/content",this._EQNode);["回春剑","两仪巨剑","落日弓","清风袍","月影袍","月影鞋","清风鞋","流云鞋"].forEach((function(o){var n=ce.dispatch("usingHeroBasePropertyFun","getEquipmentDataByName",o);if(n.type===e){var a=Oe.getFromPool("ELItemPrefab",!0);a.parent=i,console.log("equName:",o),console.log("prefab",a);var r=a.getComponent(f);a.getChildByName("name").getComponent(s).string=n.name;var l="images/items/"+n.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return r.spriteFrame=e})),Ve(t.node,a,"HeroInfoLayer","showEquipmentDetail",n.name)}}))},i.showEquipmentDetail=function(e,t){var i=ce.dispatch("usingHeroBasePropertyFun","getEquipmentDataByName",t),o=g("/switchEquipment/equDetail",this._EQNode);o.getChildByName("equName").getComponent(s).string=i.name,o.getChildByName("equBaseProperties").getComponent(s).string=this.getEquipmentBasePropertiesDescription(i),o.active=!0},i.getEquipmentBasePropertiesDescription=function(e){var t="";return e.damage&&(t+="伤害："+e.damage+"\n"),e.moveSpeed&&(t+="移速："+e.moveSpeed+"\n"),e.blood&&(t+="血量："+e.blood+"\n"),e.defense&&(t+="防御："+e.defense+"\n"),e.duration&&(t+="飞行道具持续时间："+e.duration),t},i.closeEquipmentDetail=function(){g("/switchEquipment/equDetail",this._EQNode).active=!1},i.switchEquipment=function(e,t){console.log("切换武器 还没写"),this.closeSwitchEquipment()},i.closeSwitchEquipment=function(){console.log("closeSwitchEquipment"),g("/switchEquipment",this._EQNode).active=!1,g("/switchEquipment/equDetail",this._EQNode).active=!1;for(var e=g("/switchEquipment/bg/ScrollView/view/content",this._EQNode);e.children.length>0;){var t=e.children[0];t.removeFromParent(),Oe.putToPool("ELItemPrefab",t)}},t}(d)).prototype,"selectBtnSF",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rn=Z(Fn.prototype,"HPPrefab",[Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hn=Z(Fn.prototype,"itemPrefab",[kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nn=Z(Fn.prototype,"HPPrefabPar",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On=Z(Fn.prototype,"itemPrefabPar",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En=Z(Fn.prototype,"maskPar",[An],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xn=Fn));e._RF.pop(),e._RF.push({},"4e87avhPWxNFp2OmdXxirn8","MainMenu",void 0);var Kn,Xn,Zn,Yn,$n,ea,ta,ia,oa,na,aa,ra=t.ccclass,sa=t.property;Un=ra("MainMenu"),qn=sa([p]),Un((Vn=Z((Jn=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"selectBtnSF",Vn,j(t)),t._btnArr=[],t._layerNode=[],t._SSLNode=void 0,t._HILNode=void 0,t._TLNode=void 0,t._MPNode=void 0,t._SBNode=void 0,t._PHNode=void 0,t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("switchMainMenuLayer")},i.onLoad=function(){ce.add("switchMainMenuLayer",this.onSelectBtn.bind(this)),this._btnArr.push(g("Canvas/menuLayer/selectBtnPar/btn1")),this._btnArr.push(g("Canvas/menuLayer/selectBtnPar/btn2")),this._btnArr.push(g("Canvas/menuLayer/selectBtnPar/btn3")),this._btnArr.push(g("Canvas/menuLayer/selectBtnPar/btn4")),this._btnArr.push(g("Canvas/menuLayer/selectBtnPar/btn5")),this._btnArr.push(g("Canvas/menuLayer/selectBtnPar/btn6")),this._SSLNode=g("Canvas/menuLayer/SelectStageLayer"),this._HILNode=g("Canvas/menuLayer/HeroInfoLayer"),this._TLNode=g("Canvas/menuLayer/TrainingLayer"),this._MPNode=g("Canvas/menuLayer/MakePillsLayer"),this._SBNode=g("Canvas/menuLayer/SkillBookLayer"),this._PHNode=g("Canvas/menuLayer/PrizeHallLayer"),this._layerNode.push(this._SSLNode,this._HILNode,this._TLNode,this._MPNode,this._SBNode,this._PHNode),this.onSelectBtn(null,"1"),u.preloadScene("game")},i.onSelectBtn=function(e,t){switch(this.updateBtnSF(parseInt(t)-1),t){case"1":null!==e&&ce.dispatch("playOneShot","common/进入试炼场"),this.openLayer(this._SSLNode);break;case"2":null!==e&&ce.dispatch("playOneShot","common/点击人物界面"),this.openLayer(this._HILNode);break;case"3":null!==e&&ce.dispatch("playOneShot","common/点击修行界面"),this.openLayer(this._TLNode);break;case"4":null!==e&&ce.dispatch("playOneShot","common/点击炼丹界面"),this.openLayer(this._MPNode);break;case"5":null!==e&&ce.dispatch("playOneShot","common/点击秘籍界面"),this.openLayer(this._SBNode);break;case"6":this.openLayer(this._PHNode);break;default:throw"p is err,current p is "+t}},i.updateBtnSF=function(e){var t=this;this._btnArr.forEach((function(i,n){n==e?(i.getComponent(f).spriteFrame=t.selectBtnSF[1],i.getChildByName("Label").getComponent(s).color=new o(255,204,0,255)):(i.getComponent(f).spriteFrame=t.selectBtnSF[0],i.getChildByName("Label").getComponent(s).color=new o(255,255,255,255))}))},i.openLayer=function(e){this._layerNode.forEach((function(t){t.active=e==t}))},t}(d)).prototype,"selectBtnSF",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gn=Jn));e._RF.pop(),e._RF.push({},"55a8d2wX7hDXZkw04oDRSeH","MakePillsLayer",void 0);var la,ha=t.ccclass,ca=t.property;Kn=ha("MakePillsLayer"),Xn=ca(S),Zn=ca(S),Yn=ca([p]),$n=ca(i),Kn((ia=Z((ta=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"pillPrefab",ia,j(t)),X(t,"itemPrefab",oa,j(t)),X(t,"pillSF",na,j(t)),X(t,"itemPar",aa,j(t)),t._curPillData=void 0,t._pillPar=void 0,t._pillPrefabArr=[],t._itemPrefabArr=[],t._pillListConfig=[{id:4,name:"炼气丹",imageIndex:0,description:"提升修为，通过妖丹炼制",consumeTotal:10,consumeItemName:"一阶妖丹",consumeLingshi:50},{id:5,name:"筑基丹",imageIndex:1,description:"提升修为，通过妖丹炼制",consumeTotal:10,consumeItemName:"二阶妖丹",consumeLingshi:500},{id:6,name:"金元丹",imageIndex:2,description:"提升修为，通过妖丹炼制",consumeTotal:10,consumeItemName:"三阶妖丹",consumeLingshi:5e3},{id:7,name:"元婴丹",imageIndex:3,description:"提升修为，通过妖丹炼制",consumeTotal:10,consumeItemName:"四阶妖丹",consumeLingshi:5e4},{id:8,name:"化神丹",imageIndex:4,description:"提升修为，通过妖丹炼制",consumeTotal:10,consumeItemName:"五阶妖丹",consumeLingshi:5e5}],t}J(t,e);var i=t.prototype;return i.onLoad=function(){this._pillPar=g("/selectPill/sliding/content",this.node),Oe.addPoolToPools("MPLItemPrefab",new b,this.itemPrefab),this.initPillList(),this._curPillData=this._pillListConfig[0],this.updatePillState(this._pillPrefabArr[0])},i.initPillList=function(){var e=this;this._pillListConfig.forEach((function(t,i){var o=r(e.pillPrefab);o.parent=e._pillPar,o.getChildByName("sprite").getComponent(f).spriteFrame=e.pillSF[t.imageIndex],o.getChildByName("name").getComponent(s).string=t.name,o.data=t,Ve(e.node,o,"MakePillsLayer","onBtnPill"),e._pillPrefabArr.push(o)}))},i.onEnable=function(){this.updatePillsContent(),this.updateMaterialDemand()},i.onBtnPill=function(e){var t=e.target;this._curPillData=t.data,console.log("_curPillData",this._curPillData),ce.dispatch("playOneShot","common/通用按键"),this.updatePillState(t),this.updateMaterialDemand()},i.updatePillState=function(e){this._pillPrefabArr.forEach((function(t){t.getChildByName("name").getComponent(s).color=t===e?new o(255,204,0,255):new o(0,0,0,255)}))},i.updateMaterialDemand=function(){console.log("this._curPillData ",this._curPillData);var e=g("/stove/m1",this.node),t=g("/stove/m2",this.node),i=ce.dispatch("getItemDataByIdOrName",this._curPillData.consumeItemName),o=ce.dispatch("getItemDataByIdOrName","灵石"),n=ce.dispatch("getItemTotalByIdOrName",this._curPillData.consumeItemName),a=ce.dispatch("getItemTotalByIdOrName","灵石"),r=e.getChildByName("sprite").getComponent(f),l=t.getChildByName("sprite").getComponent(f);ce.dispatch("loadTheDirResources","images/items/"+i.loadUrl+"/spriteFrame",(function(e){return r.spriteFrame=e})),ce.dispatch("loadTheDirResources","images/items/"+o.loadUrl+"/spriteFrame",(function(e){return l.spriteFrame=e}));var h=e.getChildByName("Label").getComponent(s),c=t.getChildByName("Label").getComponent(s);h.string=i.name+"\n"+n+"/"+this._curPillData.consumeTotal,c.string=o.name+"\n"+a+"/"+this._curPillData.consumeLingshi},i.onBtnMakePill=function(){ce.dispatch("playOneShot","common/炼制丹药");var e=ce.dispatch("itemIsEnough",this._curPillData.consumeItemName,this._curPillData.consumeTotal),t=ce.dispatch("itemIsEnough","灵石",this._curPillData.consumeLingshi);if(console.log("itemIsEnough",e),console.log("lingshiIsEnough",t),e&&t)ce.dispatch("reduceItemFromSS",this._curPillData.consumeItemName,this._curPillData.consumeTotal),ce.dispatch("reduceItemFromSS","灵石",this._curPillData.consumeLingshi),console.log(this._curPillData.name+"+1"),console.log("刷新背包"),ce.dispatch("addItemToSS",this._curPillData.id,1),this.updatePillsContent(),this.updateMaterialDemand();else{var i="";i=e||t?e?"灵石不足，无法炼制。":"妖丹不足，无法炼制。":"妖丹和灵石不足，无法炼制。",ce.dispatch("tipsViewShow",i)}},i.updatePillsContent=function(){var e=this;for(console.log("updatePillsContent");this._itemPrefabArr.length>0;){var t=this._itemPrefabArr.shift();Oe.putToPool("MPLItemPrefab",t)}var i=ce.dispatch("getAllPills"),o=function(){if(Object.prototype.hasOwnProperty.call(i,n)){var t=i[n],o=Oe.getFromPool("MPLItemPrefab");o.parent=e.itemPar;var a=ce.dispatch("getItemDataByIdOrName",n);o.getChildByName("name").getComponent(s).string=a.name+"\nX"+t;var r=o.getChildByName("sprite").getComponent(f),l="images/items/"+a.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return r.spriteFrame=e})),e._itemPrefabArr.push(o)}};for(var n in i)o()},t}(d)).prototype,"pillPrefab",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa=Z(ta.prototype,"itemPrefab",[Zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),na=Z(ta.prototype,"pillSF",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aa=Z(ta.prototype,"itemPar",[$n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ea=ta));e._RF.pop(),e._RF.push({},"30ff6dHnqlOSpEBe/yd75rI","PrizeHallLayer",void 0);var ua,da,pa,ga,fa,ma,va,ya,_a,ba=t.ccclass;t.property,ba("PrizeHallLayer")(la=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._curCdkeySting=void 0,t._itemPrefab=void 0,t._itemContent=void 0,t}J(t,e);var i=t.prototype;return i.onLoad=function(){this._itemPrefab=g("item",this.node),this._itemContent=g("ScrollView/view/content",this.node);var e=new b;Oe.addPoolToPools("PrizeHallItem",e,this._itemPrefab)},i.onDisable=function(){this.clearContent()},i.inputCdkey=function(e){this._curCdkeySting=e.string},i.sendPrizeRequest=function(){var e=this;console.log("sendPrizeRequest current cdkey is ",this._curCdkeySting);Di.get("http://47.97.222.77:3001/game/copy9train/prize",{cdk:this._curCdkeySting},(function(t){console.log("response",t),t.successful?(console.log("添加领取奖励效果 还没写"),ce.dispatch("tipsViewShow","领取奖励成功"),e.distributePrizes(t.data)):ce.dispatch("tipsViewShow","cdk错误，领取失败。")}))},i.distributePrizes=function(e){var t=this;this.clearContent(),console.log("get prizes",e);for(var i=function(){var i=e.prize[o],n=e.total[o],a=ce.dispatch("getItemDataByIdOrName",i);ce.dispatch("addItemToSS",i,n);var r=Oe.getFromPool("PrizeHallItem");r.parent=t._itemContent;var l=r.getChildByName("Sprite").getComponent(f),h="images/items/"+a.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",h,(function(e){return l.spriteFrame=e})),r.getChildByName("Label").getComponent(s).string=a.name+"\nX"+n,r.active=!0,r.parent=t._itemContent},o=0;o<e.prize.length;o++)i()},i.clearContent=function(){console.log("清除content");for(var e=g("ScrollView/view/content",this.node);e.children.length;){var t=this._itemContent.children[0];t.removeFromParent(),Oe.putToPool("PrizeHallItem",t)}},t}(d));e._RF.pop(),e._RF.push({},"94db5bEjvBPh5zPA2EHobww","SelectStageLayer",void 0);var Sa,Ba=t.ccclass,Pa=t.property;ua=Ba("SelectStageLayer"),da=Pa(S),pa=Pa(i),ga=Pa(T),ua((va=Z((ma=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"SCPrefab",va,j(t)),X(t,"prefabPar",ya,j(t)),X(t,"stageConfigJson",_a,j(t)),t._isLoading=!1,t._stageName={1:"探索",2:"了解",3:"熟悉",4:"认知",5:"大家伙",6:"更深处的东西",7:"一探究竟",8:"原来如此",9:"看清一切",10:"大家伙的真面目"},t._mapName={1:"青青草原",2:"暗黑大陆",3:"晨星荒漠",4:"绝命谷",5:"寂静岭",6:"灼烧大陆",7:"无声荒漠",8:"虚无之地",9:"极寒之地",10:"魔幻大陆"},t._prefabArr=[],t._initPos={y:-300,gap:-500,changePos:1e3,changeRank:5},t._stageTotal=0,t}J(t,e);var i=t.prototype;return i.onLoad=function(){this._stageTotal=this.getStageTotal(),this.initPrefabs()},i.getStageTotal=function(){var e=this.stageConfigJson.json,t=0;for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t++;return t},i.initPrefabs=function(){for(var e=0;e<5;e++){var t=r(this.SCPrefab);t.parent=this.prefabPar,t.setPosition(0,this._initPos.y+e*this._initPos.gap);var i=e+1;t.stageNum=i,t.stageNum>Pe.stageProgress?t.getChildByName("btnBg").getChildByName("stageLock").active=!0:t.getChildByName("btnBg").getChildByName("stageLock").active=!1,t.getChildByName("Label").getComponent(s).string="关卡"+i+"\n"+this._mapName[Math.ceil(i/10)]+"\n"+this._stageName[i];var o=t.getChildByName("btnBg");Ve(this.node,o,"SelectStageLayer","onBtnEnter"),this._prefabArr.push(t)}var n=this.prefabPar.getComponent(a);n.setContentSize(n.width,this._stageTotal*Math.abs(this._initPos.gap)),console.log("this.prefabPar",this.prefabPar)},i.onBtnCheckpoint=function(e){var t=e.target.parent;console.log("onBtnCheckpoint",t.stageNum),this.onBtnEnter(e)},i.update=function(e){for(var t=this.prefabPar.parent.getWorldPosition(),i=0;i<this._prefabArr.length;i++){var o=this._prefabArr[i],n=o.getWorldPosition();if(n.y-t.y>this._initPos.changePos&&o.stageNum+this._initPos.changeRank<=this._stageTotal){var a=this._initPos.changeRank*this._initPos.gap;o.setWorldPosition(n.x,n.y+a,n.z),o.stageNum+=this._initPos.changeRank,o.stageNum>Pe.stageProgress?o.getChildByName("btnBg").getChildByName("stageLock").active=!0:o.getChildByName("btnBg").getChildByName("stageLock").active=!1,o.getChildByName("Label").getComponent(s).string="关卡"+o.stageNum+"\n"+this._mapName[Math.ceil(o.stageNum/10)]+"\n"+this._stageName[o.stageNum%10==0?10:o.stageNum%10]}else if(n.y-t.y<-this._initPos.changePos&&o.stageNum-this._initPos.changeRank>=1){var r=this._initPos.changeRank*this._initPos.gap;o.setWorldPosition(n.x,n.y-r,n.z),o.stageNum-=this._initPos.changeRank,o.stageNum>Pe.stageProgress?o.getChildByName("btnBg").getChildByName("stageLock").active=!0:o.getChildByName("btnBg").getChildByName("stageLock").active=!1,o.getChildByName("Label").getComponent(s).string="关卡"+o.stageNum+"\n"+this._mapName[Math.ceil(o.stageNum/10)]+"\n"+this._stageName[o.stageNum%10==0?10:o.stageNum%10]}}},i.onBtnEnter=function(e){var t=e.target.parent.stageNum;this._isLoading||(this._isLoading=!0,console.log("进入关卡"+t),t<=20?(this.openLoading(),Pe.curStage=parseInt(t),console.log("切换音效"),u.loadScene("game",(function(){ce.dispatch("switchMainBgm","/audio/music/不谓侠")}))):(console.warn("current stage is  undefined"),this._isLoading=!1))},i.openLoading=function(){g("Canvas/loading").active=!0},i.onBtnChangeStage=function(){Pe.stageProgress++,ce.dispatch("savingGlobalDataToTempData")},t}(d)).prototype,"SCPrefab",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya=Z(ma.prototype,"prefabPar",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=Z(ma.prototype,"stageConfigJson",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fa=ma));e._RF.pop(),e._RF.push({},"3cdb8SMhhdF5JZZxaW7u/Sm","SkillBookLayer",void 0);var Ca,wa,Da,La,ka,Ta,Ma,Aa,xa,Fa,Ia,Ra,Ha,Na,Oa,Ea,za,Wa=t.ccclass;t.property,Wa("SkillBookLayer")(Sa=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._loadingList={_skillBookClass:!1,_skillBook:!1},t._skillBookClass=void 0,t._skillBook=void 0,t._bookContent=void 0,t._curSelectBook=void 0,t._finishBookList=[],t._bookPrefabList={},t._usingBookList={"身法":"","心法":"","武技":"","绝技":"","神通":""},t}J(t,e);var i=t.prototype;return i.onLoad=function(){var e=g("switchBook/bookPrefab",this.node);Oe.addPoolToPools("SBLBookPrefab",new b,e),this._bookContent=g("ScrollView/view/content",this.node)},i.start=function(){this.dynamicLoadPrefabs(),this.initData(),this.initUsingBook()},i.initData=function(){var e=ce.dispatch("getTempData","SkillBookLayer");e&&(this._finishBookList=e.finishBookList,this._usingBookList=e.usingBookList)},i.dynamicLoadPrefabs=function(){var e=this;ce.dispatch("loadTheDirResources","prefabs/mainMenu/skillBookClass",(function(t){e._skillBookClass=t,e._loadingList._skillBookClass=!0,e.initBookListView()})),ce.dispatch("loadTheDirResources","prefabs/mainMenu/skillBook",(function(t){e._skillBook=t,e._loadingList._skillBook=!0,e.initBookListView()}))},i.initBookListView=function(){var e=this;if(this.isCompleteLoading()){var t=this.getSkillBookClassList();console.log("initBookListView",t);var i=function(){if(Object.prototype.hasOwnProperty.call(t,n)){var i=t[n],a=r(e._skillBookClass);a.parent=e._bookContent,a.getChildByName("Label").getComponent(s).string=n,i.forEach((function(t){var i=r(e._skillBook);e._finishBookList.indexOf(t.name)<0?(i.getComponent(f).color=new o(100,100,100,255),i.children[0].getComponent(s).color=new o(30,30,30,255)):(i.getComponent(f).color=new o(255,255,255,255),i.children[0].getComponent(s).color=new o(255,255,255,255)),i.children[0].getComponent(s).string=t.name,i.parent=g("/content",a),Ve(e.node,i,"SkillBookLayer","onBtnShowBookDetail",t.name),e._bookPrefabList[t.name]=i}))}};for(var n in t)i()}},i.isCompleteLoading=function(){for(var e in this._loadingList){if(Object.prototype.hasOwnProperty.call(this._loadingList,e))if(!this._loadingList[e])return!1}return!0},i.getSkillBookClassList=function(){var e=ce.dispatch("usingHeroBasePropertyFun","getAllAboutSkillBook"),t={};return e.forEach((function(e){t.hasOwnProperty(e.type)?t[e.type].push(e):t[e.type]=[e]})),t},i.onBtnShowBookDetail=function(e,t){var i=g("bookDetail",this.node),o=g("/bookDetail/study/Label",this.node).getComponent(s);o.string="领悟",i.active=!0,this._curSelectBook=t,this._finishBookList.indexOf(this._curSelectBook)>-1&&(o.string="已掌握");var n=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName",t);console.log("onBtnShowBookDetail",n),i.getChildByName("bookName").getComponent(s).string=n.name+"\n"+n.lv+"阶功法",i.getChildByName("bookDescription").getComponent(s).string="\n\n"+n.description},i.closeBookDetail=function(){g("bookDetail",this.node).active=!1},i.onBtnStudyBook=function(){if(!(this._finishBookList.indexOf(this._curSelectBook)>-1)){if(ce.dispatch("reduceItemFromSS",this._curSelectBook,1)){this._finishBookList.push(this._curSelectBook),g("/bookDetail/study/Label",this.node).getComponent(s).string="已掌握";var e=this._bookPrefabList[this._curSelectBook];e.getComponent(f).color=new o(255,255,255,255),e.children[0].getComponent(s).color=new o(255,255,255,255),this.savingFinishBookData()}else ce.dispatch("tipsViewShow","缺少秘籍:"+this._curSelectBook,3);console.log(this._finishBookList)}},i.savingFinishBookData=function(){var e={finishBookList:this._finishBookList,usingBookList:this._usingBookList};ce.dispatch("savingToTempData","SkillBookLayer",e)},i.initUsingBook=function(){var e=this;console.log("初始化携带功法 还没写");var t=function(){if(Object.prototype.hasOwnProperty.call(e._usingBookList,i)){var t=e._usingBookList[i];if(""!==t){var o=g("usingBook/"+i,e.node).getChildByName("sprite").getComponent(f),n="images/icons/icon_"+t+"/spriteFrame";ce.dispatch("loadTheDirResources",n,(function(e){return o.spriteFrame=e}))}}};for(var i in this._usingBookList)t()},i.onBtnSwitchBook=function(e,t){console.log("切换"+t),g("switchBook",this.node).active=!0,g("switchBook/bg/title",this.node).getComponent(s).string=t,this.initSwitchBook(t)},i.initSwitchBook=function(e){var t=this,i=g("switchBook/bg/content",this.node);this._finishBookList,this._finishBookList.forEach((function(o){var n=ce.dispatch("usingHeroBasePropertyFun","getSkillBookDataByIdOrName",o);if(n.type==e){var a=Oe.getFromPool("SBLBookPrefab"),r=a.getComponent(f);a.parent=i,a.getChildByName("name").getComponent(s).string=n.name;var l="images/icons/icon_"+n.name2+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return r.spriteFrame=e})),Ve(t.node,a,"SkillBookLayer","switchBook",e+"@"+n.name2)}}))},i.switchBook=function(e,t){console.log("p",t);var i=t.split("@"),o=i[0],n=i[1],a=g("usingBook/"+o,this.node).getChildByName("sprite").getComponent(f),r="images/icons/icon_"+n+"/spriteFrame";ce.dispatch("loadTheDirResources",r,(function(e){return a.spriteFrame=e})),this._usingBookList[o]=n,console.log("this._usingBookList",this._usingBookList),this.closeSwitchBook(),this.savingFinishBookData()},i.closeSwitchBook=function(){g("switchBook",this.node).active=!1;for(var e=g("switchBook/bg/content",this.node);e.children.length;){var t=e.children[0];t.removeFromParent(),Oe.putToPool("SBLBookPrefab",t)}},t}(d));e._RF.pop(),e._RF.push({},"9d7ecxRXdtAUbVGlUY0HvPs","TrainingLayer",void 0);var Ua,qa,Ga,Ja,Va,ja,Qa,Ka=t.ccclass,Xa=t.property;Ca=Ka("TrainingLayer"),wa=Xa(T),Da=Xa(S),La=Xa(i),ka=Xa(f),Ta=Xa(s),Ma=Xa(s),Aa=Xa(i),Ca((Ia=Z((Fa=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"trainingLvListJson",Ia,j(t)),X(t,"pillPrefab",Ra,j(t)),X(t,"pillPar",Ha,j(t)),X(t,"expProgress",Na,j(t)),X(t,"expProgressDescription",Oa,j(t)),X(t,"trainingLv",Ea,j(t)),X(t,"trainingBonusLabelPar",za,j(t)),t._itemPrefabArr=[],t._trainingLvList=void 0,t._yellowCircle=void 0,t._rotationSpeed=100,t._pillList=void 0,t._isUpgrading=!1,t._curTrainingExp=void 0,t._curTrainingLv=void 0,t._TIM=void 0,t}J(t,e);var i=t.prototype;return i.onLoad=function(){this._yellowCircle=g("trainingCircle",this.node),this._pillList=g("pillList",this.node),this._trainingLvList=this.trainingLvListJson.json,Oe.addPoolToPools("TLPillPrefab",new b,this.pillPrefab)},i.onEnable=function(){this.updatePillsContent()},i.updatePillsContent=function(){var e=this;for(console.log("updatePillsContent");this._itemPrefabArr.length>0;){var t=this._itemPrefabArr.shift();Oe.putToPool("TLPillPrefab",t)}var i=ce.dispatch("getAllPills"),o=function(){if(Object.prototype.hasOwnProperty.call(i,n)){var t=i[n],o=Oe.getFromPool("TLPillPrefab");o.parent=e.pillPar;var a=ce.dispatch("getItemDataByIdOrName",n);o.getChildByName("name").getComponent(s).string=a.name+"\nX"+t;var r=o.getChildByName("sprite").getComponent(f),l="images/items/"+a.loadUrl+"/spriteFrame";ce.dispatch("loadTheDirResources",l,(function(e){return r.spriteFrame=e})),Ve(e.node,o,"TrainingLayer","onBtnUsingPill",a.name),e._itemPrefabArr.push(o)}};for(var n in i)o()},i.start=function(){this.initTrainingLv()},i.initTrainingLv=function(){var e=ce.dispatch("getTempData","training");null===e?(this._curTrainingExp=0,this._curTrainingLv=0):(this._curTrainingExp=e.curExp,this._curTrainingLv=e.curLv,console.log("读取列表 配置修为 还没写"));var t={level:0,maxLevel:this._trainingLvList.length-1,curExp:0,levelMappingExpList:this._trainingLvList};this._TIM=new Xi(t),this._TIM.addExp(this._curTrainingExp),this.updateProgressView()},i.savingTrainingData=function(){var e={curExp:this._curTrainingExp,curLv:this._curTrainingLv};ce.dispatch("savingToTempData","training",e)},i.onBtnUsingPill=function(e,t){var i;switch(ce.dispatch("playOneShot","common/吃药"),ce.dispatch("reduceItemFromSS",t,1),this.updatePillsContent(),console.log("加经验 还没写"),t){case"炼气丹":i=1;break;case"筑基丹":i=10;break;case"金元丹":i=100;break;case"元婴丹":i=1e3;break;default:i=0,console.warn("尚未添加丹药"+t+"的经验值")}this._TIM.addExp(i),this._curTrainingExp=this._TIM.curExp,this.updateProgressView(),this.savingTrainingData()},i.updateProgressView=function(){var e=this._trainingLvList[this._curTrainingLv].exp,t=this._curTrainingExp+"/"+e,i=this._trainingLvList[this._curTrainingLv],o=this.trainingBonusLabelPar;this.expProgressDescription.string=t,this.expProgress.fillRange=this._curTrainingExp/e,this.trainingLv.string=i.name,o.getChildByName("l1").getComponent(s).string="血量加成："+i.blood,o.getChildByName("l2").getComponent(s).string="伤害加成："+i.damage,o.getChildByName("l3").getComponent(s).string="移速加成："+i.moveSpeed},i.onBtnUpgrade=function(){this._isUpgrading?ce.dispatch("tipsViewShow","突破中..."):this.isCanUpgrade()?(this._isUpgrading=!0,this._curTrainingLv++,this.playUpgradeAnim(),this.savingTrainingData()):ce.dispatch("tipsViewShow","当前状态无法突破。")},i.isCanUpgrade=function(){return this._TIM.level>this._curTrainingLv},i.playUpgradeAnim=function(){var e=this;ce.dispatch("playOneShot","common/突破"),D(this._yellowCircle).call((function(){e._rotationSpeed=-500})).to(2.5,{scale:new w(2,2,1)},{easing:"cubicIn"}).to(2.5,{scale:new w(1,1,1)},{easing:"cubicOut"}).call((function(){e._rotationSpeed=100,e._isUpgrading=!1,e.updateProgressView()})).start()},i.update=function(e){this._yellowCircle.angle+=this._rotationSpeed*e},t}(d)).prototype,"trainingLvListJson",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=Z(Fa.prototype,"pillPrefab",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ha=Z(Fa.prototype,"pillPar",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=Z(Fa.prototype,"expProgress",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=Z(Fa.prototype,"expProgressDescription",[Ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea=Z(Fa.prototype,"trainingLv",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=Z(Fa.prototype,"trainingBonusLabelPar",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xa=Fa));e._RF.pop(),e._RF.push({},"b39cal86yhCGYNmdUqX6+Oi","Canvas",void 0);var Za,Ya,$a,er,tr,ir,or,nr=t.ccclass,ar=t.property;Ua=nr("Canvas"),qa=ar(i),Ga=ar(i),Ua((ja=Z((Va=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"childNode",ja,j(t)),X(t,"needActiveNode",Qa,j(t)),t}J(t,e);var i=t.prototype;return i.onLoad=function(){this.activeChildNodeFirst(),this.activeScriptByActiveNode()},i.onDestroy=function(){Oe.clearAllNodePool()},i.start=function(){},i.activeChildNodeFirst=function(){for(var e=this.childNode,t=0;t<e.length;t++){var i=e[t];i&&(i.active=!0)}},i.activeScriptByActiveNode=function(){for(var e=this.needActiveNode,t=0;t<e.length;t++){var i=e[t];i&&(i.active=!0,i.active=!1)}},t}(d)).prototype,"childNode",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qa=Z(Va.prototype,"needActiveNode",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ja=Va));e._RF.pop(),e._RF.push({},"0945a1ycZVIXowKyhXL17x/","PreLoad",void 0);var rr,sr,lr,hr,cr,ur=t.ccclass,dr=t.property,pr=(Za=ur("PreLoad"),Ya=dr(f),$a=dr(s),Za((ir=Z((tr=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"fillSprite",ir,j(t)),X(t,"progressLabel",or,j(t)),t}J(t,e);var i=t.prototype;return i.onLoad=function(){u.loadScene("game")},i.updateLoadingProgress=function(e){this.fillSprite&&this.progressLabel&&(e<=this.fillSprite.fillRange||(this.fillSprite.fillRange=e,this.progressLabel.string=(100*e).toFixed(2)+"%"))},t}(d)).prototype,"fillSprite",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),or=Z(tr.prototype,"progressLabel",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),er=tr))||er);e._RF.pop(),e._RF.push({},"16d7eG5vo9IBLdWMm1q6dEM","DynamicLoading",void 0);var gr,fr=t.ccclass,mr=t.property;rr=fr("DynamicLoading"),sr=mr(pr),rr((cr=Z((hr=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"preLoadScript",cr,j(t)),t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("loadTheDirResources"),ce.remove("loadTheDir")},i.onLoad=function(){ce.add("loadTheDirResources",this.loadTheDirResources.bind(this)),ce.add("loadTheDir",this.loadTheDir.bind(this)),this.preLoadAllResources(),H.addPersistRootNode(this.node)},i.preLoadAllResources=function(){var e=this;W.loadDir("",(function(t,i,o){e.preLoadScript.updateLoadingProgress(t/i)}),(function(t,i){t?console.log(t):e.preLoadScript.enterMainMenuScene()}))},i.loadTheDir=function(e,t){void 0===t&&(t=null),W.loadDir(e,(function(e,i){e?console.log(e):t&&t(i)}))},i.loadTheDirResources=function(e,t){void 0===t&&(t=null),W.load(e,(function(e,i){e?console.log(e):t&&t(i)}))},t}(d)).prototype,"preLoadScript",[sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lr=hr));e._RF.pop(),e._RF.push({},"7b3a5gFIv9F5YMt4WSduB3t","AD_SDK",void 0);var vr,yr=t.ccclass;t.property,yr("AD_SDK")(gr=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("createPlayADEvent"),ce.remove("directPlayAD")},i.onLoad=function(){ce.add("createPlayADEvent",this.createPlayADEvent.bind(this)),ce.add("directPlayAD",this.directPlayAD.bind(this))},i.createPlayADEvent=function(e,t){Ve(this.node,e,"AD_SDK","onBtnShowADs"+t)},i.onBtnShowADsGameMonetize=function(){"undefined"!=typeof sdk&&"undefined"!==sdk.showBanner&&sdk.showBanner()},i.directPlayAD=function(e){this["onBtnShowADs"+e]()},t}(d));e._RF.pop(),e._RF.push({},"cb456kBbFJNn4k61gmkPq3v","GameMonetize.com-SDK",void 0),e._RF.pop(),e._RF.push({},"2b285d1pABPvbomGQPT2Bdu","testAds",void 0);var _r,br,Sr,Br,Pr,Cr,wr,Dr,Lr;(0,t.ccclass)("testAds")(vr=function(e){function t(){return e.apply(this,arguments)||this}return J(t,e),t.prototype.start=function(){ce.dispatch("createPlayADEvent",this.node,"GameMonetize")},t}(d));e._RF.pop(),e._RF.push({},"35f94alQIRIZaEOuFj6CMh/","AudioManager",void 0);var kr,Tr,Mr,Ar,xr,Fr,Ir,Rr,Hr,Nr,Or,Er=t.ccclass,zr=t.property;_r=Er("AudioManager"),br=zr(U),Sr=zr(q),Br=zr(q),_r((wr=Z((Cr=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"mainBGM",wr,j(t)),X(t,"bgmPlayer",Dr,j(t)),X(t,"effectPlayer",Lr,j(t)),t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("switchMainBgm"),ce.remove("playOneShot"),ce.remove("muteAudio"),ce.remove("resumeAudio")},i.onLoad=function(){ce.add("switchMainBgm",this.switchMainBgm.bind(this)),ce.add("playOneShot",this.playOneShot.bind(this)),ce.add("muteAudio",this.muteAudio.bind(this)),ce.add("resumeAudio",this.resumeAudio.bind(this)),H.addPersistRootNode(this.node)},i.start=function(){this.switchMainBgm("/audio/music/刀剑如梦")},i.switchMainBgm=function(e){var t=this;this.bgmPlayer.stop(),ce.dispatch("loadTheDirResources",e,(function(e){t.bgmPlayer.clip=e,t.bgmPlayer.play()}))},i.playOneShot=function(e){var t=this;ce.dispatch("loadTheDirResources","/audio/effect/"+e,(function(e){t.effectPlayer.playOneShot(e)}))},i.muteAudio=function(){this.effectPlayer.mute=!1,this.bgmPlayer.mute=!1},i.resumeAudio=function(){this.effectPlayer.mute=!0,this.bgmPlayer.mute=!0},t}(d)).prototype,"mainBGM",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dr=Z(Cr.prototype,"bgmPlayer",[Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=Z(Cr.prototype,"effectPlayer",[Br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pr=Cr));e._RF.pop(),e._RF.push({},"18e13h041hCKrr/q+F1r+Zb","HeroBaseProperty",void 0);var Wr=t.ccclass,Ur=t.property;kr=Wr("HeroBaseProperty"),Tr=Ur(T),Mr=Ur(T),Ar=Ur(T),xr=Ur(T),kr((Rr=Z((Ir=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"heroPropertyDataJson",Rr,j(t)),X(t,"trainingLvListJson",Hr,j(t)),X(t,"skillBookListJson",Nr,j(t)),X(t,"equipmentListJson",Or,j(t)),t._heroData=void 0,t._trainingLvList=void 0,t._skillBookList={},t._equipmentList={},t._percentageBloodLv=void 0,t._percentageDamageLv=void 0,t._moveSpeedLv=void 0,t._percentageMoveSpeedLv=void 0,t._criticalHitRateLv=void 0,t._bonusBulletTotalLv=void 0,t._bonusBulletMoveSpeedLv=void 0,t._bonusBulletDurationLv=void 0,t._bonusBulletAttackTimesLv=void 0,t._recoveryHealthyLv=void 0,t._expAdditionLv=void 0,t._divineStoneAdditionLv=void 0,t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("usingHeroBasePropertyFun")},i.onLoad=function(){this._heroData=this.heroPropertyDataJson.json[0],this._trainingLvList=this.trainingLvListJson.json,this.initSkillBookData(),this.initEquipmentData(),ce.add("usingHeroBasePropertyFun",this.usingHeroBasePropertyFun.bind(this)),H.addPersistRootNode(this.node)},i.initSkillBookData=function(){var e=this;this.skillBookListJson.json.forEach((function(t){var i=t.name,o=t.name2;e._skillBookList[i]=t,e._skillBookList[o]=t}))},i.initEquipmentData=function(){var e=this;this.equipmentListJson.json.forEach((function(t){var i=t.name;e._equipmentList[i]=t}))},i.onEnable=function(){this.initBasePropertyLv()},i.initBasePropertyLv=function(){var e=ce.dispatch("getTempData","HeroBasePropertyLvList");null==e&&(e={percentageBloodLv:1,percentageDamageLv:1,percentageMoveSpeedLv:1,moveSpeedLv:1,criticalHitRateLv:1,bonusBulletTotalLv:1,bonusBulletMoveSpeedLv:1,bonusBulletDurationLv:1,bonusBulletAttackTimesLv:1,recoveryHealthyLv:1,expAdditionLv:1,divineStoneAdditionLv:10}),this._percentageBloodLv=e.percentageBloodLv,this._percentageDamageLv=e.percentageDamageLv,this._percentageMoveSpeedLv=e.percentageMoveSpeedLv,this._moveSpeedLv=e.moveSpeedLv,this._criticalHitRateLv=e.criticalHitRateLv,this._bonusBulletTotalLv=e.bonusBulletTotalLv,this._bonusBulletMoveSpeedLv=e.bonusBulletMoveSpeedLv,this._bonusBulletDurationLv=e.bonusBulletDurationLv,this._bonusBulletAttackTimesLv=e.bonusBulletAttackTimesLv,this._recoveryHealthyLv=e.recoveryHealthyLv,this._expAdditionLv=e.expAdditionLv,this._divineStoneAdditionLv=e.divineStoneAdditionLv,this.savingLvData()},i.savingLvData=function(){var e={percentageBloodLv:this._percentageBloodLv,percentageDamageLv:this._percentageDamageLv,moveSpeedLv:this._moveSpeedLv,percentageMoveSpeedLv:this._percentageMoveSpeedLv,criticalHitRateLv:this._criticalHitRateLv,bonusBulletTotalLv:this._bonusBulletTotalLv,bonusBulletMoveSpeedLv:this._bonusBulletMoveSpeedLv,bonusBulletDurationLv:this._bonusBulletDurationLv,bonusBulletAttackTimesLv:this._bonusBulletAttackTimesLv,recoveryHealthyLv:this._recoveryHealthyLv,expAdditionLv:this._expAdditionLv,divineStoneAdditionLv:this._divineStoneAdditionLv};ce.dispatch("savingToTempData","HeroBasePropertyLvList",e)},i.usingHeroBasePropertyFun=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++)i[o-1]=arguments[o];if(this[e]&&"function"==typeof this[e])return this[e].apply(this,i);throw e+" is not fun or undefined"},i.getHeroBaseProperty=function(e){if(!this._heroData.hasOwnProperty(e))throw"不存在属性"+e;var t=this["_"+e+"Lv"];return t?this._heroData[e][t-1]:this._heroData[e][0]},i.getHeroBasePropertyLvDetail=function(e){if(!this._heroData.hasOwnProperty(e))throw"不存在属性"+e;return this._heroData[e]},i.getHeroBasePropertyCurLv=function(e){if(!this._heroData.hasOwnProperty(e))throw"不存在属性"+e;return console.log("property",e,this["_"+e+"Lv"]),this["_"+e+"Lv"]},i.upgradeBaseProperty=function(e){if(!this._heroData.hasOwnProperty(e))throw"不存在属性"+e;this["_"+e+"Lv"]++,this.savingLvData()},i.getTrainingData=function(e){var t=ce.dispatch("getTempData","training");return null===t?this._trainingLvList[0][e]:0!==t.curLv?this._trainingLvList[t.curLv][e]:void 0},i.getAllAboutSkillBook=function(){return this.skillBookListJson.json},i.getSkillBookDataByIdOrName=function(e){if(this._skillBookList.hasOwnProperty(e))return this._skillBookList[e];throw e+" of _skillBookList is null"},i.getEquipmentDataByName=function(e){if(this._equipmentList.hasOwnProperty(e))return this._equipmentList[e];throw e+" of _equipmentList is null"},t}(d)).prototype,"heroPropertyDataJson",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hr=Z(Ir.prototype,"trainingLvListJson",[Mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nr=Z(Ir.prototype,"skillBookListJson",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Or=Z(Ir.prototype,"equipmentListJson",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fr=Ir));e._RF.pop(),e._RF.push({},"6c3eaMSS1FJZpq6wdRN9a3f","ItemManager",void 0);var qr,Gr=function(){function e(){this._itemList={}}var t=e.prototype;return t.addItem=function(e,t){this._itemList.hasOwnProperty(e)?this._itemList[e]+=t:this.addNewItemToList(e,t)},t.addNewItemToList=function(e,t){this._itemList[e]=t},t.reduceItem=function(e,t){return!!this._itemList.hasOwnProperty(e)&&(!!this.itemIsEnough(e,t)&&(this._itemList[e]-=t,0===this._itemList[e]&&this.clearItemFromList(e),!0))},t.itemIsEnough=function(e,t){return this._itemList.hasOwnProperty(e)&&this._itemList[e]>=t},t.clearItemFromList=function(e){delete this._itemList[e]},t.getItemTotal=function(e){return this._itemList.hasOwnProperty(e)?this._itemList[e]:0},e}();e._RF.pop(),e._RF.push({},"57546QrwlBC8YczrgjQR8PN","SavingManager",void 0);var Jr,Vr,jr,Qr,Kr,Xr=t.ccclass;t.property,Xr("SavingManager")(qr=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return(t=e.call.apply(e,[this].concat(o))||this)._tempData={},t}J(t,e);var i=t.prototype;return i.onLoad=function(){ce.add("savingToTempData",this.savingToTempData.bind(this)),ce.add("getTempData",this.getTempData.bind(this)),ce.add("savingGlobalDataToTempData",this.savingGlobalDataToTempData.bind(this)),this.initTempData(),H.addPersistRootNode(this.node),console.log("========================INIT SavingManager==================="),this.initGlobalData()},i.onDestroy=function(){ce.remove("savingToTempData"),ce.remove("getTempData")},i.savingToTempData=function(e,t){this._tempData.hasOwnProperty(e)||console.warn("添加新属性"+e),this._tempData[e]=JSON.parse(JSON.stringify(t)),console.log("temp data，saving key is "+e,this._tempData),G.localStorage.setItem("saving",JSON.stringify(this._tempData))},i.getTempData=function(e){return this._tempData.hasOwnProperty(e)?this._tempData[e]:null},i.initTempData=function(){var e=G.localStorage.getItem("saving");e&&(this._tempData=JSON.parse(e))},i.initGlobalData=function(){if(this._tempData.hasOwnProperty("global")){var e=this._tempData.global;Pe.stageProgress=e.stageProgress}},i.savingGlobalDataToTempData=function(){var e={stageProgress:Pe.stageProgress};this.savingToTempData("global",e)},t}(d));e._RF.pop(),e._RF.push({},"b3799jrBkdOuIf8jGPcYoQz","StorageSpace",void 0);var Zr,Yr=t.ccclass,$r=t.property;Jr=Yr("StorageSpace"),Vr=$r(T),Jr((Kr=Z((Qr=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return X(t=e.call.apply(e,[this].concat(o))||this,"itemDataJson",Kr,j(t)),t._itemData={},t._IM=void 0,t}J(t,e);var i=t.prototype;return i.onDestroy=function(){ce.remove("addItemToSS"),ce.remove("reduceItemFromSS"),ce.remove("itemIsEnough"),ce.remove("getItemList"),ce.remove("getItemDataByIdOrName"),ce.remove("getItemTotalByIdOrName"),ce.remove("getAllPills")},i.onLoad=function(){ce.add("addItemToSS",this.addItemToSS.bind(this)),ce.add("reduceItemFromSS",this.reduceItemFromSS.bind(this)),ce.add("itemIsEnough",this.itemIsEnough.bind(this)),ce.add("getItemList",this.getItemList.bind(this)),ce.add("getItemDataByIdOrName",this.getItemDataByIdOrName.bind(this)),ce.add("getItemTotalByIdOrName",this.getItemTotalByIdOrName.bind(this)),ce.add("getAllPills",this.getAllPills.bind(this)),this.initItemData(),this._IM=new Gr,H.addPersistRootNode(this.node)},i.initItemData=function(){var e=this;this.itemDataJson.json.forEach((function(t){var i=t.id,o=t.name;e._itemData[i]=t,e._itemData[o]=t}))},i.showAll=function(){console.log("_IM",this._IM)},i.initSSData=function(){var e=ce.dispatch("getTempData","storageSpace");if(null!==e)for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var i=e[t];this._IM.addItem(parseInt(t),i)}},i.start=function(){this.initSSData(),this.addSomeItems()},i.addSomeItems=function(){},i.helpAddItems=function(){this.addItemToSS("一阶宝箱",99),this.addItemToSS("二阶宝箱",99),this.addItemToSS("三阶宝箱",99),this.addItemToSS("四阶宝箱",99),this.addItemToSS("五阶宝箱",99),this.addItemToSS("一阶功法残卷",99),this.addItemToSS("一阶功法整卷",99)},i.helpAddItems2=function(){for(var e=1;e<62;e++)this.addItemToSS(e,100)},i.getItemDataByIdOrName=function(e){if(this._itemData.hasOwnProperty(e))return this._itemData[e];throw e+" of _itemData is null"},i.addItemToSS=function(e,t){if(!this._itemData.hasOwnProperty(e))throw"id_name err,id is "+e+" item is err";var i=this._itemData[e].id;this._IM.addItem(i,t),ce.dispatch("savingToTempData","storageSpace",this.getItemList())},i.reduceItemFromSS=function(e,t){if(!this._itemData.hasOwnProperty(e))throw"id_name err,id_name is "+e+" item is err";var i=this._itemData[e].id,o=this._IM.reduceItem(i,t);return ce.dispatch("savingToTempData","storageSpace",this.getItemList()),o},i.itemIsEnough=function(e,t){if(!this._itemData.hasOwnProperty(e))throw"id_name err,id_name is "+e+" item is err";var i=this._itemData[e].id;return this._IM.itemIsEnough(i,t)},i.getItemList=function(){return this._IM._itemList},i.getItemTotalByIdOrName=function(e){if(!this._itemData.hasOwnProperty(e))throw e+" of _itemData is null";var t=this._itemData[e].id;return this._IM.getItemTotal(t)},i.getAllPills=function(){var e={};for(var t in this._IM._itemList)Object.prototype.hasOwnProperty.call(this._IM._itemList,t)&&"丹药"==this._itemData[t].type&&(e[t]=this._IM._itemList[t]);return e},t}(d)).prototype,"itemDataJson",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jr=Qr));e._RF.pop(),e._RF.push({},"39f4bK1+n9Lsp/dZy6C5YpZ","TipView",void 0);var es,ts=t.ccclass;t.property,ts("TipView")(Zr=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.onLoad=function(){ce.add("tipsViewShow",this.tipsViewShow.bind(this))},i.onDestroy=function(){ce.remove("tipsViewShow")},i.tipsViewShow=function(e,t){void 0===e&&(e="请传参"),void 0===t&&(t=1),this.node.children[0].getComponent(s).string=e;var i=D().to(.5,{scale:new w(1,1,1)},{onUpdate:function(e,t){var i=e.getComponent(f).color;e.getComponent(f).color=o.lerp(new o,i,new o(i.r,i.g,i.b,255),t)}}),n=D().to(.5,{scale:new w(1,1,1)},{onUpdate:function(e,t){var i=e.getComponent(f).color;e.getComponent(f).color=o.lerp(new o,i,new o(i.r,i.g,i.b,0),t)}}),a=D().delay(t);D(this.node).sequence(i,a,n).start()},t}(d));e._RF.pop(),e._RF.push({},"1aea51RUbNFdL7S/YxOX6C2","helpLayer",void 0);var is=t.ccclass;t.property,is("helpLayer")(es=function(e){function t(){return e.apply(this,arguments)||this}J(t,e);var i=t.prototype;return i.onBtnUnlockAllStages=function(){Pe.stageProgress=20,ce.dispatch("savingGlobalDataToTempData")},i.onBtnOpenHelpLayer=function(){this.node.active=!0},i.onBtnCloseHelpLayer=function(){this.node.active=!1},i.onBtnOpenDamageImmunity=function(){ce.dispatch("usingHeroControlFun","openDamageImmunity")},t}(d));e._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});